import{_ as i,c as s,o as e,a4 as a}from"./chunks/framework.C5O6QHj3.js";const g=JSON.parse('{"title":"Node-API","description":"","frontmatter":{},"headers":[],"relativePath":"translation/nodejs/n-api.md","filePath":"translation/nodejs/n-api.md","lastUpdated":1693382780000}'),n={name:"translation/nodejs/n-api.md"},t=a(`<h1 id="node-api" tabindex="-1">Node-API <a class="header-anchor" href="#node-api" aria-label="Permalink to &quot;Node-API&quot;">​</a></h1><blockquote><p>Stability: 2 - Stable</p></blockquote><p>Node-API（旧N-API）は、ネイティブアドオンを構築するためのAPIです。基礎となる JavaScript ランタイム（例えば V8）から独立しており、Node.js 自体の一部として維持されています。このAPIは、Node.jsのバージョン間でアプリケーション・バイナリ・インタフェース（ABI）が安定しています。これは、基礎となるJavaScriptエンジンの変更からアドオンを隔離し、あるメジャーバージョン用にコンパイルされたモジュールが、再コンパイルすることなくNode.jsの後のメジャーバージョンで実行できるようにすることを目的としています。ABI Stability ガイドに、より詳細な説明があります。</p><p>アドオンは、「C++アドオン」のセクションで概説したのと同じアプローチ/ツールでビルド/パッケージ化されます。唯一の違いは、ネイティブコードで使用されるAPIのセットです。V8 または Native Abstractions for Node.js API を使用する代わりに、Node-API で利用可能な関数が使用されます。</p><p>Node-API によって公開される API は、一般的に JavaScript 値の作成と操作に使用されます。概念と操作は一般的にECMA-262言語仕様で指定されたアイデアに対応しています。APIには以下の特性があります：</p><ul><li>全ての Node-API 呼び出しは <code>napi_status</code> 型のステータスコードを返す。このステータスはAPIコールが成功したか失敗したかを示す。</li><li>API の戻り値は out パラメータで渡される。</li><li>すべてのJavaScriptの値は <code>napi_value</code> という名前の不透明な型の後ろに抽象化されている。</li><li>エラーステータスコードの場合、<code>napi_get_last_error_info</code> を使用して追加情報を得ることができる。より詳しい情報はエラー処理のセクションにある。</li></ul><p>Node-API は C API で、Node.js のバージョンや異なるコンパイラレベル間で ABI の安定性を保証します。C++ API の方が使いやすいかもしれません。C++ の使用をサポートするために、プロジェクトは <code>node-addon-api</code> と呼ばれる C++ ラッパーモジュールを保守しており、このラッパーはインライン化可能な C++ API を提供します。node-addon-api<code> でビルドされたバイナリは、Node.js によってエクスポートされた Node-API C ベースの関数のシンボルに依存する。node-addon-api</code> は Node-API を呼び出すコードをより効率的に書く方法である。例えば、以下の <code>node-addon-api</code> コードを見てみよう。最初のセクションが <code>node-addon-api</code> のコードで、2番目のセクションがアドオンで実際に使用されるものを示している。</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Object obj </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">New</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">obj[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;foo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">New</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;bar&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status status;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value object, string;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">object);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  napi_throw_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, ...);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_string_utf8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;bar&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, NAPI_AUTO_LENGTH, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">string);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  napi_throw_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, ...);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_set_named_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, object, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;foo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, string);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  napi_throw_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, ...);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>その結果、アドオンはエクスポートされたC APIのみを使用することになる。その結果、C APIによって提供されるABIの安定性の恩恵を受けることができる。</p><p>C API の代わりに <code>node-addon-api</code> を使用する場合は、まず <code>node-addon-api</code> の API ドキュメントを参照してください。</p><p>Node-API Resource は Node-API と <code>node-addon-api</code> を使い始めたばかりの開発者のための優れたオリエンテーションとヒントを提供しています。その他のメディアリソースは Node-API Media ページにあります。</p><h2 id="abiの安定性の意味" tabindex="-1">ABIの安定性の意味 <a class="header-anchor" href="#abiの安定性の意味" aria-label="Permalink to &quot;ABIの安定性の意味&quot;">​</a></h2><p>Node-API は ABI の安定性を保証していますが、Node.js の他の部分は保証しておらず、アドオンから使用される外部ライブラリも保証していません。特に、以下の API はメジャーバージョン間での ABI 安定性を保証していません：</p><ul><li>以下のいずれかを介して利用可能な Node.js C++ API。</li></ul><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;node.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;node_buffer.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;node_version.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;node_object_wrap.h&gt;</span></span></code></pre></div><ul><li>libuv APIはNode.jsにも含まれており、以下を経由して利用可能です。</li></ul><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;uv.h&gt;</span></span></code></pre></div><ul><li>以下を介して利用可能なV8 APIです。</li></ul><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;v8.h&gt;</span></span></code></pre></div><p>したがって、Node.js のメジャーバージョン間でアドオンが ABI 互換性を保つには、Node-API を排他的に使用する必要があります。</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;node_api.h&gt;</span></span></code></pre></div><p>また、使用するすべての外部ライブラリについて、その外部ライブラリがNode-APIと同様のABI安定性を保証していることをチェックする。</p><h2 id="建物" tabindex="-1">建物 <a class="header-anchor" href="#建物" aria-label="Permalink to &quot;建物&quot;">​</a></h2><p>JavaScript で記述されたモジュールとは異なり、Node-API を使用して Node.js ネイティブアドオンを開発およびデプロイするには、追加のツールセットが必要です。Node.js 用の開発に必要な基本的なツールの他に、ネイティブアドオン開発者は、C および C++ コードをバイナリにコンパイルできるツールチェーンが必要です。さらに、ネイティブアドオンのデプロイ方法によっては、ネイティブアドオンの <em>user</em> にもC/C++ツールチェーンがインストールされている必要があります。</p><p>Linux開発者にとって、必要なC/C++ツールチェーンパッケージはすぐに入手できます。GCC は、Node.js コミュニティで、さまざまなプラットフォームのビルドとテストに広く使用されています。多くの開発者にとっては、LLVMコンパイラー・インフラストラクチャも良い選択だ。</p><p>Mac開発者にとっては、Xcodeが必要なコンパイラー・ツールをすべて提供している。しかし、Xcode IDE全体をインストールする必要はない。以下のコマンドは、必要なツールチェーンをインストールする：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">xcode-select</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --install</span></span></code></pre></div><p>Windows開発者にとって、Visual Studioは必要なコンパイラー・ツールをすべて提供している。ただし、Visual Studio IDE全体をインストールする必要はない。以下のコマンドは、必要なツールチェインをインストールします：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --global</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> windows-build-tools</span></span></code></pre></div><p>以下のセクションでは、Node.js ネイティブアドオンを開発およびデプロイするために利用可能な追加ツールについて説明します。</p><h3 id="build-tools" tabindex="-1">Build tools <a class="header-anchor" href="#build-tools" aria-label="Permalink to &quot;Build tools&quot;">​</a></h3><p>ここに挙げたツールはいずれも、ネイティブアドオンを正常にインストールするために、ネイティブアドオンの <em>user</em> がC/C++ツールチェーンをインストールしている必要があります。</p><h4 id="node-gyp" tabindex="-1">node-gyp <a class="header-anchor" href="#node-gyp" aria-label="Permalink to &quot;node-gyp&quot;">​</a></h4><p>node-gypは、GoogleのGYPツールのgyp-nextフォークをベースにしたビルドシステムで、npmにバンドルされている。GYP、したがってnode-gypはPythonがインストールされている必要があります。</p><p>歴史的に、node-gypはネイティブアドオンをビルドするためのツールとして選ばれてきました。node-gypは広く採用されており、ドキュメントも充実しています。しかし、一部の開発者はnode-gypの制限にぶつかっています。</p><h4 id="cmake-js" tabindex="-1">CMake.js <a class="header-anchor" href="#cmake-js" aria-label="Permalink to &quot;CMake.js&quot;">​</a></h4><p>CMake.jsはCMakeをベースにした代替ビルドシステムです。</p><p>CMake.jsは、すでにCMakeを使っているプロジェクトや、node-gypの制限に悩まされている開発者にとって良い選択です。</p><h3 id="コンパイル済みバイナリのアップロード" tabindex="-1">コンパイル済みバイナリのアップロード <a class="header-anchor" href="#コンパイル済みバイナリのアップロード" aria-label="Permalink to &quot;コンパイル済みバイナリのアップロード&quot;">​</a></h3><p>ここに挙げた3つのツールは、ネイティブアドオンの開発者やメンテナがバイナリを作成し、パブリックサーバやプライベートサーバにアップロードすることを可能にします。これらのツールは通常、Travis CIやAppVeyorのようなCI/CDビルドシステムと統合され、さまざまなプラットフォームやアーキテクチャ用のバイナリをビルドしてアップロードします。これらのバイナリは、C/C++ツールチェーンをインストールする必要のないユーザーがダウンロードできる。</p><h4 id="node-pre-gyp" tabindex="-1">node-pre-gyp <a class="header-anchor" href="#node-pre-gyp" aria-label="Permalink to &quot;node-pre-gyp&quot;">​</a></h4><p>node-pre-gypはnode-gypをベースにしたツールで、開発者が選択したサーバーにバイナリをアップロードする機能を追加したものです。node-pre-gypは特にAmazon S3へのバイナリのアップロードに優れています。</p><h4 id="prebuild" tabindex="-1">prebuild <a class="header-anchor" href="#prebuild" aria-label="Permalink to &quot;prebuild&quot;">​</a></h4><p>prebuild は node-gyp か CMake.js を使ったビルドをサポートするツールです。さまざまなサーバーをサポートする node-pre-gyp とは異なり、prebuild はバイナリを GitHub リリースにのみアップロードします。prebuild は、CMake.js を使う GitHub プロジェクトに向いています。</p><h4 id="prebuildify" tabindex="-1">prebuildify <a class="header-anchor" href="#prebuildify" aria-label="Permalink to &quot;prebuildify&quot;">​</a></h4><p>prebuildifyはnode-gypをベースにしたツールです。prebuildifyの利点は、ネイティブアドオンがnpmにアップロードされたときに、ビルドされたバイナリがバンドルされることです。バイナリは npm からダウンロードされ、ネイティブアドオンがインストールされると、モジュールユーザーがすぐに利用できるようになります。</p><h2 id="使用方法" tabindex="-1">使用方法 <a class="header-anchor" href="#使用方法" aria-label="Permalink to &quot;使用方法&quot;">​</a></h2><p>Node-API 関数を使用するには、node 開発ツリーの src ディレクトリにある <code>node_api.h</code> ファイルをインクルードします：</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;node_api.h&gt;</span></span></code></pre></div><p>これは Node.js の指定されたリリースのデフォルトの <code>NAPI_VERSION</code> になります。特定のバージョンの Node-API との互換性を確保するために、ヘッダをインクルードする際にバージョンを明示的に指定することができます：</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NAPI_VERSION</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;node_api.h&gt;</span></span></code></pre></div><p>これにより、Node-API サーフェスは、指定された（およびそれ以前の）バージョンで利用可能な機能のみに制限されます。</p><p>Node-API サーフェスの一部は実験的なもので、明示的なオプトインが必要です：</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NAPI_EXPERIMENTAL</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;node_api.h&gt;</span></span></code></pre></div><p>この場合、実験的なAPIを含むAPIサーフェス全体が、モジュールコードから利用可能になる。</p><h2 id="node-apiバージョンマトリックス" tabindex="-1">Node-APIバージョンマトリックス <a class="header-anchor" href="#node-apiバージョンマトリックス" aria-label="Permalink to &quot;Node-APIバージョンマトリックス&quot;">​</a></h2><p>Node-APIのバージョンはNode.jsとは独立に追加され、バージョン管理されます。バージョン 4 はバージョン 3 の拡張版で、バージョン 3 のすべての API にいくつかの機能が追加されています。これは、後のバージョンをサポートするようにリストされているNode.jsの新しいバージョン用に再コンパイルする必要がないことを意味します。</p><p>この表は、古いストリームでは最新ではないかもしれません。最新の情報は、最新のAPIドキュメントにあります：</p><p>Node-APIバージョンマトリックス</p><p>Node-APIは実験的なものだった。</p><p>Node.js 8.0.0はNode-APIを実験的なものとして含んでいました。Node-APIバージョン1としてリリースされましたが、Node.js 8.6.0まで進化し続けました。Node.js 8.6.0より前のバージョンではAPIが異なります。Node-APIバージョン3以降を推奨します。</p><p>Node-API でドキュメントされている各 API には <code>added in:</code> というヘッダが付き、安定した API には <code>Node-API version:</code> というヘッダが追加されます。API は <code>Node-API version:</code> 以降に示される Node-API バージョンをサポートする Node.js を使用している場合に直接使用できます。node_api.h<code>または</code>js_native_api.h<code>をインクルードする前に</code>#define NAPI_EXPERIMENTAL<code>を指定した場合のみ、API を利用することができる。もしAPIが</code>added in:\`で示されたものよりも後のNode.jsのバージョンで利用できないようであれば、それが利用できない理由である可能性が高い。</p><p>ネイティブコードから ECMAScript の機能にアクセスするための Node-API は <code>js_native_api.h</code> と <code>js_native_api_types.h</code> にあります。これらのヘッダで定義された API は <code>node_api.h</code> と <code>node_api_types.h</code> に含まれている。ヘッダーがこのような構造になっているのは、Node.js 以外で Node-API を実装できるようにするためです。これらの実装では、Node.js固有のAPIは適用できないかもしれません。</p><p>アドオンの Node.js 固有の部分は、実際の機能を JavaScript 環境に公開するコードから分離することができます。以下の例では、<code>addon.c</code> と <code>addon.h</code> は <code>js_native_api.h</code> のみを参照しています。これにより、<code>addon.c</code> は Node-API の Node.js 実装または Node.js 以外の Node-API 実装に対してコンパイルするために再利用することができる。</p><p><code>addon_node.c</code> は、Node.js 固有のアドオンのエントリーポイントを含む別のファイルで、アドオンが Node.js 環境にロードされたときに <code>addon.c</code> を呼び出してアドオンをインスタンス化します。</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// addon.h</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#ifndef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> _ADDON_H_</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> _ADDON_H_</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;js_native_api.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create_addon</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#endif</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // _ADDON_H_</span></span></code></pre></div><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// addon.c</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;addon.h&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NAPI_CALL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">call</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)                                      </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  do</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {                                                            </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    napi_status status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (call);                                  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) {                                      </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_extended_error_info</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> error_info </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;          </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      napi_get_last_error_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((env), </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">error_info);               </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err_message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> error_info-&gt;error_message;        </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> is_pending;                                            </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      napi_is_exception_pending</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((env), </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">is_pending);              </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">is_pending) {                                          </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (err_message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)               </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            ?</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;empty error message&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                               \\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            :</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err_message;                                        </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        napi_throw_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((env), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, message);                   </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;                                              </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }                                                           </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }                                                             </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_value</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DoSomethingUseful</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_callback_info </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Do something useful.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create_addon</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_value result;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  NAPI_CALL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_value exported_function;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  NAPI_CALL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                      &quot;doSomethingUseful&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                      NAPI_AUTO_LENGTH,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                      DoSomethingUseful,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                                      NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                      &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">exported_function));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  NAPI_CALL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_set_named_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                         result,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                         &quot;doSomethingUseful&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                         exported_function));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// addon_node.c</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;node_api.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;addon.h&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAPI_MODULE_INIT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // この関数本体は \`napi_value\` を返すことが期待されている。変数 \`napi_env env\` と \`napi_value exports\` は \`NAPI_MODULE_INIT()\` の定義で提供されているので、本体の中で使用することができる。</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> create_addon</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="環境ライフサイクルapi" tabindex="-1">環境ライフサイクルAPI <a class="header-anchor" href="#環境ライフサイクルapi" aria-label="Permalink to &quot;環境ライフサイクルAPI&quot;">​</a></h2><p>ECMAScript言語仕様のセクション8.7では、JavaScriptコードが実行される自己完結型の環境として &quot;Agent &quot;の概念を定義しています。そのような複数のエージェントは、プロセスによって同時または順番に開始および終了することができます。</p><p>Node.js 環境は ECMAScript エージェントに対応します。メインプロセスでは、起動時に環境が作成され、ワーカースレッドとして機能するように、別のスレッド上に追加の環境を作成することができます。Node.js が他のアプリケーションに組み込まれている場合、アプリケーションのメイン・スレッドは、アプリケーション・プロセスのライフ・サイクル中に複数回 Node.js 環境を構築および破棄することができ、アプリケーションによって作成された各 Node.js 環境は、そのライフ・サイクル中にワーカー・スレッドとしてさらに環境を作成および破棄することができます。</p><p>ネイティブ・アドオンから見ると、これは、それが提供するバインディングが、複数のコンテキストから、複数回呼び出される可能性があり、さらに複数のスレッドから同時に呼び出される可能性があることを意味します。</p><p>ネイティブアドオンは、Node.js 環境のライフサイクル中に使用するグローバルステートを割り当てる必要があります。</p><p>このため、Node-API は、そのライフサイクルが Node.js 環境のライフサイクルと連動するようにデータを関連付ける方法を提供します。</p><h3 id="napi-set-instance-data" tabindex="-1"><code>napi_set_instance_data</code> <a class="header-anchor" href="#napi-set-instance-data" aria-label="Permalink to &quot;\`napi_set_instance_data\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_set_instance_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                   void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   napi_finalize </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">finalize_cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                   void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> finalize_hint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: Node-API 呼び出しが呼び出される環境。</li><li><code>[in] data</code>: このインスタンスのバインディングが利用できるようにするデータ項目。</li><li><code>[in] finalize_cb</code>: 環境が取り壊されるときに呼び出される関数。この関数は <code>data</code> を受け取り、それを解放する。詳細は <code>napi_finalize</code> を参照すること。</li><li><code>[in] finalize_hint</code>: コレクション中にfinalizeコールバックに渡すオプションのヒント。</li></ul><p>APIが成功した場合は <code>napi_ok</code> を返す。</p><p>このAPIは <code>data</code> を現在実行中の Node.js 環境に関連付ける。<code>data</code> は後で <code>napi_get_instance_data()</code> を使用して取得することができる。以前に <code>napi_set_instance_data()</code> を呼び出して設定した、現在実行中の Node.js 環境に関連付けられた既存のデータは上書きされる。前の呼び出しで <code>finalize_cb</code> が指定されていた場合、それは呼び出されない。</p><h3 id="napi-get-instance-data" tabindex="-1"><code>napi_get_instance_data</code> <a class="header-anchor" href="#napi-get-instance-data" aria-label="Permalink to &quot;\`napi_get_instance_data\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_instance_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                   void**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: Node-API 呼び出しが呼び出される環境。</li><li><code>[out] data</code>: <code>napi_set_instance_data()</code>の呼び出しによって、以前に現在実行中のNode.js環境に関連付けられたデータ項目。</li></ul><p>APIが成功した場合は <code>napi_ok</code> を返す。</p><p>このAPIは、<code>napi_set_instance_data()</code> によって現在実行中のNode.js環境に関連付けられたデータを取得する。データが設定されていない場合、呼び出しは成功し、<code>data</code> には <code>NULL</code> が設定される。</p><h2 id="node-apiの基本データ型" tabindex="-1">Node-APIの基本データ型 <a class="header-anchor" href="#node-apiの基本データ型" aria-label="Permalink to &quot;Node-APIの基本データ型&quot;">​</a></h2><p>Node-API は様々な API によって消費される抽象化として、以下の基本的なデータ型を 公開します。これらの API は不透明なものとして扱われ、他の Node-API 呼び出しでのみイントロスペクト可能です。</p><h3 id="napi-status" tabindex="-1"><code>napi_status</code> <a class="header-anchor" href="#napi-status" aria-label="Permalink to &quot;\`napi_status\`&quot;">​</a></h3><p>Node-API 呼び出しの成功または失敗を示す整数ステータスコード。現在、以下のステータスコードがサポートされている。</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_ok,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_invalid_arg,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_object_expected,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_string_expected,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_name_expected,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_function_expected,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_number_expected,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_boolean_expected,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_array_expected,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_generic_failure,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_pending_exception,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_cancelled,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_escape_called_twice,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_handle_scope_mismatch,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_callback_scope_mismatch,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_queue_full,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_closing,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_bigint_expected,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_date_expected,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_arraybuffer_expected,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_detachable_arraybuffer_expected,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_would_deadlock,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /* unused */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_no_external_buffers_allowed,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_cannot_run_js</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} napi_status;</span></span></code></pre></div><p>APIが失敗したステータスを返したときに追加情報が必要であれば、<code>napi_get_last_error_info</code> を呼び出して取得することができる。</p><h3 id="napi-extended-error-info" tabindex="-1"><code>napi_extended_error_info</code> <a class="header-anchor" href="#napi-extended-error-info" aria-label="Permalink to &quot;\`napi_extended_error_info\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> error_message;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> engine_reserved;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  uint32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> engine_error_code;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_status error_code;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} napi_extended_error_info;</span></span></code></pre></div><ul><li><code>error_message</code>: UTF8エンコードされた文字列で、VMに依存しないエラーの説明を含む。</li><li><code>engine_reserved</code>: VM固有のエラー詳細のために予約されている。これは現在、どのVMにも実装されていない。</li><li><code>engine_error_code</code>: VM固有のエラーコード。これは現在、どのVMにも実装されていない。</li><li><code>error_code</code>: 最後のエラーで発生した Node-API ステータスコード。</li></ul><p>詳細については、エラー処理のセクションを参照してください。</p><h3 id="napi-env" tabindex="-1"><code>napi_env</code> <a class="header-anchor" href="#napi-env" aria-label="Permalink to &quot;\`napi_env\`&quot;">​</a></h3><p><code>napi_env</code> は、基礎となる Node-API 実装が VM 固有の状態を保持するために使用できるコンテキストを表すために使用されます。この構造体は、ネイティブ関数が呼び出されるときに渡され、Node-API を呼び出すときには、それを返さなければならない。具体的には、最初のネイティブ関数が呼び出されたときに渡された <code>napi_env</code> と同じものが、それ以降のネストされた Node-API 呼び出しにも渡されなければならない。一般的な再利用を目的とした <code>napi_env</code> のキャッシュや、異なる <code>Worker</code> スレッド上で動作する同じアドオンのインスタンス間で <code>napi_env</code> を渡すことは許可されていません。<code>napi_env</code> はネイティブアドオンのインスタンスがアンロードされると無効になる。このイベントの通知は <code>napi_add_env_cleanup_hook</code> と <code>napi_set_instance_data</code> のコールバックを通して行われる。</p><h3 id="napi-value" tabindex="-1"><code>napi_value</code> <a class="header-anchor" href="#napi-value" aria-label="Permalink to &quot;\`napi_value\`&quot;">​</a></h3><p>これはJavaScriptの値を表すのに使われる不透明なポインタである。</p><h3 id="napi-threadsafe-function" tabindex="-1"><code>napi_threadsafe_function</code> <a class="header-anchor" href="#napi-threadsafe-function" aria-label="Permalink to &quot;\`napi_threadsafe_function\`&quot;">​</a></h3><p>これは、<code>napi_call_threadsafe_function()</code>によって複数のスレッドから非同期に呼び出すことができるJavaScript関数を表す不透明なポインタです。</p><h3 id="napi-threadsafe-function-release-mode" tabindex="-1"><code>napi_threadsafe_function_release_mode</code> <a class="header-anchor" href="#napi-threadsafe-function-release-mode" aria-label="Permalink to &quot;\`napi_threadsafe_function_release_mode\`&quot;">​</a></h3><p><code>napi_release_threadsafe_function()</code> に与える値で、スレッドセーフ関数を直ちに閉じる (<code>napi_tsfn_abort</code>) か、単に解放する (<code>napi_tsfn_release</code>) かを指定する。</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_tsfn_release,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_tsfn_abort</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} napi_threadsafe_function_release_mode;</span></span></code></pre></div><h3 id="napi-threadsafe-function-call-mode" tabindex="-1"><code>napi_threadsafe_function_call_mode</code> <a class="header-anchor" href="#napi-threadsafe-function-call-mode" aria-label="Permalink to &quot;\`napi_threadsafe_function_call_mode\`&quot;">​</a></h3><p>A value to be given to <code>napi_call_threadsafe_function()</code> to indicate whether the call should block whenever the queue associated with the thread-safe function is full.</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_tsfn_nonblocking,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_tsfn_blocking</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} napi_threadsafe_function_call_mode;</span></span></code></pre></div><h3 id="node-api-memory-management-types" tabindex="-1">Node-API memory management types <a class="header-anchor" href="#node-api-memory-management-types" aria-label="Permalink to &quot;Node-API memory management types&quot;">​</a></h3><h4 id="napi-handle-scope" tabindex="-1"><code>napi_handle_scope</code> <a class="header-anchor" href="#napi-handle-scope" aria-label="Permalink to &quot;\`napi_handle_scope\`&quot;">​</a></h4><p>This is an abstraction used to control and modify the lifetime of objects created within a particular scope. In general, Node-API values are created within the context of a handle scope. When a native method is called from JavaScript, a default handle scope will exist. If the user does not explicitly create a new handle scope, Node-API values will be created in the default handle scope. For any invocations of code outside the execution of a native method (for instance, during a libuv callback invocation), the module is required to create a scope before invoking any functions that can result in the creation of JavaScript values.</p><p>Handle scopes are created using <code>napi_open_handle_scope</code> and are destroyed using <code>napi_close_handle_scope</code>. Closing the scope can indicate to the GC that all <code>napi_value</code>s created during the lifetime of the handle scope are no longer referenced from the current stack frame.</p><p>For more details, review the Object lifetime management.</p><h4 id="napi-escapable-handle-scope" tabindex="-1"><code>napi_escapable_handle_scope</code> <a class="header-anchor" href="#napi-escapable-handle-scope" aria-label="Permalink to &quot;\`napi_escapable_handle_scope\`&quot;">​</a></h4><p>Escapable handle scopes are a special type of handle scope to return values created within a particular handle scope to a parent scope.</p><h4 id="napi-ref" tabindex="-1"><code>napi_ref</code> <a class="header-anchor" href="#napi-ref" aria-label="Permalink to &quot;\`napi_ref\`&quot;">​</a></h4><p>This is the abstraction to use to reference a <code>napi_value</code>. This allows for users to manage the lifetimes of JavaScript values, including defining their minimum lifetimes explicitly.</p><p>For more details, review the Object lifetime management.</p><h4 id="napi-type-tag" tabindex="-1"><code>napi_type_tag</code> <a class="header-anchor" href="#napi-type-tag" aria-label="Permalink to &quot;\`napi_type_tag\`&quot;">​</a></h4><p>A 128-bit value stored as two unsigned 64-bit integers. It serves as a UUID with which JavaScript objects or externals can be &quot;tagged&quot; in order to ensure that they are of a certain type. This is a stronger check than <code>napi_instanceof</code>, because the latter can report a false positive if the object&#39;s prototype has been manipulated. Type-tagging is most useful in conjunction with <code>napi_wrap</code> because it ensures that the pointer retrieved from a wrapped object can be safely cast to the native type corresponding to the type tag that had been previously applied to the JavaScript object.</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  uint64_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lower;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  uint64_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> upper;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} napi_type_tag;</span></span></code></pre></div><h4 id="napi-async-cleanup-hook-handle" tabindex="-1"><code>napi_async_cleanup_hook_handle</code> <a class="header-anchor" href="#napi-async-cleanup-hook-handle" aria-label="Permalink to &quot;\`napi_async_cleanup_hook_handle\`&quot;">​</a></h4><p>An opaque value returned by <code>napi_add_async_cleanup_hook</code>. It must be passed to <code>napi_remove_async_cleanup_hook</code> when the chain of asynchronous cleanup events completes.</p><h3 id="node-api-callback-types" tabindex="-1">Node-API callback types <a class="header-anchor" href="#node-api-callback-types" aria-label="Permalink to &quot;Node-API callback types&quot;">​</a></h3><h4 id="napi-callback-info" tabindex="-1"><code>napi_callback_info</code> <a class="header-anchor" href="#napi-callback-info" aria-label="Permalink to &quot;\`napi_callback_info\`&quot;">​</a></h4><p>Opaque datatype that is passed to a callback function. It can be used for getting additional information about the context in which the callback was invoked.</p><h4 id="napi-callback" tabindex="-1"><code>napi_callback</code> <a class="header-anchor" href="#napi-callback" aria-label="Permalink to &quot;\`napi_callback\`&quot;">​</a></h4><p>Function pointer type for user-provided native functions which are to be exposed to JavaScript via Node-API. Callback functions should satisfy the following signature:</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">napi_callback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)(napi_env, napi_callback_info);</span></span></code></pre></div><p>Unless for reasons discussed in Object Lifetime Management, creating a handle and/or callback scope inside a <code>napi_callback</code> is not necessary.</p><h4 id="napi-finalize" tabindex="-1"><code>napi_finalize</code> <a class="header-anchor" href="#napi-finalize" aria-label="Permalink to &quot;\`napi_finalize\`&quot;">​</a></h4><p>Function pointer type for add-on provided functions that allow the user to be notified when externally-owned data is ready to be cleaned up because the object with which it was associated with has been garbage-collected. The user must provide a function satisfying the following signature which would get called upon the object&#39;s collection. Currently, <code>napi_finalize</code> can be used for finding out when objects that have external data are collected.</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_finalize)(napi_env env,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                              void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> finalize_data,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                              void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> finalize_hint);</span></span></code></pre></div><p>Unless for reasons discussed in Object Lifetime Management, creating a handle and/or callback scope inside the function body is not necessary.</p><p>Since these functions may be called while the JavaScript engine is in a state where it cannot execute JavaScript code, some Node-API calls may return <code>napi_pending_exception</code> even when there is no exception pending.</p><p>In the case of <code>node_api_create_external_string_latin1</code> and <code>node_api_create_external_string_utf16</code> the <code>env</code> parameter may be null, because external strings can be collected during the latter part of environment shutdown.</p><p>Change History:</p><ul><li><p>experimental (<code>NAPI_EXPERIMENTAL</code> is defined):</p><p>Node-API calls made from a finalizer will return <code>napi_cannot_run_js</code> when the JavaScript engine is unable to execute JavaScript, and will return <code>napi_exception_pending</code> if there is a pending exception.</p></li></ul><h4 id="napi-async-execute-callback" tabindex="-1"><code>napi_async_execute_callback</code> <a class="header-anchor" href="#napi-async-execute-callback" aria-label="Permalink to &quot;\`napi_async_execute_callback\`&quot;">​</a></h4><p>Function pointer used with functions that support asynchronous operations. Callback functions must satisfy the following signature:</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_async_execute_callback)(napi_env env, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data);</span></span></code></pre></div><p>Implementations of this function must avoid making Node-API calls that execute JavaScript or interact with JavaScript objects. Node-API calls should be in the <code>napi_async_complete_callback</code> instead. Do not use the <code>napi_env</code> parameter as it will likely result in execution of JavaScript.</p><h4 id="napi-async-complete-callback" tabindex="-1"><code>napi_async_complete_callback</code> <a class="header-anchor" href="#napi-async-complete-callback" aria-label="Permalink to &quot;\`napi_async_complete_callback\`&quot;">​</a></h4><p>Function pointer used with functions that support asynchronous operations. Callback functions must satisfy the following signature:</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_async_complete_callback)(napi_env env,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                             napi_status status,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                             void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data);</span></span></code></pre></div><p>Unless for reasons discussed in Object Lifetime Management, creating a handle and/or callback scope inside the function body is not necessary.</p><h4 id="napi-threadsafe-function-call-js" tabindex="-1"><code>napi_threadsafe_function_call_js</code> <a class="header-anchor" href="#napi-threadsafe-function-call-js" aria-label="Permalink to &quot;\`napi_threadsafe_function_call_js\`&quot;">​</a></h4><p>Function pointer used with asynchronous thread-safe function calls. The callback will be called on the main thread. Its purpose is to use a data item arriving via the queue from one of the secondary threads to construct the parameters necessary for a call into JavaScript, usually via <code>napi_call_function</code>, and then make the call into JavaScript.</p><p>The data arriving from the secondary thread via the queue is given in the <code>data</code> parameter and the JavaScript function to call is given in the <code>js_callback</code> parameter.</p><p>Node-API sets up the environment prior to calling this callback, so it is sufficient to call the JavaScript function via <code>napi_call_function</code> rather than via <code>napi_make_callback</code>.</p><p>Callback functions must satisfy the following signature:</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_threadsafe_function_call_js)(napi_env env,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                 napi_value js_callback,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                 void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> context,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                 void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment to use for API calls, or <code>NULL</code> if the thread-safe function is being torn down and <code>data</code> may need to be freed.</li><li><code>[in] js_callback</code>: The JavaScript function to call, or <code>NULL</code> if the thread-safe function is being torn down and <code>data</code> may need to be freed. It may also be <code>NULL</code> if the thread-safe function was created without <code>js_callback</code>.</li><li><code>[in] context</code>: The optional data with which the thread-safe function was created.</li><li><code>[in] data</code>: Data created by the secondary thread. It is the responsibility of the callback to convert this native data to JavaScript values (with Node-API functions) that can be passed as parameters when <code>js_callback</code> is invoked. This pointer is managed entirely by the threads and this callback. Thus this callback should free the data.</li></ul><p>Unless for reasons discussed in Object Lifetime Management, creating a handle and/or callback scope inside the function body is not necessary.</p><h4 id="napi-cleanup-hook" tabindex="-1"><code>napi_cleanup_hook</code> <a class="header-anchor" href="#napi-cleanup-hook" aria-label="Permalink to &quot;\`napi_cleanup_hook\`&quot;">​</a></h4><p>Function pointer used with <code>napi_add_env_cleanup_hook</code>. It will be called when the environment is being torn down.</p><p>Callback functions must satisfy the following signature:</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_cleanup_hook)(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data);</span></span></code></pre></div><ul><li><code>[in] data</code>: The data that was passed to <code>napi_add_env_cleanup_hook</code>.</li></ul><h4 id="napi-async-cleanup-hook" tabindex="-1"><code>napi_async_cleanup_hook</code> <a class="header-anchor" href="#napi-async-cleanup-hook" aria-label="Permalink to &quot;\`napi_async_cleanup_hook\`&quot;">​</a></h4><p>Function pointer used with <code>napi_add_async_cleanup_hook</code>. It will be called when the environment is being torn down.</p><p>Callback functions must satisfy the following signature:</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_async_cleanup_hook)(napi_async_cleanup_hook_handle handle,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                        void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data);</span></span></code></pre></div><ul><li><code>[in] handle</code>: The handle that must be passed to <code>napi_remove_async_cleanup_hook</code> after completion of the asynchronous cleanup.</li><li><code>[in] data</code>: The data that was passed to <code>napi_add_async_cleanup_hook</code>.</li></ul><p>The body of the function should initiate the asynchronous cleanup actions at the end of which <code>handle</code> must be passed in a call to <code>napi_remove_async_cleanup_hook</code>.</p><h2 id="error-handling" tabindex="-1">Error handling <a class="header-anchor" href="#error-handling" aria-label="Permalink to &quot;Error handling&quot;">​</a></h2><p>Node-API uses both return values and JavaScript exceptions for error handling. The following sections explain the approach for each case.</p><h3 id="return-values" tabindex="-1">Return values <a class="header-anchor" href="#return-values" aria-label="Permalink to &quot;Return values&quot;">​</a></h3><p>All of the Node-API functions share the same error handling pattern. The return type of all API functions is <code>napi_status</code>.</p><p>The return value will be <code>napi_ok</code> if the request was successful and no uncaught JavaScript exception was thrown. If an error occurred AND an exception was thrown, the <code>napi_status</code> value for the error will be returned. If an exception was thrown, and no error occurred, <code>napi_pending_exception</code> will be returned.</p><p>In cases where a return value other than <code>napi_ok</code> or <code>napi_pending_exception</code> is returned, <code>napi_is_exception_pending</code> must be called to check if an exception is pending. See the section on exceptions for more details.</p><p>The full set of possible <code>napi_status</code> values is defined in <code>napi_api_types.h</code>.</p><p>The <code>napi_status</code> return value provides a VM-independent representation of the error which occurred. In some cases it is useful to be able to get more detailed information, including a string representing the error as well as VM (engine)-specific information.</p><p>In order to retrieve this information <code>napi_get_last_error_info</code> is provided which returns a <code>napi_extended_error_info</code> structure. The format of the <code>napi_extended_error_info</code> structure is as follows:</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_extended_error_info {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> error_message;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> engine_reserved;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  uint32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> engine_error_code;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_status error_code;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div><ul><li><code>error_message</code>: Textual representation of the error that occurred.</li><li><code>engine_reserved</code>: Opaque handle reserved for engine use only.</li><li><code>engine_error_code</code>: VM specific error code.</li><li><code>error_code</code>: Node-API status code for the last error.</li></ul><p><code>napi_get_last_error_info</code> returns the information for the last Node-API call that was made.</p><p>Do not rely on the content or format of any of the extended information as it is not subject to SemVer and may change at any time. It is intended only for logging purposes.</p><h4 id="napi-get-last-error-info" tabindex="-1"><code>napi_get_last_error_info</code> <a class="header-anchor" href="#napi-get-last-error-info" aria-label="Permalink to &quot;\`napi_get_last_error_info\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_last_error_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                         const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_extended_error_info</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[out] result</code>: The <code>napi_extended_error_info</code> structure with more information about the error.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API retrieves a <code>napi_extended_error_info</code> structure with information about the last error that occurred.</p><p>The content of the <code>napi_extended_error_info</code> returned is only valid up until a Node-API function is called on the same <code>env</code>. This includes a call to <code>napi_is_exception_pending</code> so it may often be necessary to make a copy of the information so that it can be used later. The pointer returned in <code>error_message</code> points to a statically-defined string so it is safe to use that pointer if you have copied it out of the <code>error_message</code> field (which will be overwritten) before another Node-API function was called.</p><p>Do not rely on the content or format of any of the extended information as it is not subject to SemVer and may change at any time. It is intended only for logging purposes.</p><p>This API can be called even if there is a pending JavaScript exception.</p><h3 id="exceptions" tabindex="-1">Exceptions <a class="header-anchor" href="#exceptions" aria-label="Permalink to &quot;Exceptions&quot;">​</a></h3><p>Any Node-API function call may result in a pending JavaScript exception. This is the case for any of the API functions, even those that may not cause the execution of JavaScript.</p><p>If the <code>napi_status</code> returned by a function is <code>napi_ok</code> then no exception is pending and no additional action is required. If the <code>napi_status</code> returned is anything other than <code>napi_ok</code> or <code>napi_pending_exception</code>, in order to try to recover and continue instead of simply returning immediately, <code>napi_is_exception_pending</code> must be called in order to determine if an exception is pending or not.</p><p>In many cases when a Node-API function is called and an exception is already pending, the function will return immediately with a <code>napi_status</code> of <code>napi_pending_exception</code>. However, this is not the case for all functions. Node-API allows a subset of the functions to be called to allow for some minimal cleanup before returning to JavaScript. In that case, <code>napi_status</code> will reflect the status for the function. It will not reflect previous pending exceptions. To avoid confusion, check the error status after every function call.</p><p>When an exception is pending one of two approaches can be employed.</p><p>The first approach is to do any appropriate cleanup and then return so that execution will return to JavaScript. As part of the transition back to JavaScript, the exception will be thrown at the point in the JavaScript code where the native method was invoked. The behavior of most Node-API calls is unspecified while an exception is pending, and many will simply return <code>napi_pending_exception</code>, so do as little as possible and then return to JavaScript where the exception can be handled.</p><p>The second approach is to try to handle the exception. There will be cases where the native code can catch the exception, take the appropriate action, and then continue. This is only recommended in specific cases where it is known that the exception can be safely handled. In these cases <code>napi_get_and_clear_last_exception</code> can be used to get and clear the exception. On success, result will contain the handle to the last JavaScript <code>Object</code> thrown. If it is determined, after retrieving the exception, the exception cannot be handled after all it can be re-thrown it with <code>napi_throw</code> where error is the JavaScript value to be thrown.</p><p>The following utility functions are also available in case native code needs to throw an exception or determine if a <code>napi_value</code> is an instance of a JavaScript <code>Error</code> object: <code>napi_throw_error</code>, <code>napi_throw_type_error</code>, <code>napi_throw_range_error</code>, <code>node_api_throw_syntax_error</code> and <code>napi_is_error</code>.</p><p>The following utility functions are also available in case native code needs to create an <code>Error</code> object: <code>napi_create_error</code>, <code>napi_create_type_error</code>, <code>napi_create_range_error</code> and <code>node_api_create_syntax_error</code>, where result is the <code>napi_value</code> that refers to the newly created JavaScript <code>Error</code> object.</p><p>The Node.js project is adding error codes to all of the errors generated internally. The goal is for applications to use these error codes for all error checking. The associated error messages will remain, but will only be meant to be used for logging and display with the expectation that the message can change without SemVer applying. In order to support this model with Node-API, both in internal functionality and for module specific functionality (as its good practice), the <code>throw_</code> and <code>create_</code> functions take an optional code parameter which is the string for the code to be added to the error object. If the optional parameter is <code>NULL</code> then no code will be associated with the error. If a code is provided, the name associated with the error is also updated to be:</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>originalName [code]</span></span></code></pre></div><p>where <code>originalName</code> is the original name associated with the error and <code>code</code> is the code that was provided. For example, if the code is <code>&#39;ERR_ERROR_1&#39;</code> and a <code>TypeError</code> is being created the name will be:</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>TypeError [ERR_ERROR_1]</span></span></code></pre></div><h4 id="napi-throw" tabindex="-1"><code>napi_throw</code> <a class="header-anchor" href="#napi-throw" aria-label="Permalink to &quot;\`napi_throw\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] error</code>: The JavaScript value to be thrown.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API throws the JavaScript value provided.</p><h4 id="napi-throw-error" tabindex="-1"><code>napi_throw_error</code> <a class="header-anchor" href="#napi-throw-error" aria-label="Permalink to &quot;\`napi_throw_error\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_throw_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                         const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> code</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                         const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] code</code>: Optional error code to be set on the error.</li><li><code>[in] msg</code>: C string representing the text to be associated with the error.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API throws a JavaScript <code>Error</code> with the text provided.</p><h4 id="napi-throw-type-error" tabindex="-1"><code>napi_throw_type_error</code> <a class="header-anchor" href="#napi-throw-type-error" aria-label="Permalink to &quot;\`napi_throw_type_error\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_throw_type_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                              const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> code</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                              const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] code</code>: Optional error code to be set on the error.</li><li><code>[in] msg</code>: C string representing the text to be associated with the error.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API throws a JavaScript <code>TypeError</code> with the text provided.</p><h4 id="napi-throw-range-error" tabindex="-1"><code>napi_throw_range_error</code> <a class="header-anchor" href="#napi-throw-range-error" aria-label="Permalink to &quot;\`napi_throw_range_error\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_throw_range_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                               const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> code</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                               const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] code</code>: Optional error code to be set on the error.</li><li><code>[in] msg</code>: C string representing the text to be associated with the error.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API throws a JavaScript <code>RangeError</code> with the text provided.</p><h4 id="node-api-throw-syntax-error" tabindex="-1"><code>node_api_throw_syntax_error</code> <a class="header-anchor" href="#node-api-throw-syntax-error" aria-label="Permalink to &quot;\`node_api_throw_syntax_error\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node_api_throw_syntax_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                    const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> code</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                    const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] code</code>: Optional error code to be set on the error.</li><li><code>[in] msg</code>: C string representing the text to be associated with the error.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API throws a JavaScript <code>SyntaxError</code> with the text provided.</p><h4 id="napi-is-error" tabindex="-1"><code>napi_is_error</code> <a class="header-anchor" href="#napi-is-error" aria-label="Permalink to &quot;\`napi_is_error\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_is_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                      napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                      bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: The <code>napi_value</code> to be checked.</li><li><code>[out] result</code>: Boolean value that is set to true if <code>napi_value</code> represents an error, false otherwise.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API queries a <code>napi_value</code> to check if it represents an error object.</p><h4 id="napi-create-error" tabindex="-1"><code>napi_create_error</code> <a class="header-anchor" href="#napi-create-error" aria-label="Permalink to &quot;\`napi_create_error\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                          napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">code</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                          napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                          napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] code</code>: Optional <code>napi_value</code> with the string for the error code to be associated with the error.</li><li><code>[in] msg</code>: <code>napi_value</code> that references a JavaScript <code>string</code> to be used as the message for the <code>Error</code>.</li><li><code>[out] result</code>: <code>napi_value</code> representing the error created.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API returns a JavaScript <code>Error</code> with the text provided.</p><h4 id="napi-create-type-error" tabindex="-1"><code>napi_create_type_error</code> <a class="header-anchor" href="#napi-create-type-error" aria-label="Permalink to &quot;\`napi_create_type_error\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_type_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                               napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">code</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                               napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                               napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] code</code>: Optional <code>napi_value</code> with the string for the error code to be associated with the error.</li><li><code>[in] msg</code>: <code>napi_value</code> that references a JavaScript <code>string</code> to be used as the message for the <code>Error</code>.</li><li><code>[out] result</code>: <code>napi_value</code> representing the error created.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API returns a JavaScript <code>TypeError</code> with the text provided.</p><h4 id="napi-create-range-error" tabindex="-1"><code>napi_create_range_error</code> <a class="header-anchor" href="#napi-create-range-error" aria-label="Permalink to &quot;\`napi_create_range_error\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_range_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">code</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] code</code>: Optional <code>napi_value</code> with the string for the error code to be associated with the error.</li><li><code>[in] msg</code>: <code>napi_value</code> that references a JavaScript <code>string</code> to be used as the message for the <code>Error</code>.</li><li><code>[out] result</code>: <code>napi_value</code> representing the error created.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API returns a JavaScript <code>RangeError</code> with the text provided.</p><h4 id="node-api-create-syntax-error" tabindex="-1"><code>node_api_create_syntax_error</code> <a class="header-anchor" href="#node-api-create-syntax-error" aria-label="Permalink to &quot;\`node_api_create_syntax_error\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node_api_create_syntax_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                     napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">code</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                     napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                     napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] code</code>: Optional <code>napi_value</code> with the string for the error code to be associated with the error.</li><li><code>[in] msg</code>: <code>napi_value</code> that references a JavaScript <code>string</code> to be used as the message for the <code>Error</code>.</li><li><code>[out] result</code>: <code>napi_value</code> representing the error created.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API returns a JavaScript <code>SyntaxError</code> with the text provided.</p><h4 id="napi-get-and-clear-last-exception" tabindex="-1"><code>napi_get_and_clear_last_exception</code> <a class="header-anchor" href="#napi-get-and-clear-last-exception" aria-label="Permalink to &quot;\`napi_get_and_clear_last_exception\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_and_clear_last_exception</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                              napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[out] result</code>: The exception if one is pending, <code>NULL</code> otherwise.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API can be called even if there is a pending JavaScript exception.</p><h4 id="napi-is-exception-pending" tabindex="-1"><code>napi_is_exception_pending</code> <a class="header-anchor" href="#napi-is-exception-pending" aria-label="Permalink to &quot;\`napi_is_exception_pending\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_is_exception_pending</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[out] result</code>: Boolean value that is set to true if an exception is pending.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API can be called even if there is a pending JavaScript exception.</p><h4 id="napi-fatal-exception" tabindex="-1"><code>napi_fatal_exception</code> <a class="header-anchor" href="#napi-fatal-exception" aria-label="Permalink to &quot;\`napi_fatal_exception\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_fatal_exception</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] err</code>: The error that is passed to <code>&#39;uncaughtException&#39;</code>.</li></ul><p>Trigger an <code>&#39;uncaughtException&#39;</code> in JavaScript. Useful if an async callback throws an exception with no way to recover.</p><h3 id="fatal-errors" tabindex="-1">Fatal errors <a class="header-anchor" href="#fatal-errors" aria-label="Permalink to &quot;Fatal errors&quot;">​</a></h3><p>In the event of an unrecoverable error in a native addon, a fatal error can be thrown to immediately terminate the process.</p><h4 id="napi-fatal-error" tabindex="-1"><code>napi_fatal_error</code> <a class="header-anchor" href="#napi-fatal-error" aria-label="Permalink to &quot;\`napi_fatal_error\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_NO_RETURN </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_fatal_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> location</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                     size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> location_len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                     const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                     size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> message_len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] location</code>: Optional location at which the error occurred.</li><li><code>[in] location_len</code>: The length of the location in bytes, or <code>NAPI_AUTO_LENGTH</code> if it is null-terminated.</li><li><code>[in] message</code>: The message associated with the error.</li><li><code>[in] message_len</code>: The length of the message in bytes, or <code>NAPI_AUTO_LENGTH</code> if it is null-terminated.</li></ul><p>The function call does not return, the process will be terminated.</p><p>This API can be called even if there is a pending JavaScript exception.</p><h2 id="object-lifetime-management" tabindex="-1">Object lifetime management <a class="header-anchor" href="#object-lifetime-management" aria-label="Permalink to &quot;Object lifetime management&quot;">​</a></h2><p>As Node-API calls are made, handles to objects in the heap for the underlying VM may be returned as <code>napi_values</code>. These handles must hold the objects &#39;live&#39; until they are no longer required by the native code, otherwise the objects could be collected before the native code was finished using them.</p><p>As object handles are returned they are associated with a &#39;scope&#39;. The lifespan for the default scope is tied to the lifespan of the native method call. The result is that, by default, handles remain valid and the objects associated with these handles will be held live for the lifespan of the native method call.</p><p>In many cases, however, it is necessary that the handles remain valid for either a shorter or longer lifespan than that of the native method. The sections which follow describe the Node-API functions that can be used to change the handle lifespan from the default.</p><h3 id="making-handle-lifespan-shorter-than-that-of-the-native-method" tabindex="-1">Making handle lifespan shorter than that of the native method <a class="header-anchor" href="#making-handle-lifespan-shorter-than-that-of-the-native-method" aria-label="Permalink to &quot;Making handle lifespan shorter than that of the native method&quot;">​</a></h3><p>It is often necessary to make the lifespan of handles shorter than the lifespan of a native method. For example, consider a native method that has a loop which iterates through the elements in a large array:</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1000000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_value result;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_status status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_get_element</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, object, i, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // do something with element</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>This would result in a large number of handles being created, consuming substantial resources. In addition, even though the native code could only use the most recent handle, all of the associated objects would also be kept alive since they all share the same scope.</p><p>To handle this case, Node-API provides the ability to establish a new &#39;scope&#39; to which newly created handles will be associated. Once those handles are no longer required, the scope can be &#39;closed&#39; and any handles associated with the scope are invalidated. The methods available to open/close scopes are <code>napi_open_handle_scope</code> and <code>napi_close_handle_scope</code>.</p><p>Node-API only supports a single nested hierarchy of scopes. There is only one active scope at any time, and all new handles will be associated with that scope while it is active. Scopes must be closed in the reverse order from which they are opened. In addition, all scopes created within a native method must be closed before returning from that method.</p><p>Taking the earlier example, adding calls to <code>napi_open_handle_scope</code> and <code>napi_close_handle_scope</code> would ensure that at most a single handle is valid throughout the execution of the loop:</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1000000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_handle_scope scope;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_status status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_open_handle_scope</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scope);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_value result;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_get_element</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, object, i, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // do something with element</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_close_handle_scope</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, scope);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>When nesting scopes, there are cases where a handle from an inner scope needs to live beyond the lifespan of that scope. Node-API supports an &#39;escapable scope&#39; in order to support this case. An escapable scope allows one handle to be &#39;promoted&#39; so that it &#39;escapes&#39; the current scope and the lifespan of the handle changes from the current scope to that of the outer scope.</p><p>The methods available to open/close escapable scopes are <code>napi_open_escapable_handle_scope</code> and <code>napi_close_escapable_handle_scope</code>.</p><p>The request to promote a handle is made through <code>napi_escape_handle</code> which can only be called once.</p><h4 id="napi-open-handle-scope" tabindex="-1"><code>napi_open_handle_scope</code> <a class="header-anchor" href="#napi-open-handle-scope" aria-label="Permalink to &quot;\`napi_open_handle_scope\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_open_handle_scope</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                               napi_handle_scope</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[out] result</code>: <code>napi_value</code> representing the new scope.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API opens a new scope.</p><h4 id="napi-close-handle-scope" tabindex="-1"><code>napi_close_handle_scope</code> <a class="header-anchor" href="#napi-close-handle-scope" aria-label="Permalink to &quot;\`napi_close_handle_scope\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_close_handle_scope</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                napi_handle_scope </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">scope</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] scope</code>: <code>napi_value</code> representing the scope to be closed.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API closes the scope passed in. Scopes must be closed in the reverse order from which they were created.</p><p>This API can be called even if there is a pending JavaScript exception.</p><h4 id="napi-open-escapable-handle-scope" tabindex="-1"><code>napi_open_escapable_handle_scope</code> <a class="header-anchor" href="#napi-open-escapable-handle-scope" aria-label="Permalink to &quot;\`napi_open_escapable_handle_scope\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    napi_open_escapable_handle_scope</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                     napi_handle_scope</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[out] result</code>: <code>napi_value</code> representing the new scope.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API opens a new scope from which one object can be promoted to the outer scope.</p><h4 id="napi-close-escapable-handle-scope" tabindex="-1"><code>napi_close_escapable_handle_scope</code> <a class="header-anchor" href="#napi-close-escapable-handle-scope" aria-label="Permalink to &quot;\`napi_close_escapable_handle_scope\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    napi_close_escapable_handle_scope</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                      napi_handle_scope </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">scope</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] scope</code>: <code>napi_value</code> representing the scope to be closed.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API closes the scope passed in. Scopes must be closed in the reverse order from which they were created.</p><p>This API can be called even if there is a pending JavaScript exception.</p><h4 id="napi-escape-handle" tabindex="-1"><code>napi_escape_handle</code> <a class="header-anchor" href="#napi-escape-handle" aria-label="Permalink to &quot;\`napi_escape_handle\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_escape_handle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               napi_escapable_handle_scope </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">scope</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">escapee</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] scope</code>: <code>napi_value</code> representing the current scope.</li><li><code>[in] escapee</code>: <code>napi_value</code> representing the JavaScript <code>Object</code> to be escaped.</li><li><code>[out] result</code>: <code>napi_value</code> representing the handle to the escaped <code>Object</code> in the outer scope.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API promotes the handle to the JavaScript object so that it is valid for the lifetime of the outer scope. It can only be called once per scope. If it is called more than once an error will be returned.</p><p>This API can be called even if there is a pending JavaScript exception.</p><h3 id="references-to-values-with-a-lifespan-longer-than-that-of-the-native-method" tabindex="-1">References to values with a lifespan longer than that of the native method <a class="header-anchor" href="#references-to-values-with-a-lifespan-longer-than-that-of-the-native-method" aria-label="Permalink to &quot;References to values with a lifespan longer than that of the native method&quot;">​</a></h3><p>In some cases, an addon will need to be able to create and reference values with a lifespan longer than that of a single native method invocation. For example, to create a constructor and later use that constructor in a request to create instances, it must be possible to reference the constructor object across many different instance creation requests. This would not be possible with a normal handle returned as a <code>napi_value</code> as described in the earlier section. The lifespan of a normal handle is managed by scopes and all scopes must be closed before the end of a native method.</p><p>Node-API provides methods for creating persistent references to values. Currently Node-API only allows references to be created for a limited set of value types, including object, external, function, and symbol.</p><p>Each reference has an associated count with a value of 0 or higher, which determines whether the reference will keep the corresponding value alive. References with a count of 0 do not prevent values from being collected. Values of object (object, function, external) and symbol types are becoming &#39;weak&#39; references and can still be accessed while they are not collected. Any count greater than 0 will prevent the values from being collected.</p><p>Symbol values have different flavors. The true weak reference behavior is only supported by local symbols created with the <code>napi_create_symbol</code> function or the JavaScript <code>Symbol()</code> constructor calls. Globally registered symbols created with the <code>node_api_symbol_for</code> function or JavaScript <code>Symbol.for()</code> function calls remain always strong references because the garbage collector does not collect them. The same is true for well-known symbols such as <code>Symbol.iterator</code>. They are also never collected by the garbage collector.</p><p>References can be created with an initial reference count. The count can then be modified through <code>napi_reference_ref</code> and <code>napi_reference_unref</code>. If an object is collected while the count for a reference is 0, all subsequent calls to get the object associated with the reference <code>napi_get_reference_value</code> will return <code>NULL</code> for the returned <code>napi_value</code>. An attempt to call <code>napi_reference_ref</code> for a reference whose object has been collected results in an error.</p><p>References must be deleted once they are no longer required by the addon. When a reference is deleted, it will no longer prevent the corresponding object from being collected. Failure to delete a persistent reference results in a &#39;memory leak&#39; with both the native memory for the persistent reference and the corresponding object on the heap being retained forever.</p><p>There can be multiple persistent references created which refer to the same object, each of which will either keep the object live or not based on its individual count. Multiple persistent references to the same object can result in unexpectedly keeping alive native memory. The native structures for a persistent reference must be kept alive until finalizers for the referenced object are executed. If a new persistent reference is created for the same object, the finalizers for that object will not be run and the native memory pointed by the earlier persistent reference will not be freed. This can be avoided by calling <code>napi_delete_reference</code> in addition to <code>napi_reference_unref</code> when possible.</p><p><strong>Change History:</strong></p><ul><li><p>Experimental (<code>NAPI_EXPERIMENTAL</code> is defined):</p><p>References can be created for all value types. The new supported value types do not support weak reference semantic and the values of these types are released when the reference count becomes 0 and cannot be accessed from the reference anymore.</p></li></ul><h4 id="napi-create-reference" tabindex="-1"><code>napi_create_reference</code> <a class="header-anchor" href="#napi-create-reference" aria-label="Permalink to &quot;\`napi_create_reference\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_reference</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                              napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                              uint32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> initial_refcount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                              napi_ref</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: The <code>napi_value</code> for which a reference is being created.</li><li><code>[in] initial_refcount</code>: Initial reference count for the new reference.</li><li><code>[out] result</code>: <code>napi_ref</code> pointing to the new reference.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API creates a new reference with the specified reference count to the value passed in.</p><h4 id="napi-delete-reference" tabindex="-1"><code>napi_delete_reference</code> <a class="header-anchor" href="#napi-delete-reference" aria-label="Permalink to &quot;\`napi_delete_reference\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_delete_reference</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_ref </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] ref</code>: <code>napi_ref</code> to be deleted.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API deletes the reference passed in.</p><p>This API can be called even if there is a pending JavaScript exception.</p><h4 id="napi-reference-ref" tabindex="-1"><code>napi_reference_ref</code> <a class="header-anchor" href="#napi-reference-ref" aria-label="Permalink to &quot;\`napi_reference_ref\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_reference_ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                           napi_ref </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                           uint32_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] ref</code>: <code>napi_ref</code> for which the reference count will be incremented.</li><li><code>[out] result</code>: The new reference count.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API increments the reference count for the reference passed in and returns the resulting reference count.</p><h4 id="napi-reference-unref" tabindex="-1"><code>napi_reference_unref</code> <a class="header-anchor" href="#napi-reference-unref" aria-label="Permalink to &quot;\`napi_reference_unref\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_reference_unref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                             napi_ref </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                             uint32_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] ref</code>: <code>napi_ref</code> for which the reference count will be decremented.</li><li><code>[out] result</code>: The new reference count.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API decrements the reference count for the reference passed in and returns the resulting reference count.</p><h4 id="napi-get-reference-value" tabindex="-1"><code>napi_get_reference_value</code> <a class="header-anchor" href="#napi-get-reference-value" aria-label="Permalink to &quot;\`napi_get_reference_value\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_reference_value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                 napi_ref </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                 napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] ref</code>: The <code>napi_ref</code> for which the corresponding value is being requested.</li><li><code>[out] result</code>: The <code>napi_value</code> referenced by the <code>napi_ref</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>If still valid, this API returns the <code>napi_value</code> representing the JavaScript value associated with the <code>napi_ref</code>. Otherwise, result will be <code>NULL</code>.</p><h3 id="cleanup-on-exit-of-the-current-node-js-environment" tabindex="-1">Cleanup on exit of the current Node.js environment <a class="header-anchor" href="#cleanup-on-exit-of-the-current-node-js-environment" aria-label="Permalink to &quot;Cleanup on exit of the current Node.js environment&quot;">​</a></h3><p>While a Node.js process typically releases all its resources when exiting, embedders of Node.js, or future Worker support, may require addons to register clean-up hooks that will be run once the current Node.js environment exits.</p><p>Node-API provides functions for registering and un-registering such callbacks. When those callbacks are run, all resources that are being held by the addon should be freed up.</p><h4 id="napi-add-env-cleanup-hook" tabindex="-1"><code>napi_add_env_cleanup_hook</code> <a class="header-anchor" href="#napi-add-env-cleanup-hook" aria-label="Permalink to &quot;\`napi_add_env_cleanup_hook\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NODE_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_add_env_cleanup_hook</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                  napi_cleanup_hook </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">fun</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                  void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> arg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>Registers <code>fun</code> as a function to be run with the <code>arg</code> parameter once the current Node.js environment exits.</p><p>A function can safely be specified multiple times with different <code>arg</code> values. In that case, it will be called multiple times as well. Providing the same <code>fun</code> and <code>arg</code> values multiple times is not allowed and will lead the process to abort.</p><p>The hooks will be called in reverse order, i.e. the most recently added one will be called first.</p><p>Removing this hook can be done by using <code>napi_remove_env_cleanup_hook</code>. Typically, that happens when the resource for which this hook was added is being torn down anyway.</p><p>For asynchronous cleanup, <code>napi_add_async_cleanup_hook</code> is available.</p><h4 id="napi-remove-env-cleanup-hook" tabindex="-1"><code>napi_remove_env_cleanup_hook</code> <a class="header-anchor" href="#napi-remove-env-cleanup-hook" aria-label="Permalink to &quot;\`napi_remove_env_cleanup_hook\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_remove_env_cleanup_hook</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                     void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fun)(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> arg),</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                     void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> arg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>Unregisters <code>fun</code> as a function to be run with the <code>arg</code> parameter once the current Node.js environment exits. Both the argument and the function value need to be exact matches.</p><p>The function must have originally been registered with <code>napi_add_env_cleanup_hook</code>, otherwise the process will abort.</p><h4 id="napi-add-async-cleanup-hook" tabindex="-1"><code>napi_add_async_cleanup_hook</code> <a class="header-anchor" href="#napi-add-async-cleanup-hook" aria-label="Permalink to &quot;\`napi_add_async_cleanup_hook\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_add_async_cleanup_hook</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    napi_async_cleanup_hook </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">hook</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> arg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    napi_async_cleanup_hook_handle</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> remove_handle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] hook</code>: The function pointer to call at environment teardown.</li><li><code>[in] arg</code>: The pointer to pass to <code>hook</code> when it gets called.</li><li><code>[out] remove_handle</code>: Optional handle that refers to the asynchronous cleanup hook.</li></ul><p>Registers <code>hook</code>, which is a function of type <code>napi_async_cleanup_hook</code>, as a function to be run with the <code>remove_handle</code> and <code>arg</code> parameters once the current Node.js environment exits.</p><p>Unlike <code>napi_add_env_cleanup_hook</code>, the hook is allowed to be asynchronous.</p><p>Otherwise, behavior generally matches that of <code>napi_add_env_cleanup_hook</code>.</p><p>If <code>remove_handle</code> is not <code>NULL</code>, an opaque value will be stored in it that must later be passed to <code>napi_remove_async_cleanup_hook</code>, regardless of whether the hook has already been invoked. Typically, that happens when the resource for which this hook was added is being torn down anyway.</p><h4 id="napi-remove-async-cleanup-hook" tabindex="-1"><code>napi_remove_async_cleanup_hook</code> <a class="header-anchor" href="#napi-remove-async-cleanup-hook" aria-label="Permalink to &quot;\`napi_remove_async_cleanup_hook\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_remove_async_cleanup_hook</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    napi_async_cleanup_hook_handle </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">remove_handle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] remove_handle</code>: The handle to an asynchronous cleanup hook that was created with <code>napi_add_async_cleanup_hook</code>.</li></ul><p>Unregisters the cleanup hook corresponding to <code>remove_handle</code>. This will prevent the hook from being executed, unless it has already started executing. This must be called on any <code>napi_async_cleanup_hook_handle</code> value obtained from <code>napi_add_async_cleanup_hook</code>.</p><h3 id="finalization-on-the-exit-of-the-node-js-environment" tabindex="-1">Finalization on the exit of the Node.js environment <a class="header-anchor" href="#finalization-on-the-exit-of-the-node-js-environment" aria-label="Permalink to &quot;Finalization on the exit of the Node.js environment&quot;">​</a></h3><p>The Node.js environment may be torn down at an arbitrary time as soon as possible with JavaScript execution disallowed, like on the request of <code>worker.terminate()</code>. When the environment is being torn down, the registered <code>napi_finalize</code> callbacks of JavaScript objects, thread-safe functions and environment instance data are invoked immediately and independently.</p><p>The invocation of <code>napi_finalize</code> callbacks is scheduled after the manually registered cleanup hooks. In order to ensure a proper order of addon finalization during environment shutdown to avoid use-after-free in the <code>napi_finalize</code> callback, addons should register a cleanup hook with <code>napi_add_env_cleanup_hook</code> and <code>napi_add_async_cleanup_hook</code> to manually release the allocated resource in a proper order.</p><h2 id="module-registration" tabindex="-1">Module registration <a class="header-anchor" href="#module-registration" aria-label="Permalink to &quot;Module registration&quot;">​</a></h2><p>Node-API modules are registered in a manner similar to other modules except that instead of using the <code>NODE_MODULE</code> macro the following is used:</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAPI_MODULE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(NODE_GYP_MODULE_NAME, Init)</span></span></code></pre></div><p>The next difference is the signature for the <code>Init</code> method. For a Node-API module it is as follows:</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">exports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>The return value from <code>Init</code> is treated as the <code>exports</code> object for the module. The <code>Init</code> method is passed an empty object via the <code>exports</code> parameter as a convenience. If <code>Init</code> returns <code>NULL</code>, the parameter passed as <code>exports</code> is exported by the module. Node-API modules cannot modify the <code>module</code> object but can specify anything as the <code>exports</code> property of the module.</p><p>To add the method <code>hello</code> as a function so that it can be called as a method provided by the addon:</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">exports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_status status;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_property_descriptor desc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Method,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    napi_writable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_enumerable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_configurable,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    NULL</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_define_properties</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, exports, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">desc);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exports;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>To set a function to be returned by the <code>require()</code> for the addon:</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">exports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_value method;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_status status;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;exports&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, NAPI_AUTO_LENGTH, Method, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">method);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> method;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>To define a class so that new instances can be created (often used with [Object wrap):</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// NOTE: partial example, not all referenced code is included</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">exports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_status status;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_property_descriptor properties</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">[]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;value&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, GetValue, SetValue, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_writable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_configurable, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    DECLARE_NAPI_METHOD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;plusOne&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, PlusOne),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    DECLARE_NAPI_METHOD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;multiply&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Multiply),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_value cons;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      napi_define_class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MyObject&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, New, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, properties, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cons);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_reference</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, cons, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">constructor);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_set_named_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, exports, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MyObject&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, cons);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exports;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>You can also use the <code>NAPI_MODULE_INIT</code> macro, which acts as a shorthand for <code>NAPI_MODULE</code> and defining an <code>Init</code> function:</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAPI_MODULE_INIT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_value answer;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_status result;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_int64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">42</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">answer);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_set_named_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, exports, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;answer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, answer);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exports;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>All Node-API addons are context-aware, meaning they may be loaded multiple times. There are a few design considerations when declaring such a module. The documentation on [context-aware addons provides more details.</p><p>The variables <code>env</code> and <code>exports</code> will be available inside the function body following the macro invocation.</p><p>For more details on setting properties on objects, see the section on [Working with JavaScript properties.</p><p>For more details on building addon modules in general, refer to the existing API.</p><h2 id="working-with-javascript-values" tabindex="-1">Working with JavaScript values <a class="header-anchor" href="#working-with-javascript-values" aria-label="Permalink to &quot;Working with JavaScript values&quot;">​</a></h2><p>Node-API exposes a set of APIs to create all types of JavaScript values. Some of these types are documented under [Section 6 of the [ECMAScript Language Specification.</p><p>Fundamentally, these APIs are used to do one of the following:</p><ol><li>Create a new JavaScript object</li><li>Convert from a primitive C type to a Node-API value</li><li>Convert from Node-API value to a primitive C type</li><li>Get global instances including <code>undefined</code> and <code>null</code></li></ol><p>Node-API values are represented by the type <code>napi_value</code>. Any Node-API call that requires a JavaScript value takes in a <code>napi_value</code>. In some cases, the API does check the type of the <code>napi_value</code> up-front. However, for better performance, it&#39;s better for the caller to make sure that the <code>napi_value</code> in question is of the JavaScript type expected by the API.</p><h3 id="enum-types" tabindex="-1">Enum types <a class="header-anchor" href="#enum-types" aria-label="Permalink to &quot;Enum types&quot;">​</a></h3><h4 id="napi-key-collection-mode" tabindex="-1"><code>napi_key_collection_mode</code> <a class="header-anchor" href="#napi-key-collection-mode" aria-label="Permalink to &quot;\`napi_key_collection_mode\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_key_include_prototypes,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_key_own_only</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} napi_key_collection_mode;</span></span></code></pre></div><p>Describes the <code>Keys/Properties</code> filter enums:</p><p><code>napi_key_collection_mode</code> limits the range of collected properties.</p><p><code>napi_key_own_only</code> limits the collected properties to the given object only. <code>napi_key_include_prototypes</code> will include all keys of the objects&#39;s prototype chain as well.</p><h4 id="napi-key-filter" tabindex="-1"><code>napi_key_filter</code> <a class="header-anchor" href="#napi-key-filter" aria-label="Permalink to &quot;\`napi_key_filter\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_key_all_properties </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_key_writable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_key_enumerable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_key_configurable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_key_skip_strings </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_key_skip_symbols </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} napi_key_filter;</span></span></code></pre></div><p>Property filter bits. They can be or&#39;ed to build a composite filter.</p><h4 id="napi-key-conversion" tabindex="-1"><code>napi_key_conversion</code> <a class="header-anchor" href="#napi-key-conversion" aria-label="Permalink to &quot;\`napi_key_conversion\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_key_keep_numbers,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_key_numbers_to_strings</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} napi_key_conversion;</span></span></code></pre></div><p><code>napi_key_numbers_to_strings</code> will convert integer indices to strings. <code>napi_key_keep_numbers</code> will return numbers for integer indices.</p><h4 id="napi-valuetype" tabindex="-1"><code>napi_valuetype</code> <a class="header-anchor" href="#napi-valuetype" aria-label="Permalink to &quot;\`napi_valuetype\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ES6 types (corresponds to typeof)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_undefined,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_null,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_boolean,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_number,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_string,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_symbol,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_object,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_function,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_external,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_bigint,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} napi_valuetype;</span></span></code></pre></div><p>Describes the type of a <code>napi_value</code>. This generally corresponds to the types described in [Section 6.1 of the ECMAScript Language Specification. In addition to types in that section, <code>napi_valuetype</code> can also represent <code>Function</code>s and <code>Object</code>s with external data.</p><p>A JavaScript value of type <code>napi_external</code> appears in JavaScript as a plain object such that no properties can be set on it, and no prototype.</p><h4 id="napi-typedarray-type" tabindex="-1"><code>napi_typedarray_type</code> <a class="header-anchor" href="#napi-typedarray-type" aria-label="Permalink to &quot;\`napi_typedarray_type\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_int8_array,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_uint8_array,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_uint8_clamped_array,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_int16_array,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_uint16_array,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_int32_array,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_uint32_array,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_float32_array,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_float64_array,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_bigint64_array,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_biguint64_array,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} napi_typedarray_type;</span></span></code></pre></div><p>This represents the underlying binary scalar datatype of the <code>TypedArray</code>. Elements of this enum correspond to [Section 22.2 of the [ECMAScript Language Specification.</p><h3 id="object-creation-functions" tabindex="-1">Object creation functions <a class="header-anchor" href="#object-creation-functions" aria-label="Permalink to &quot;Object creation functions&quot;">​</a></h3><h4 id="napi-create-array" tabindex="-1"><code>napi_create_array</code> <a class="header-anchor" href="#napi-create-array" aria-label="Permalink to &quot;\`napi_create_array\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the Node-API call is invoked under.</li><li><code>[out] result</code>: A <code>napi_value</code> representing a JavaScript <code>Array</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API returns a Node-API value corresponding to a JavaScript <code>Array</code> type. JavaScript arrays are described in [Section 22.1 of the ECMAScript Language Specification.</p><h4 id="napi-create-array-with-length" tabindex="-1"><code>napi_create_array_with_length</code> <a class="header-anchor" href="#napi-create-array-with-length" aria-label="Permalink to &quot;\`napi_create_array_with_length\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_array_with_length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                          size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                          napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] length</code>: The initial length of the <code>Array</code>.</li><li><code>[out] result</code>: A <code>napi_value</code> representing a JavaScript <code>Array</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API returns a Node-API value corresponding to a JavaScript <code>Array</code> type. The <code>Array</code>&#39;s length property is set to the passed-in length parameter. However, the underlying buffer is not guaranteed to be pre-allocated by the VM when the array is created. That behavior is left to the underlying VM implementation. If the buffer must be a contiguous block of memory that can be directly read and/or written via C, consider using <code>napi_create_external_arraybuffer</code>.</p><p>JavaScript arrays are described in [Section 22.1 of the ECMAScript Language Specification.</p><h4 id="napi-create-arraybuffer" tabindex="-1"><code>napi_create_arraybuffer</code> <a class="header-anchor" href="#napi-create-arraybuffer" aria-label="Permalink to &quot;\`napi_create_arraybuffer\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_arraybuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                    size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> byte_length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                    void**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                    napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] length</code>: The length in bytes of the array buffer to create.</li><li><code>[out] data</code>: Pointer to the underlying byte buffer of the <code>ArrayBuffer</code>. <code>data</code> can optionally be ignored by passing <code>NULL</code>.</li><li><code>[out] result</code>: A <code>napi_value</code> representing a JavaScript <code>ArrayBuffer</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API returns a Node-API value corresponding to a JavaScript <code>ArrayBuffer</code>. <code>ArrayBuffer</code>s are used to represent fixed-length binary data buffers. They are normally used as a backing-buffer for <code>TypedArray</code> objects. The <code>ArrayBuffer</code> allocated will have an underlying byte buffer whose size is determined by the <code>length</code> parameter that&#39;s passed in. The underlying buffer is optionally returned back to the caller in case the caller wants to directly manipulate the buffer. This buffer can only be written to directly from native code. To write to this buffer from JavaScript, a typed array or <code>DataView</code> object would need to be created.</p><p>JavaScript <code>ArrayBuffer</code> objects are described in [Section 24.1 of the ECMAScript Language Specification.</p><h4 id="napi-create-buffer" tabindex="-1"><code>napi_create_buffer</code> <a class="header-anchor" href="#napi-create-buffer" aria-label="Permalink to &quot;\`napi_create_buffer\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                               size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                               void**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] size</code>: Size in bytes of the underlying buffer.</li><li><code>[out] data</code>: Raw pointer to the underlying buffer. <code>data</code> can optionally be ignored by passing <code>NULL</code>.</li><li><code>[out] result</code>: A <code>napi_value</code> representing a <code>node::Buffer</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API allocates a <code>node::Buffer</code> object. While this is still a fully-supported data structure, in most cases using a <code>TypedArray</code> will suffice.</p><h4 id="napi-create-buffer-copy" tabindex="-1"><code>napi_create_buffer_copy</code> <a class="header-anchor" href="#napi-create-buffer-copy" aria-label="Permalink to &quot;\`napi_create_buffer_copy\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_buffer_copy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                    size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                    const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                    void**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                    napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] size</code>: Size in bytes of the input buffer (should be the same as the size of the new buffer).</li><li><code>[in] data</code>: Raw pointer to the underlying buffer to copy from.</li><li><code>[out] result_data</code>: Pointer to the new <code>Buffer</code>&#39;s underlying data buffer. <code>result_data</code> can optionally be ignored by passing <code>NULL</code>.</li><li><code>[out] result</code>: A <code>napi_value</code> representing a <code>node::Buffer</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API allocates a <code>node::Buffer</code> object and initializes it with data copied from the passed-in buffer. While this is still a fully-supported data structure, in most cases using a <code>TypedArray</code> will suffice.</p><h4 id="napi-create-date" tabindex="-1"><code>napi_create_date</code> <a class="header-anchor" href="#napi-create-date" aria-label="Permalink to &quot;\`napi_create_date\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                             double</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> time</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                             napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] time</code>: ECMAScript time value in milliseconds since 01 January, 1970 UTC.</li><li><code>[out] result</code>: A <code>napi_value</code> representing a JavaScript <code>Date</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API does not observe leap seconds; they are ignored, as ECMAScript aligns with POSIX time specification.</p><p>This API allocates a JavaScript <code>Date</code> object.</p><p>JavaScript <code>Date</code> objects are described in [Section 20.3 of the ECMAScript Language Specification.</p><h4 id="napi-create-external" tabindex="-1"><code>napi_create_external</code> <a class="header-anchor" href="#napi-create-external" aria-label="Permalink to &quot;\`napi_create_external\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_external</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_finalize </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">finalize_cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> finalize_hint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] data</code>: Raw pointer to the external data.</li><li><code>[in] finalize_cb</code>: Optional callback to call when the external value is being collected. <code>napi_finalize</code> provides more details.</li><li><code>[in] finalize_hint</code>: Optional hint to pass to the finalize callback during collection.</li><li><code>[out] result</code>: A <code>napi_value</code> representing an external value.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API allocates a JavaScript value with external data attached to it. This is used to pass external data through JavaScript code, so it can be retrieved later by native code using <code>napi_get_value_external</code>.</p><p>The API adds a <code>napi_finalize</code> callback which will be called when the JavaScript object just created has been garbage collected.</p><p>The created value is not an object, and therefore does not support additional properties. It is considered a distinct value type: calling <code>napi_typeof()</code> with an external value yields <code>napi_external</code>.</p><h4 id="napi-create-external-arraybuffer" tabindex="-1"><code>napi_create_external_arraybuffer</code> <a class="header-anchor" href="#napi-create-external-arraybuffer" aria-label="Permalink to &quot;\`napi_create_external_arraybuffer\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_external_arraybuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> external_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> byte_length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_finalize </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">finalize_cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> finalize_hint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] external_data</code>: Pointer to the underlying byte buffer of the <code>ArrayBuffer</code>.</li><li><code>[in] byte_length</code>: The length in bytes of the underlying buffer.</li><li><code>[in] finalize_cb</code>: Optional callback to call when the <code>ArrayBuffer</code> is being collected. <code>napi_finalize</code> provides more details.</li><li><code>[in] finalize_hint</code>: Optional hint to pass to the finalize callback during collection.</li><li><code>[out] result</code>: A <code>napi_value</code> representing a JavaScript <code>ArrayBuffer</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p><strong>Some runtimes other than Node.js have dropped support for external buffers</strong>. On runtimes other than Node.js this method may return <code>napi_no_external_buffers_allowed</code> to indicate that external buffers are not supported. One such runtime is Electron as described in this issue <a href="https://github.com/electron/electron/issues/35801" target="_blank" rel="noreferrer">electron/issues/35801</a>.</p><p>In order to maintain broadest compatibility with all runtimes you may define <code>NODE_API_NO_EXTERNAL_BUFFERS_ALLOWED</code> in your addon before includes for the node-api headers. Doing so will hide the 2 functions that create external buffers. This will ensure a compilation error occurs if you accidentally use one of these methods.</p><p>This API returns a Node-API value corresponding to a JavaScript <code>ArrayBuffer</code>. The underlying byte buffer of the <code>ArrayBuffer</code> is externally allocated and managed. The caller must ensure that the byte buffer remains valid until the finalize callback is called.</p><p>The API adds a <code>napi_finalize</code> callback which will be called when the JavaScript object just created has been garbage collected.</p><p>JavaScript <code>ArrayBuffer</code>s are described in [Section 24.1 of the ECMAScript Language Specification.</p><h4 id="napi-create-external-buffer" tabindex="-1"><code>napi_create_external_buffer</code> <a class="header-anchor" href="#napi-create-external-buffer" aria-label="Permalink to &quot;\`napi_create_external_buffer\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_external_buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                        size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                        void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                        napi_finalize </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">finalize_cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                        void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> finalize_hint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                        napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] length</code>: Size in bytes of the input buffer (should be the same as the size of the new buffer).</li><li><code>[in] data</code>: Raw pointer to the underlying buffer to expose to JavaScript.</li><li><code>[in] finalize_cb</code>: Optional callback to call when the <code>ArrayBuffer</code> is being collected. <code>napi_finalize</code> provides more details.</li><li><code>[in] finalize_hint</code>: Optional hint to pass to the finalize callback during collection.</li><li><code>[out] result</code>: A <code>napi_value</code> representing a <code>node::Buffer</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p><strong>Some runtimes other than Node.js have dropped support for external buffers</strong>. On runtimes other than Node.js this method may return <code>napi_no_external_buffers_allowed</code> to indicate that external buffers are not supported. One such runtime is Electron as described in this issue <a href="https://github.com/electron/electron/issues/35801" target="_blank" rel="noreferrer">electron/issues/35801</a>.</p><p>In order to maintain broadest compatibility with all runtimes you may define <code>NODE_API_NO_EXTERNAL_BUFFERS_ALLOWED</code> in your addon before includes for the node-api headers. Doing so will hide the 2 functions that create external buffers. This will ensure a compilation error occurs if you accidentally use one of these methods.</p><p>This API allocates a <code>node::Buffer</code> object and initializes it with data backed by the passed in buffer. While this is still a fully-supported data structure, in most cases using a <code>TypedArray</code> will suffice.</p><p>The API adds a <code>napi_finalize</code> callback which will be called when the JavaScript object just created has been garbage collected.</p><p>For Node.js &gt;=4 <code>Buffers</code> are <code>Uint8Array</code>s.</p><h4 id="napi-create-object" tabindex="-1"><code>napi_create_object</code> <a class="header-anchor" href="#napi-create-object" aria-label="Permalink to &quot;\`napi_create_object\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[out] result</code>: A <code>napi_value</code> representing a JavaScript <code>Object</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API allocates a default JavaScript <code>Object</code>. It is the equivalent of doing <code>new Object()</code> in JavaScript.</p><p>The JavaScript <code>Object</code> type is described in [Section 6.1.7 of the ECMAScript Language Specification.</p><h4 id="napi-create-symbol" tabindex="-1"><code>napi_create_symbol</code> <a class="header-anchor" href="#napi-create-symbol" aria-label="Permalink to &quot;\`napi_create_symbol\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_symbol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] description</code>: Optional <code>napi_value</code> which refers to a JavaScript <code>string</code> to be set as the description for the symbol.</li><li><code>[out] result</code>: A <code>napi_value</code> representing a JavaScript <code>symbol</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API creates a JavaScript <code>symbol</code> value from a UTF8-encoded C string.</p><p>The JavaScript <code>symbol</code> type is described in [Section 19.4 of the ECMAScript Language Specification.</p><h4 id="node-api-symbol-for" tabindex="-1"><code>node_api_symbol_for</code> <a class="header-anchor" href="#node-api-symbol-for" aria-label="Permalink to &quot;\`node_api_symbol_for\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node_api_symbol_for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> utf8description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] utf8description</code>: UTF-8 C string representing the text to be used as the description for the symbol.</li><li><code>[in] length</code>: The length of the description string in bytes, or <code>NAPI_AUTO_LENGTH</code> if it is null-terminated.</li><li><code>[out] result</code>: A <code>napi_value</code> representing a JavaScript <code>symbol</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API searches in the global registry for an existing symbol with the given description. If the symbol already exists it will be returned, otherwise a new symbol will be created in the registry.</p><p>The JavaScript <code>symbol</code> type is described in [Section 19.4 of the ECMAScript Language Specification.</p><h4 id="napi-create-typedarray" tabindex="-1"><code>napi_create_typedarray</code> <a class="header-anchor" href="#napi-create-typedarray" aria-label="Permalink to &quot;\`napi_create_typedarray\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_typedarray</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   napi_typedarray_type </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                   size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">arraybuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                   size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> byte_offset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] type</code>: Scalar datatype of the elements within the <code>TypedArray</code>.</li><li><code>[in] length</code>: Number of elements in the <code>TypedArray</code>.</li><li><code>[in] arraybuffer</code>: <code>ArrayBuffer</code> underlying the typed array.</li><li><code>[in] byte_offset</code>: The byte offset within the <code>ArrayBuffer</code> from which to start projecting the <code>TypedArray</code>.</li><li><code>[out] result</code>: A <code>napi_value</code> representing a JavaScript <code>TypedArray</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API creates a JavaScript <code>TypedArray</code> object over an existing <code>ArrayBuffer</code>. <code>TypedArray</code> objects provide an array-like view over an underlying data buffer where each element has the same underlying binary scalar datatype.</p><p>It&#39;s required that <code>(length * size_of_element) + byte_offset</code> should be &lt;= the size in bytes of the array passed in. If not, a <code>RangeError</code> exception is raised.</p><p>JavaScript <code>TypedArray</code> objects are described in [Section 22.2 of the ECMAScript Language Specification.</p><h4 id="napi-create-dataview" tabindex="-1"><code>napi_create_dataview</code> <a class="header-anchor" href="#napi-create-dataview" aria-label="Permalink to &quot;\`napi_create_dataview\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_dataview</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> byte_length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">arraybuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> byte_offset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] length</code>: Number of elements in the <code>DataView</code>.</li><li><code>[in] arraybuffer</code>: <code>ArrayBuffer</code> underlying the <code>DataView</code>.</li><li><code>[in] byte_offset</code>: The byte offset within the <code>ArrayBuffer</code> from which to start projecting the <code>DataView</code>.</li><li><code>[out] result</code>: A <code>napi_value</code> representing a JavaScript <code>DataView</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API creates a JavaScript <code>DataView</code> object over an existing <code>ArrayBuffer</code>. <code>DataView</code> objects provide an array-like view over an underlying data buffer, but one which allows items of different size and type in the <code>ArrayBuffer</code>.</p><p>It is required that <code>byte_length + byte_offset</code> is less than or equal to the size in bytes of the array passed in. If not, a <code>RangeError</code> exception is raised.</p><p>JavaScript <code>DataView</code> objects are described in [Section 24.3 of the ECMAScript Language Specification.</p><h3 id="functions-to-convert-from-c-types-to-node-api" tabindex="-1">Functions to convert from C types to Node-API <a class="header-anchor" href="#functions-to-convert-from-c-types-to-node-api" aria-label="Permalink to &quot;Functions to convert from C types to Node-API&quot;">​</a></h3><h4 id="napi-create-int32" tabindex="-1"><code>napi_create_int32</code> <a class="header-anchor" href="#napi-create-int32" aria-label="Permalink to &quot;\`napi_create_int32\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_int32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: Integer value to be represented in JavaScript.</li><li><code>[out] result</code>: A <code>napi_value</code> representing a JavaScript <code>number</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API is used to convert from the C <code>int32_t</code> type to the JavaScript <code>number</code> type.</p><p>The JavaScript <code>number</code> type is described in [Section 6.1.6 of the ECMAScript Language Specification.</p><h4 id="napi-create-uint32" tabindex="-1"><code>napi_create_uint32</code> <a class="header-anchor" href="#napi-create-uint32" aria-label="Permalink to &quot;\`napi_create_uint32\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_uint32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uint32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: Unsigned integer value to be represented in JavaScript.</li><li><code>[out] result</code>: A <code>napi_value</code> representing a JavaScript <code>number</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API is used to convert from the C <code>uint32_t</code> type to the JavaScript <code>number</code> type.</p><p>The JavaScript <code>number</code> type is described in [Section 6.1.6 of the ECMAScript Language Specification.</p><h4 id="napi-create-int64" tabindex="-1"><code>napi_create_int64</code> <a class="header-anchor" href="#napi-create-int64" aria-label="Permalink to &quot;\`napi_create_int64\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_int64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int64_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: Integer value to be represented in JavaScript.</li><li><code>[out] result</code>: A <code>napi_value</code> representing a JavaScript <code>number</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API is used to convert from the C <code>int64_t</code> type to the JavaScript <code>number</code> type.</p><p>The JavaScript <code>number</code> type is described in [Section 6.1.6 of the ECMAScript Language Specification. Note the complete range of <code>int64_t</code> cannot be represented with full precision in JavaScript. Integer values outside the range of <code>Number.MIN_SAFE_INTEGER</code> <code>-(2**53 - 1)</code> - <code>Number.MAX_SAFE_INTEGER</code> <code>(2**53 - 1)</code> will lose precision.</p><h4 id="napi-create-double" tabindex="-1"><code>napi_create_double</code> <a class="header-anchor" href="#napi-create-double" aria-label="Permalink to &quot;\`napi_create_double\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">double</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: Double-precision value to be represented in JavaScript.</li><li><code>[out] result</code>: A <code>napi_value</code> representing a JavaScript <code>number</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API is used to convert from the C <code>double</code> type to the JavaScript <code>number</code> type.</p><p>The JavaScript <code>number</code> type is described in [Section 6.1.6 of the ECMAScript Language Specification.</p><h4 id="napi-create-bigint-int64" tabindex="-1"><code>napi_create_bigint_int64</code> <a class="header-anchor" href="#napi-create-bigint-int64" aria-label="Permalink to &quot;\`napi_create_bigint_int64\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_bigint_int64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                     int64_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                     napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: Integer value to be represented in JavaScript.</li><li><code>[out] result</code>: A <code>napi_value</code> representing a JavaScript <code>BigInt</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API converts the C <code>int64_t</code> type to the JavaScript <code>BigInt</code> type.</p><h4 id="napi-create-bigint-uint64" tabindex="-1"><code>napi_create_bigint_uint64</code> <a class="header-anchor" href="#napi-create-bigint-uint64" aria-label="Permalink to &quot;\`napi_create_bigint_uint64\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_bigint_uint64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                      uint64_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                      napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: Unsigned integer value to be represented in JavaScript.</li><li><code>[out] result</code>: A <code>napi_value</code> representing a JavaScript <code>BigInt</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API converts the C <code>uint64_t</code> type to the JavaScript <code>BigInt</code> type.</p><h4 id="napi-create-bigint-words" tabindex="-1"><code>napi_create_bigint_words</code> <a class="header-anchor" href="#napi-create-bigint-words" aria-label="Permalink to &quot;\`napi_create_bigint_words\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_bigint_words</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                     int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> sign_bit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                     size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> word_count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                     const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> uint64_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> words</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                     napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] sign_bit</code>: Determines if the resulting <code>BigInt</code> will be positive or negative.</li><li><code>[in] word_count</code>: The length of the <code>words</code> array.</li><li><code>[in] words</code>: An array of <code>uint64_t</code> little-endian 64-bit words.</li><li><code>[out] result</code>: A <code>napi_value</code> representing a JavaScript <code>BigInt</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API converts an array of unsigned 64-bit words into a single <code>BigInt</code> value.</p><p>The resulting <code>BigInt</code> is calculated as: (–1)<sup><code>sign_bit</code></sup> (<code>words[0]</code> × (2<sup>64</sup>)<sup>0</sup> + <code>words[1]</code> × (2<sup>64</sup>)<sup>1</sup> + …)</p><h4 id="napi-create-string-latin1" tabindex="-1"><code>napi_create_string_latin1</code> <a class="header-anchor" href="#napi-create-string-latin1" aria-label="Permalink to &quot;\`napi_create_string_latin1\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_string_latin1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                      const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                      size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                      napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] str</code>: Character buffer representing an ISO-8859-1-encoded string.</li><li><code>[in] length</code>: The length of the string in bytes, or <code>NAPI_AUTO_LENGTH</code> if it is null-terminated.</li><li><code>[out] result</code>: A <code>napi_value</code> representing a JavaScript <code>string</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API creates a JavaScript <code>string</code> value from an ISO-8859-1-encoded C string. The native string is copied.</p><p>The JavaScript <code>string</code> type is described in [Section 6.1.4 of the ECMAScript Language Specification.</p><h4 id="node-api-create-external-string-latin1" tabindex="-1"><code>node_api_create_external_string_latin1</code> <a class="header-anchor" href="#node-api-create-external-string-latin1" aria-label="Permalink to &quot;\`node_api_create_external_string_latin1\`&quot;">​</a></h4><blockquote><p>Stability: 1 - Experimental</p></blockquote><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node_api_create_external_string_latin1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                       char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                       size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                       napi_finalize </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">finalize_callback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                       void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> finalize_hint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                       napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                       bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> copied</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] str</code>: Character buffer representing an ISO-8859-1-encoded string.</li><li><code>[in] length</code>: The length of the string in bytes, or <code>NAPI_AUTO_LENGTH</code> if it is null-terminated.</li><li><code>[in] finalize_callback</code>: The function to call when the string is being collected. The function will be called with the following parameters: <ul><li><code>[in] env</code>: The environment in which the add-on is running. This value may be null if the string is being collected as part of the termination of the worker or the main Node.js instance.</li><li><code>[in] data</code>: This is the value <code>str</code> as a <code>void*</code> pointer.</li><li><code>[in] finalize_hint</code>: This is the value <code>finalize_hint</code> that was given to the API. <code>napi_finalize</code> provides more details. This parameter is optional. Passing a null value means that the add-on doesn&#39;t need to be notified when the corresponding JavaScript string is collected.</li></ul></li><li><code>[in] finalize_hint</code>: Optional hint to pass to the finalize callback during collection.</li><li><code>[out] result</code>: A <code>napi_value</code> representing a JavaScript <code>string</code>.</li><li><code>[out] copied</code>: Whether the string was copied. If it was, the finalizer will already have been invoked to destroy <code>str</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API creates a JavaScript <code>string</code> value from an ISO-8859-1-encoded C string. The native string may not be copied and must thus exist for the entire life cycle of the JavaScript value.</p><p>The JavaScript <code>string</code> type is described in [Section 6.1.4 of the ECMAScript Language Specification.</p><h4 id="napi-create-string-utf16" tabindex="-1"><code>napi_create_string_utf16</code> <a class="header-anchor" href="#napi-create-string-utf16" aria-label="Permalink to &quot;\`napi_create_string_utf16\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_string_utf16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                     const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> char16_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                     size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                     napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] str</code>: Character buffer representing a UTF16-LE-encoded string.</li><li><code>[in] length</code>: The length of the string in two-byte code units, or <code>NAPI_AUTO_LENGTH</code> if it is null-terminated.</li><li><code>[out] result</code>: A <code>napi_value</code> representing a JavaScript <code>string</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API creates a JavaScript <code>string</code> value from a UTF16-LE-encoded C string. The native string is copied.</p><p>The JavaScript <code>string</code> type is described in [Section 6.1.4 of the ECMAScript Language Specification.</p><h4 id="node-api-create-external-string-utf16" tabindex="-1"><code>node_api_create_external_string_utf16</code> <a class="header-anchor" href="#node-api-create-external-string-utf16" aria-label="Permalink to &quot;\`node_api_create_external_string_utf16\`&quot;">​</a></h4><blockquote><p>Stability: 1 - Experimental</p></blockquote><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node_api_create_external_string_utf16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                                      char16_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                      size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                      napi_finalize </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">finalize_callback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                      void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> finalize_hint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                      napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                      bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> copied</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] str</code>: Character buffer representing a UTF16-LE-encoded string.</li><li><code>[in] length</code>: The length of the string in two-byte code units, or <code>NAPI_AUTO_LENGTH</code> if it is null-terminated.</li><li><code>[in] finalize_callback</code>: The function to call when the string is being collected. The function will be called with the following parameters: <ul><li><code>[in] env</code>: The environment in which the add-on is running. This value may be null if the string is being collected as part of the termination of the worker or the main Node.js instance.</li><li><code>[in] data</code>: This is the value <code>str</code> as a <code>void*</code> pointer.</li><li><code>[in] finalize_hint</code>: This is the value <code>finalize_hint</code> that was given to the API. <code>napi_finalize</code> provides more details. This parameter is optional. Passing a null value means that the add-on doesn&#39;t need to be notified when the corresponding JavaScript string is collected.</li></ul></li><li><code>[in] finalize_hint</code>: Optional hint to pass to the finalize callback during collection.</li><li><code>[out] result</code>: A <code>napi_value</code> representing a JavaScript <code>string</code>.</li><li><code>[out] copied</code>: Whether the string was copied. If it was, the finalizer will already have been invoked to destroy <code>str</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API creates a JavaScript <code>string</code> value from a UTF16-LE-encoded C string. The native string may not be copied and must thus exist for the entire life cycle of the JavaScript value.</p><p>The JavaScript <code>string</code> type is described in [Section 6.1.4 of the ECMAScript Language Specification.</p><h4 id="napi-create-string-utf8" tabindex="-1"><code>napi_create_string_utf8</code> <a class="header-anchor" href="#napi-create-string-utf8" aria-label="Permalink to &quot;\`napi_create_string_utf8\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_string_utf8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                    const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                    size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                    napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] str</code>: Character buffer representing a UTF8-encoded string.</li><li><code>[in] length</code>: The length of the string in bytes, or <code>NAPI_AUTO_LENGTH</code> if it is null-terminated.</li><li><code>[out] result</code>: A <code>napi_value</code> representing a JavaScript <code>string</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API creates a JavaScript <code>string</code> value from a UTF8-encoded C string. The native string is copied.</p><p>The JavaScript <code>string</code> type is described in [Section 6.1.4 of the ECMAScript Language Specification.</p><h3 id="functions-to-convert-from-node-api-to-c-types" tabindex="-1">Functions to convert from Node-API to C types <a class="header-anchor" href="#functions-to-convert-from-node-api-to-c-types" aria-label="Permalink to &quot;Functions to convert from Node-API to C types&quot;">​</a></h3><h4 id="napi-get-array-length" tabindex="-1"><code>napi_get_array_length</code> <a class="header-anchor" href="#napi-get-array-length" aria-label="Permalink to &quot;\`napi_get_array_length\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_array_length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                  uint32_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: <code>napi_value</code> representing the JavaScript <code>Array</code> whose length is being queried.</li><li><code>[out] result</code>: <code>uint32</code> representing length of the array.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API returns the length of an array.</p><p><code>Array</code> length is described in [Section 22.1.4.1 of the ECMAScript Language Specification.</p><h4 id="napi-get-arraybuffer-info" tabindex="-1"><code>napi_get_arraybuffer_info</code> <a class="header-anchor" href="#napi-get-arraybuffer-info" aria-label="Permalink to &quot;\`napi_get_arraybuffer_info\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_arraybuffer_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                      napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">arraybuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                      void**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                      size_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> byte_length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] arraybuffer</code>: <code>napi_value</code> representing the <code>ArrayBuffer</code> being queried.</li><li><code>[out] data</code>: The underlying data buffer of the <code>ArrayBuffer</code>. If byte_length is <code>0</code>, this may be <code>NULL</code> or any other pointer value.</li><li><code>[out] byte_length</code>: Length in bytes of the underlying data buffer.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API is used to retrieve the underlying data buffer of an <code>ArrayBuffer</code> and its length.</p><p><em>WARNING</em>: Use caution while using this API. The lifetime of the underlying data buffer is managed by the <code>ArrayBuffer</code> even after it&#39;s returned. A possible safe way to use this API is in conjunction with <code>napi_create_reference</code>, which can be used to guarantee control over the lifetime of the <code>ArrayBuffer</code>. It&#39;s also safe to use the returned data buffer within the same callback as long as there are no calls to other APIs that might trigger a GC.</p><h4 id="napi-get-buffer-info" tabindex="-1"><code>napi_get_buffer_info</code> <a class="header-anchor" href="#napi-get-buffer-info" aria-label="Permalink to &quot;\`napi_get_buffer_info\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_buffer_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 void**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 size_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: <code>napi_value</code> representing the <code>node::Buffer</code> being queried.</li><li><code>[out] data</code>: The underlying data buffer of the <code>node::Buffer</code>. If length is <code>0</code>, this may be <code>NULL</code> or any other pointer value.</li><li><code>[out] length</code>: Length in bytes of the underlying data buffer.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API is used to retrieve the underlying data buffer of a <code>node::Buffer</code> and its length.</p><p><em>Warning</em>: Use caution while using this API since the underlying data buffer&#39;s lifetime is not guaranteed if it&#39;s managed by the VM.</p><h4 id="napi-get-prototype" tabindex="-1"><code>napi_get_prototype</code> <a class="header-anchor" href="#napi-get-prototype" aria-label="Permalink to &quot;\`napi_get_prototype\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_prototype</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] object</code>: <code>napi_value</code> representing JavaScript <code>Object</code> whose prototype to return. This returns the equivalent of <code>Object.getPrototypeOf</code> (which is not the same as the function&#39;s <code>prototype</code> property).</li><li><code>[out] result</code>: <code>napi_value</code> representing prototype of the given object.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><h4 id="napi-get-typedarray-info" tabindex="-1"><code>napi_get_typedarray_info</code> <a class="header-anchor" href="#napi-get-typedarray-info" aria-label="Permalink to &quot;\`napi_get_typedarray_info\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_typedarray_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                     napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">typedarray</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                     napi_typedarray_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                     size_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                     void**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                     napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> arraybuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                     size_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> byte_offset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] typedarray</code>: <code>napi_value</code> representing the <code>TypedArray</code> whose properties to query.</li><li><code>[out] type</code>: Scalar datatype of the elements within the <code>TypedArray</code>.</li><li><code>[out] length</code>: The number of elements in the <code>TypedArray</code>.</li><li><code>[out] data</code>: The data buffer underlying the <code>TypedArray</code> adjusted by the <code>byte_offset</code> value so that it points to the first element in the <code>TypedArray</code>. If the length of the array is <code>0</code>, this may be <code>NULL</code> or any other pointer value.</li><li><code>[out] arraybuffer</code>: The <code>ArrayBuffer</code> underlying the <code>TypedArray</code>.</li><li><code>[out] byte_offset</code>: The byte offset within the underlying native array at which the first element of the arrays is located. The value for the data parameter has already been adjusted so that data points to the first element in the array. Therefore, the first byte of the native array would be at <code>data - byte_offset</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API returns various properties of a typed array.</p><p>Any of the out parameters may be <code>NULL</code> if that property is unneeded.</p><p><em>Warning</em>: Use caution while using this API since the underlying data buffer is managed by the VM.</p><h4 id="napi-get-dataview-info" tabindex="-1"><code>napi_get_dataview_info</code> <a class="header-anchor" href="#napi-get-dataview-info" aria-label="Permalink to &quot;\`napi_get_dataview_info\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_dataview_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dataview</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                   size_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> byte_length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                   void**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> arraybuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                   size_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> byte_offset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] dataview</code>: <code>napi_value</code> representing the <code>DataView</code> whose properties to query.</li><li><code>[out] byte_length</code>: Number of bytes in the <code>DataView</code>.</li><li><code>[out] data</code>: The data buffer underlying the <code>DataView</code>. If byte_length is <code>0</code>, this may be <code>NULL</code> or any other pointer value.</li><li><code>[out] arraybuffer</code>: <code>ArrayBuffer</code> underlying the <code>DataView</code>.</li><li><code>[out] byte_offset</code>: The byte offset within the data buffer from which to start projecting the <code>DataView</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>Any of the out parameters may be <code>NULL</code> if that property is unneeded.</p><p>This API returns various properties of a <code>DataView</code>.</p><h4 id="napi-get-date-value" tabindex="-1"><code>napi_get_date_value</code> <a class="header-anchor" href="#napi-get-date-value" aria-label="Permalink to &quot;\`napi_get_date_value\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_date_value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                double*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: <code>napi_value</code> representing a JavaScript <code>Date</code>.</li><li><code>[out] result</code>: Time value as a <code>double</code> represented as milliseconds since midnight at the beginning of 01 January, 1970 UTC.</li></ul><p>This API does not observe leap seconds; they are ignored, as ECMAScript aligns with POSIX time specification.</p><p>Returns <code>napi_ok</code> if the API succeeded. If a non-date <code>napi_value</code> is passed in it returns <code>napi_date_expected</code>.</p><p>This API returns the C double primitive of time value for the given JavaScript <code>Date</code>.</p><h4 id="napi-get-value-bool" tabindex="-1"><code>napi_get_value_bool</code> <a class="header-anchor" href="#napi-get-value-bool" aria-label="Permalink to &quot;\`napi_get_value_bool\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_value_bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: <code>napi_value</code> representing JavaScript <code>Boolean</code>.</li><li><code>[out] result</code>: C boolean primitive equivalent of the given JavaScript <code>Boolean</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded. If a non-boolean <code>napi_value</code> is passed in it returns <code>napi_boolean_expected</code>.</p><p>This API returns the C boolean primitive equivalent of the given JavaScript <code>Boolean</code>.</p><h4 id="napi-get-value-double" tabindex="-1"><code>napi_get_value_double</code> <a class="header-anchor" href="#napi-get-value-double" aria-label="Permalink to &quot;\`napi_get_value_double\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_value_double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                  double*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: <code>napi_value</code> representing JavaScript <code>number</code>.</li><li><code>[out] result</code>: C double primitive equivalent of the given JavaScript <code>number</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded. If a non-number <code>napi_value</code> is passed in it returns <code>napi_number_expected</code>.</p><p>This API returns the C double primitive equivalent of the given JavaScript <code>number</code>.</p><h4 id="napi-get-value-bigint-int64" tabindex="-1"><code>napi_get_value_bigint_int64</code> <a class="header-anchor" href="#napi-get-value-bigint-int64" aria-label="Permalink to &quot;\`napi_get_value_bigint_int64\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_value_bigint_int64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                        napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                        int64_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                        bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> lossless</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under</li><li><code>[in] value</code>: <code>napi_value</code> representing JavaScript <code>BigInt</code>.</li><li><code>[out] result</code>: C <code>int64_t</code> primitive equivalent of the given JavaScript <code>BigInt</code>.</li><li><code>[out] lossless</code>: Indicates whether the <code>BigInt</code> value was converted losslessly.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded. If a non-<code>BigInt</code> is passed in it returns <code>napi_bigint_expected</code>.</p><p>This API returns the C <code>int64_t</code> primitive equivalent of the given JavaScript <code>BigInt</code>. If needed it will truncate the value, setting <code>lossless</code> to <code>false</code>.</p><h4 id="napi-get-value-bigint-uint64" tabindex="-1"><code>napi_get_value_bigint_uint64</code> <a class="header-anchor" href="#napi-get-value-bigint-uint64" aria-label="Permalink to &quot;\`napi_get_value_bigint_uint64\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_value_bigint_uint64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                        napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                        uint64_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                        bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> lossless</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: <code>napi_value</code> representing JavaScript <code>BigInt</code>.</li><li><code>[out] result</code>: C <code>uint64_t</code> primitive equivalent of the given JavaScript <code>BigInt</code>.</li><li><code>[out] lossless</code>: Indicates whether the <code>BigInt</code> value was converted losslessly.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded. If a non-<code>BigInt</code> is passed in it returns <code>napi_bigint_expected</code>.</p><p>This API returns the C <code>uint64_t</code> primitive equivalent of the given JavaScript <code>BigInt</code>. If needed it will truncate the value, setting <code>lossless</code> to <code>false</code>.</p><h4 id="napi-get-value-bigint-words" tabindex="-1"><code>napi_get_value_bigint_words</code> <a class="header-anchor" href="#napi-get-value-bigint-words" aria-label="Permalink to &quot;\`napi_get_value_bigint_words\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_value_bigint_words</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                        napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                        int*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> sign_bit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                        size_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> word_count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                        uint64_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> words</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: <code>napi_value</code> representing JavaScript <code>BigInt</code>.</li><li><code>[out] sign_bit</code>: Integer representing if the JavaScript <code>BigInt</code> is positive or negative.</li><li><code>[in/out] word_count</code>: Must be initialized to the length of the <code>words</code> array. Upon return, it will be set to the actual number of words that would be needed to store this <code>BigInt</code>.</li><li><code>[out] words</code>: Pointer to a pre-allocated 64-bit word array.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API converts a single <code>BigInt</code> value into a sign bit, 64-bit little-endian array, and the number of elements in the array. <code>sign_bit</code> and <code>words</code> may be both set to <code>NULL</code>, in order to get only <code>word_count</code>.</p><h4 id="napi-get-value-external" tabindex="-1"><code>napi_get_value_external</code> <a class="header-anchor" href="#napi-get-value-external" aria-label="Permalink to &quot;\`napi_get_value_external\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_value_external</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                    napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                    void**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: <code>napi_value</code> representing JavaScript external value.</li><li><code>[out] result</code>: Pointer to the data wrapped by the JavaScript external value.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded. If a non-external <code>napi_value</code> is passed in it returns <code>napi_invalid_arg</code>.</p><p>This API retrieves the external data pointer that was previously passed to <code>napi_create_external()</code>.</p><h4 id="napi-get-value-int32" tabindex="-1"><code>napi_get_value_int32</code> <a class="header-anchor" href="#napi-get-value-int32" aria-label="Permalink to &quot;\`napi_get_value_int32\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_value_int32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 int32_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: <code>napi_value</code> representing JavaScript <code>number</code>.</li><li><code>[out] result</code>: C <code>int32</code> primitive equivalent of the given JavaScript <code>number</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded. If a non-number <code>napi_value</code> is passed in <code>napi_number_expected</code>.</p><p>This API returns the C <code>int32</code> primitive equivalent of the given JavaScript <code>number</code>.</p><p>If the number exceeds the range of the 32 bit integer, then the result is truncated to the equivalent of the bottom 32 bits. This can result in a large positive number becoming a negative number if the value is &gt; 2<sup>31</sup> - 1.</p><p>Non-finite number values (<code>NaN</code>, <code>+Infinity</code>, or <code>-Infinity</code>) set the result to zero.</p><h4 id="napi-get-value-int64" tabindex="-1"><code>napi_get_value_int64</code> <a class="header-anchor" href="#napi-get-value-int64" aria-label="Permalink to &quot;\`napi_get_value_int64\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_value_int64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 int64_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: <code>napi_value</code> representing JavaScript <code>number</code>.</li><li><code>[out] result</code>: C <code>int64</code> primitive equivalent of the given JavaScript <code>number</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded. If a non-number <code>napi_value</code> is passed in it returns <code>napi_number_expected</code>.</p><p>This API returns the C <code>int64</code> primitive equivalent of the given JavaScript <code>number</code>.</p><p><code>number</code> values outside the range of <code>Number.MIN_SAFE_INTEGER</code><code>-(2**53 - 1)</code> - <code>Number.MAX_SAFE_INTEGER</code> <code>(2**53 - 1)</code> will lose precision.</p><p>Non-finite number values (<code>NaN</code>, <code>+Infinity</code>, or <code>-Infinity</code>) set the result to zero.</p><h4 id="napi-get-value-string-latin1" tabindex="-1"><code>napi_get_value_string_latin1</code> <a class="header-anchor" href="#napi-get-value-string-latin1" aria-label="Permalink to &quot;\`napi_get_value_string_latin1\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_value_string_latin1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                         napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                         char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> buf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                         size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> bufsize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                         size_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: <code>napi_value</code> representing JavaScript string.</li><li><code>[in] buf</code>: Buffer to write the ISO-8859-1-encoded string into. If <code>NULL</code> is passed in, the length of the string in bytes and excluding the null terminator is returned in <code>result</code>.</li><li><code>[in] bufsize</code>: Size of the destination buffer. When this value is insufficient, the returned string is truncated and null-terminated.</li><li><code>[out] result</code>: Number of bytes copied into the buffer, excluding the null terminator.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded. If a non-<code>string</code> <code>napi_value</code> is passed in it returns <code>napi_string_expected</code>.</p><p>This API returns the ISO-8859-1-encoded string corresponding the value passed in.</p><h4 id="napi-get-value-string-utf8" tabindex="-1"><code>napi_get_value_string_utf8</code> <a class="header-anchor" href="#napi-get-value-string-utf8" aria-label="Permalink to &quot;\`napi_get_value_string_utf8\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_value_string_utf8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                       napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                       char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> buf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                       size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> bufsize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                       size_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: <code>napi_value</code> representing JavaScript string.</li><li><code>[in] buf</code>: Buffer to write the UTF8-encoded string into. If <code>NULL</code> is passed in, the length of the string in bytes and excluding the null terminator is returned in <code>result</code>.</li><li><code>[in] bufsize</code>: Size of the destination buffer. When this value is insufficient, the returned string is truncated and null-terminated.</li><li><code>[out] result</code>: Number of bytes copied into the buffer, excluding the null terminator.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded. If a non-<code>string</code> <code>napi_value</code> is passed in it returns <code>napi_string_expected</code>.</p><p>This API returns the UTF8-encoded string corresponding the value passed in.</p><h4 id="napi-get-value-string-utf16" tabindex="-1"><code>napi_get_value_string_utf16</code> <a class="header-anchor" href="#napi-get-value-string-utf16" aria-label="Permalink to &quot;\`napi_get_value_string_utf16\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_value_string_utf16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                        napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                                        char16_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> buf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                        size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> bufsize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                        size_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: <code>napi_value</code> representing JavaScript string.</li><li><code>[in] buf</code>: Buffer to write the UTF16-LE-encoded string into. If <code>NULL</code> is passed in, the length of the string in 2-byte code units and excluding the null terminator is returned.</li><li><code>[in] bufsize</code>: Size of the destination buffer. When this value is insufficient, the returned string is truncated and null-terminated.</li><li><code>[out] result</code>: Number of 2-byte code units copied into the buffer, excluding the null terminator.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded. If a non-<code>string</code> <code>napi_value</code> is passed in it returns <code>napi_string_expected</code>.</p><p>This API returns the UTF16-encoded string corresponding the value passed in.</p><h4 id="napi-get-value-uint32" tabindex="-1"><code>napi_get_value_uint32</code> <a class="header-anchor" href="#napi-get-value-uint32" aria-label="Permalink to &quot;\`napi_get_value_uint32\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_value_uint32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                  uint32_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: <code>napi_value</code> representing JavaScript <code>number</code>.</li><li><code>[out] result</code>: C primitive equivalent of the given <code>napi_value</code> as a <code>uint32_t</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded. If a non-number <code>napi_value</code> is passed in it returns <code>napi_number_expected</code>.</p><p>This API returns the C primitive equivalent of the given <code>napi_value</code> as a <code>uint32_t</code>.</p><h3 id="functions-to-get-global-instances" tabindex="-1">Functions to get global instances <a class="header-anchor" href="#functions-to-get-global-instances" aria-label="Permalink to &quot;Functions to get global instances&quot;">​</a></h3><h4 id="napi-get-boolean" tabindex="-1"><code>napi_get_boolean</code> <a class="header-anchor" href="#napi-get-boolean" aria-label="Permalink to &quot;\`napi_get_boolean\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: The value of the boolean to retrieve.</li><li><code>[out] result</code>: <code>napi_value</code> representing JavaScript <code>Boolean</code> singleton to retrieve.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API is used to return the JavaScript singleton object that is used to represent the given boolean value.</p><h4 id="napi-get-global" tabindex="-1"><code>napi_get_global</code> <a class="header-anchor" href="#napi-get-global" aria-label="Permalink to &quot;\`napi_get_global\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_global</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[out] result</code>: <code>napi_value</code> representing JavaScript <code>global</code> object.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API returns the <code>global</code> object.</p><h4 id="napi-get-null" tabindex="-1"><code>napi_get_null</code> <a class="header-anchor" href="#napi-get-null" aria-label="Permalink to &quot;\`napi_get_null\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[out] result</code>: <code>napi_value</code> representing JavaScript <code>null</code> object.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API returns the <code>null</code> object.</p><h4 id="napi-get-undefined" tabindex="-1"><code>napi_get_undefined</code> <a class="header-anchor" href="#napi-get-undefined" aria-label="Permalink to &quot;\`napi_get_undefined\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[out] result</code>: <code>napi_value</code> representing JavaScript Undefined value.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API returns the Undefined object.</p><h2 id="working-with-javascript-values-and-abstract-operations" tabindex="-1">Working with JavaScript values and abstract operations <a class="header-anchor" href="#working-with-javascript-values-and-abstract-operations" aria-label="Permalink to &quot;Working with JavaScript values and abstract operations&quot;">​</a></h2><p>Node-API exposes a set of APIs to perform some abstract operations on JavaScript values. Some of these operations are documented under [Section 7 of the [ECMAScript Language Specification.</p><p>These APIs support doing one of the following:</p><ol><li>Coerce JavaScript values to specific JavaScript types (such as <code>number</code> or <code>string</code>).</li><li>Check the type of a JavaScript value.</li><li>Check for equality between two JavaScript values.</li></ol><h3 id="napi-coerce-to-bool" tabindex="-1"><code>napi_coerce_to_bool</code> <a class="header-anchor" href="#napi-coerce-to-bool" aria-label="Permalink to &quot;\`napi_coerce_to_bool\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_coerce_to_bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: The JavaScript value to coerce.</li><li><code>[out] result</code>: <code>napi_value</code> representing the coerced JavaScript <code>Boolean</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API implements the abstract operation <code>ToBoolean()</code> as defined in [Section 7.1.2 of the ECMAScript Language Specification.</p><h3 id="napi-coerce-to-number" tabindex="-1"><code>napi_coerce_to_number</code> <a class="header-anchor" href="#napi-coerce-to-number" aria-label="Permalink to &quot;\`napi_coerce_to_number\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_coerce_to_number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: The JavaScript value to coerce.</li><li><code>[out] result</code>: <code>napi_value</code> representing the coerced JavaScript <code>number</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API implements the abstract operation <code>ToNumber()</code> as defined in [Section 7.1.3 of the ECMAScript Language Specification. This function potentially runs JS code if the passed-in value is an object.</p><h3 id="napi-coerce-to-object" tabindex="-1"><code>napi_coerce_to_object</code> <a class="header-anchor" href="#napi-coerce-to-object" aria-label="Permalink to &quot;\`napi_coerce_to_object\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_coerce_to_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: The JavaScript value to coerce.</li><li><code>[out] result</code>: <code>napi_value</code> representing the coerced JavaScript <code>Object</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API implements the abstract operation <code>ToObject()</code> as defined in [Section 7.1.13 of the ECMAScript Language Specification.</p><h3 id="napi-coerce-to-string" tabindex="-1"><code>napi_coerce_to_string</code> <a class="header-anchor" href="#napi-coerce-to-string" aria-label="Permalink to &quot;\`napi_coerce_to_string\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_coerce_to_string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: The JavaScript value to coerce.</li><li><code>[out] result</code>: <code>napi_value</code> representing the coerced JavaScript <code>string</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API implements the abstract operation <code>ToString()</code> as defined in [Section 7.1.13 of the ECMAScript Language Specification. This function potentially runs JS code if the passed-in value is an object.</p><h3 id="napi-typeof" tabindex="-1"><code>napi_typeof</code> <a class="header-anchor" href="#napi-typeof" aria-label="Permalink to &quot;\`napi_typeof\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_valuetype</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: The JavaScript value whose type to query.</li><li><code>[out] result</code>: The type of the JavaScript value.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><ul><li><code>napi_invalid_arg</code> if the type of <code>value</code> is not a known ECMAScript type and <code>value</code> is not an External value.</li></ul><p>This API represents behavior similar to invoking the <code>typeof</code> Operator on the object as defined in [Section 12.5.5 of the ECMAScript Language Specification. However, there are some differences:</p><ol><li>It has support for detecting an External value.</li><li>It detects <code>null</code> as a separate type, while ECMAScript <code>typeof</code> would detect <code>object</code>.</li></ol><p>If <code>value</code> has a type that is invalid, an error is returned.</p><h3 id="napi-instanceof" tabindex="-1"><code>napi_instanceof</code> <a class="header-anchor" href="#napi-instanceof" aria-label="Permalink to &quot;\`napi_instanceof\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_instanceof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                            bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] object</code>: The JavaScript value to check.</li><li><code>[in] constructor</code>: The JavaScript function object of the constructor function to check against.</li><li><code>[out] result</code>: Boolean that is set to true if <code>object instanceof constructor</code> is true.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API represents invoking the <code>instanceof</code> Operator on the object as defined in [Section 12.10.4 of the ECMAScript Language Specification.</p><h3 id="napi-is-array" tabindex="-1"><code>napi_is_array</code> <a class="header-anchor" href="#napi-is-array" aria-label="Permalink to &quot;\`napi_is_array\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_is_array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: The JavaScript value to check.</li><li><code>[out] result</code>: Whether the given object is an array.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API represents invoking the <code>IsArray</code> operation on the object as defined in [Section 7.2.2 of the ECMAScript Language Specification.</p><h3 id="napi-is-arraybuffer" tabindex="-1"><code>napi_is_arraybuffer</code> <a class="header-anchor" href="#napi-is-arraybuffer" aria-label="Permalink to &quot;\`napi_is_arraybuffer\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_is_arraybuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: The JavaScript value to check.</li><li><code>[out] result</code>: Whether the given object is an <code>ArrayBuffer</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API checks if the <code>Object</code> passed in is an array buffer.</p><h3 id="napi-is-buffer" tabindex="-1"><code>napi_is_buffer</code> <a class="header-anchor" href="#napi-is-buffer" aria-label="Permalink to &quot;\`napi_is_buffer\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_is_buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: The JavaScript value to check.</li><li><code>[out] result</code>: Whether the given <code>napi_value</code> represents a <code>node::Buffer</code> object.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API checks if the <code>Object</code> passed in is a buffer.</p><h3 id="napi-is-date" tabindex="-1"><code>napi_is_date</code> <a class="header-anchor" href="#napi-is-date" aria-label="Permalink to &quot;\`napi_is_date\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_is_date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: The JavaScript value to check.</li><li><code>[out] result</code>: Whether the given <code>napi_value</code> represents a JavaScript <code>Date</code> object.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API checks if the <code>Object</code> passed in is a date.</p><h3 id="napi-is-error-1" tabindex="-1"><code>napi_is_error</code> <a class="header-anchor" href="#napi-is-error-1" aria-label="Permalink to &quot;\`napi_is_error\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_is_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: The JavaScript value to check.</li><li><code>[out] result</code>: Whether the given <code>napi_value</code> represents an <code>Error</code> object.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API checks if the <code>Object</code> passed in is an <code>Error</code>.</p><h3 id="napi-is-typedarray" tabindex="-1"><code>napi_is_typedarray</code> <a class="header-anchor" href="#napi-is-typedarray" aria-label="Permalink to &quot;\`napi_is_typedarray\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_is_typedarray</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: The JavaScript value to check.</li><li><code>[out] result</code>: Whether the given <code>napi_value</code> represents a <code>TypedArray</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API checks if the <code>Object</code> passed in is a typed array.</p><h3 id="napi-is-dataview" tabindex="-1"><code>napi_is_dataview</code> <a class="header-anchor" href="#napi-is-dataview" aria-label="Permalink to &quot;\`napi_is_dataview\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_is_dataview</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: The JavaScript value to check.</li><li><code>[out] result</code>: Whether the given <code>napi_value</code> represents a <code>DataView</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API checks if the <code>Object</code> passed in is a <code>DataView</code>.</p><h3 id="napi-strict-equals" tabindex="-1"><code>napi_strict_equals</code> <a class="header-anchor" href="#napi-strict-equals" aria-label="Permalink to &quot;\`napi_strict_equals\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_strict_equals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">lhs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">rhs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                               bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] lhs</code>: The JavaScript value to check.</li><li><code>[in] rhs</code>: The JavaScript value to check against.</li><li><code>[out] result</code>: Whether the two <code>napi_value</code> objects are equal.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API represents the invocation of the Strict Equality algorithm as defined in [Section 7.2.14 of the ECMAScript Language Specification.</p><h3 id="napi-detach-arraybuffer" tabindex="-1"><code>napi_detach_arraybuffer</code> <a class="header-anchor" href="#napi-detach-arraybuffer" aria-label="Permalink to &quot;\`napi_detach_arraybuffer\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_detach_arraybuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                    napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">arraybuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] arraybuffer</code>: The JavaScript <code>ArrayBuffer</code> to be detached.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded. If a non-detachable <code>ArrayBuffer</code> is passed in it returns <code>napi_detachable_arraybuffer_expected</code>.</p><p>Generally, an <code>ArrayBuffer</code> is non-detachable if it has been detached before. The engine may impose additional conditions on whether an <code>ArrayBuffer</code> is detachable. For example, V8 requires that the <code>ArrayBuffer</code> be external, that is, created with <code>napi_create_external_arraybuffer</code>.</p><p>This API represents the invocation of the <code>ArrayBuffer</code> detach operation as defined in [Section 24.1.1.3 of the ECMAScript Language Specification.</p><h3 id="napi-is-detached-arraybuffer" tabindex="-1"><code>napi_is_detached_arraybuffer</code> <a class="header-anchor" href="#napi-is-detached-arraybuffer" aria-label="Permalink to &quot;\`napi_is_detached_arraybuffer\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_is_detached_arraybuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                         napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">arraybuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                         bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] arraybuffer</code>: The JavaScript <code>ArrayBuffer</code> to be checked.</li><li><code>[out] result</code>: Whether the <code>arraybuffer</code> is detached.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>The <code>ArrayBuffer</code> is considered detached if its internal data is <code>null</code>.</p><p>This API represents the invocation of the <code>ArrayBuffer</code> <code>IsDetachedBuffer</code> operation as defined in [Section 24.1.1.2 of the ECMAScript Language Specification.</p><h2 id="working-with-javascript-properties" tabindex="-1">Working with JavaScript properties <a class="header-anchor" href="#working-with-javascript-properties" aria-label="Permalink to &quot;Working with JavaScript properties&quot;">​</a></h2><p>Node-API exposes a set of APIs to get and set properties on JavaScript objects. Some of these types are documented under [Section 7 of the [ECMAScript Language Specification.</p><p>Properties in JavaScript are represented as a tuple of a key and a value. Fundamentally, all property keys in Node-API can be represented in one of the following forms:</p><ul><li>Named: a simple UTF8-encoded string</li><li>Integer-Indexed: an index value represented by <code>uint32_t</code></li><li>JavaScript value: these are represented in Node-API by <code>napi_value</code>. This can be a <code>napi_value</code> representing a <code>string</code>, <code>number</code>, or <code>symbol</code>.</li></ul><p>Node-API values are represented by the type <code>napi_value</code>. Any Node-API call that requires a JavaScript value takes in a <code>napi_value</code>. However, it&#39;s the caller&#39;s responsibility to make sure that the <code>napi_value</code> in question is of the JavaScript type expected by the API.</p><p>The APIs documented in this section provide a simple interface to get and set properties on arbitrary JavaScript objects represented by <code>napi_value</code>.</p><p>For instance, consider the following JavaScript code snippet:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> obj</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {};</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">obj.myProp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 123</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>The equivalent can be done using Node-API values with the following snippet:</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_generic_failure;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// const obj = {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value obj, value;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">obj</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Create a napi_value for 123</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_int32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// obj.myProp = 123</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_set_named_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, obj, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;myProp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, value);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status;</span></span></code></pre></div><p>Indexed properties can be set in a similar manner. Consider the following JavaScript snippet:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> arr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">arr[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;hello&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>The equivalent can be done using Node-API values with the following snippet:</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_generic_failure;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// const arr = [];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value arr, value;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">arr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Create a napi_value for &#39;hello&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_string_utf8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, NAPI_AUTO_LENGTH, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// arr[123] = &#39;hello&#39;;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_set_element</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, arr, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, value);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status;</span></span></code></pre></div><p>Properties can be retrieved using the APIs described in this section. Consider the following JavaScript snippet:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> arr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> arr[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span></code></pre></div><p>The following is the approximate equivalent of the Node-API counterpart:</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_generic_failure;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// const arr = []</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value arr, value;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">arr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// const value = arr[123]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_get_element</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, arr, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status;</span></span></code></pre></div><p>Finally, multiple properties can also be defined on an object for performance reasons. Consider the following JavaScript:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> obj</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {};</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Object.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">defineProperties</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(obj, {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;foo&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { value: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, writable: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, configurable: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, enumerable: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;bar&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { value: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">456</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, writable: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, configurable: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, enumerable: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p>The following is the approximate equivalent of the Node-API counterpart:</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_status_generic_failure;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// const obj = {};</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value obj;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">obj</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Create napi_values for 123 and 456</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value fooValue, barValue;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_int32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">fooValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_int32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">456</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">barValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Set the properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_property_descriptor descriptors</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">[]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;foo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, fooValue, napi_writable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_configurable, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;bar&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, barValue, napi_writable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_configurable, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_define_properties</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                obj,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(descriptors) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">descriptors</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                descriptors);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status;</span></span></code></pre></div><h3 id="structures" tabindex="-1">Structures <a class="header-anchor" href="#structures" aria-label="Permalink to &quot;Structures&quot;">​</a></h3><h4 id="napi-property-attributes" tabindex="-1"><code>napi_property_attributes</code> <a class="header-anchor" href="#napi-property-attributes" aria-label="Permalink to &quot;\`napi_property_attributes\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_default </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_writable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_enumerable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_configurable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Used with napi_define_class to distinguish static properties</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // from instance properties. Ignored by napi_define_properties.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_static </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Default for class methods.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_default_method </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_writable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_configurable,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Default for object properties, like in JS obj[prop].</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_default_jsproperty </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_writable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                          napi_enumerable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                          napi_configurable,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} napi_property_attributes;</span></span></code></pre></div><p><code>napi_property_attributes</code> are flags used to control the behavior of properties set on a JavaScript object. Other than <code>napi_static</code> they correspond to the attributes listed in [Section 6.1.7.1 of the [ECMAScript Language Specification. They can be one or more of the following bitflags:</p><ul><li><code>napi_default</code>: No explicit attributes are set on the property. By default, a property is read only, not enumerable and not configurable.</li><li><code>napi_writable</code>: The property is writable.</li><li><code>napi_enumerable</code>: The property is enumerable.</li><li><code>napi_configurable</code>: The property is configurable as defined in [Section 6.1.7.1 of the [ECMAScript Language Specification.</li><li><code>napi_static</code>: The property will be defined as a static property on a class as opposed to an instance property, which is the default. This is used only by <code>napi_define_class</code>. It is ignored by <code>napi_define_properties</code>.</li><li><code>napi_default_method</code>: Like a method in a JS class, the property is configurable and writeable, but not enumerable.</li><li><code>napi_default_jsproperty</code>: Like a property set via assignment in JavaScript, the property is writable, enumerable, and configurable.</li></ul><h4 id="napi-property-descriptor" tabindex="-1"><code>napi_property_descriptor</code> <a class="header-anchor" href="#napi-property-descriptor" aria-label="Permalink to &quot;\`napi_property_descriptor\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // One of utf8name or name should be NULL.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> utf8name;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_value name;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_callback method;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_callback getter;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_callback setter;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_value value;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_property_attributes attributes;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} napi_property_descriptor;</span></span></code></pre></div><ul><li><code>utf8name</code>: Optional string describing the key for the property, encoded as UTF8. One of <code>utf8name</code> or <code>name</code> must be provided for the property.</li><li><code>name</code>: Optional <code>napi_value</code> that points to a JavaScript string or symbol to be used as the key for the property. One of <code>utf8name</code> or <code>name</code> must be provided for the property.</li><li><code>value</code>: The value that&#39;s retrieved by a get access of the property if the property is a data property. If this is passed in, set <code>getter</code>, <code>setter</code>, <code>method</code> and <code>data</code> to <code>NULL</code> (since these members won&#39;t be used).</li><li><code>getter</code>: A function to call when a get access of the property is performed. If this is passed in, set <code>value</code> and <code>method</code> to <code>NULL</code> (since these members won&#39;t be used). The given function is called implicitly by the runtime when the property is accessed from JavaScript code (or if a get on the property is performed using a Node-API call). <code>napi_callback</code> provides more details.</li><li><code>setter</code>: A function to call when a set access of the property is performed. If this is passed in, set <code>value</code> and <code>method</code> to <code>NULL</code> (since these members won&#39;t be used). The given function is called implicitly by the runtime when the property is set from JavaScript code (or if a set on the property is performed using a Node-API call). <code>napi_callback</code> provides more details.</li><li><code>method</code>: Set this to make the property descriptor object&#39;s <code>value</code> property to be a JavaScript function represented by <code>method</code>. If this is passed in, set <code>value</code>, <code>getter</code> and <code>setter</code> to <code>NULL</code> (since these members won&#39;t be used). <code>napi_callback</code> provides more details.</li><li><code>attributes</code>: The attributes associated with the particular property. See <code>napi_property_attributes</code>.</li><li><code>data</code>: The callback data passed into <code>method</code>, <code>getter</code> and <code>setter</code> if this function is invoked.</li></ul><h3 id="functions" tabindex="-1">Functions <a class="header-anchor" href="#functions" aria-label="Permalink to &quot;Functions&quot;">​</a></h3><h4 id="napi-get-property-names" tabindex="-1"><code>napi_get_property_names</code> <a class="header-anchor" href="#napi-get-property-names" aria-label="Permalink to &quot;\`napi_get_property_names\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_property_names</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                    napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                    napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the Node-API call is invoked under.</li><li><code>[in] object</code>: The object from which to retrieve the properties.</li><li><code>[out] result</code>: A <code>napi_value</code> representing an array of JavaScript values that represent the property names of the object. The API can be used to iterate over <code>result</code> using <code>napi_get_array_length</code> and <code>napi_get_element</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API returns the names of the enumerable properties of <code>object</code> as an array of strings. The properties of <code>object</code> whose key is a symbol will not be included.</p><h4 id="napi-get-all-property-names" tabindex="-1"><code>napi_get_all_property_names</code> <a class="header-anchor" href="#napi-get-all-property-names" aria-label="Permalink to &quot;\`napi_get_all_property_names\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_all_property_names</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            napi_key_collection_mode </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key_mode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            napi_key_filter </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key_filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            napi_key_conversion </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key_conversion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the Node-API call is invoked under.</li><li><code>[in] object</code>: The object from which to retrieve the properties.</li><li><code>[in] key_mode</code>: Whether to retrieve prototype properties as well.</li><li><code>[in] key_filter</code>: Which properties to retrieve (enumerable/readable/writable).</li><li><code>[in] key_conversion</code>: Whether to convert numbered property keys to strings.</li><li><code>[out] result</code>: A <code>napi_value</code> representing an array of JavaScript values that represent the property names of the object. <code>napi_get_array_length</code> and <code>napi_get_element</code> can be used to iterate over <code>result</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API returns an array containing the names of the available properties of this object.</p><h4 id="napi-set-property" tabindex="-1"><code>napi_set_property</code> <a class="header-anchor" href="#napi-set-property" aria-label="Permalink to &quot;\`napi_set_property\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_set_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                              napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                              napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                              napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the Node-API call is invoked under.</li><li><code>[in] object</code>: The object on which to set the property.</li><li><code>[in] key</code>: The name of the property to set.</li><li><code>[in] value</code>: The property value.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API set a property on the <code>Object</code> passed in.</p><h4 id="napi-get-property" tabindex="-1"><code>napi_get_property</code> <a class="header-anchor" href="#napi-get-property" aria-label="Permalink to &quot;\`napi_get_property\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                              napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                              napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                              napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the Node-API call is invoked under.</li><li><code>[in] object</code>: The object from which to retrieve the property.</li><li><code>[in] key</code>: The name of the property to retrieve.</li><li><code>[out] result</code>: The value of the property.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API gets the requested property from the <code>Object</code> passed in.</p><h4 id="napi-has-property" tabindex="-1"><code>napi_has_property</code> <a class="header-anchor" href="#napi-has-property" aria-label="Permalink to &quot;\`napi_has_property\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_has_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                              napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                              napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                              bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the Node-API call is invoked under.</li><li><code>[in] object</code>: The object to query.</li><li><code>[in] key</code>: The name of the property whose existence to check.</li><li><code>[out] result</code>: Whether the property exists on the object or not.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API checks if the <code>Object</code> passed in has the named property.</p><h4 id="napi-delete-property" tabindex="-1"><code>napi_delete_property</code> <a class="header-anchor" href="#napi-delete-property" aria-label="Permalink to &quot;\`napi_delete_property\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_delete_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the Node-API call is invoked under.</li><li><code>[in] object</code>: The object to query.</li><li><code>[in] key</code>: The name of the property to delete.</li><li><code>[out] result</code>: Whether the property deletion succeeded or not. <code>result</code> can optionally be ignored by passing <code>NULL</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API attempts to delete the <code>key</code> own property from <code>object</code>.</p><h4 id="napi-has-own-property" tabindex="-1"><code>napi_has_own_property</code> <a class="header-anchor" href="#napi-has-own-property" aria-label="Permalink to &quot;\`napi_has_own_property\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_has_own_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                  bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the Node-API call is invoked under.</li><li><code>[in] object</code>: The object to query.</li><li><code>[in] key</code>: The name of the own property whose existence to check.</li><li><code>[out] result</code>: Whether the own property exists on the object or not.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API checks if the <code>Object</code> passed in has the named own property. <code>key</code> must be a <code>string</code> or a <code>symbol</code>, or an error will be thrown. Node-API will not perform any conversion between data types.</p><h4 id="napi-set-named-property" tabindex="-1"><code>napi_set_named_property</code> <a class="header-anchor" href="#napi-set-named-property" aria-label="Permalink to &quot;\`napi_set_named_property\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_set_named_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                    napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                    const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> utf8Name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                    napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the Node-API call is invoked under.</li><li><code>[in] object</code>: The object on which to set the property.</li><li><code>[in] utf8Name</code>: The name of the property to set.</li><li><code>[in] value</code>: The property value.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This method is equivalent to calling <code>napi_set_property</code> with a <code>napi_value</code> created from the string passed in as <code>utf8Name</code>.</p><h4 id="napi-get-named-property" tabindex="-1"><code>napi_get_named_property</code> <a class="header-anchor" href="#napi-get-named-property" aria-label="Permalink to &quot;\`napi_get_named_property\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_named_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                    napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                    const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> utf8Name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                    napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the Node-API call is invoked under.</li><li><code>[in] object</code>: The object from which to retrieve the property.</li><li><code>[in] utf8Name</code>: The name of the property to get.</li><li><code>[out] result</code>: The value of the property.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This method is equivalent to calling <code>napi_get_property</code> with a <code>napi_value</code> created from the string passed in as <code>utf8Name</code>.</p><h4 id="napi-has-named-property" tabindex="-1"><code>napi_has_named_property</code> <a class="header-anchor" href="#napi-has-named-property" aria-label="Permalink to &quot;\`napi_has_named_property\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_has_named_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                    napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                    const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> utf8Name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                    bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the Node-API call is invoked under.</li><li><code>[in] object</code>: The object to query.</li><li><code>[in] utf8Name</code>: The name of the property whose existence to check.</li><li><code>[out] result</code>: Whether the property exists on the object or not.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This method is equivalent to calling <code>napi_has_property</code> with a <code>napi_value</code> created from the string passed in as <code>utf8Name</code>.</p><h4 id="napi-set-element" tabindex="-1"><code>napi_set_element</code> <a class="header-anchor" href="#napi-set-element" aria-label="Permalink to &quot;\`napi_set_element\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_set_element</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                             napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                             uint32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                             napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the Node-API call is invoked under.</li><li><code>[in] object</code>: The object from which to set the properties.</li><li><code>[in] index</code>: The index of the property to set.</li><li><code>[in] value</code>: The property value.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API sets an element on the <code>Object</code> passed in.</p><h4 id="napi-get-element" tabindex="-1"><code>napi_get_element</code> <a class="header-anchor" href="#napi-get-element" aria-label="Permalink to &quot;\`napi_get_element\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_element</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                             napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                             uint32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                             napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the Node-API call is invoked under.</li><li><code>[in] object</code>: The object from which to retrieve the property.</li><li><code>[in] index</code>: The index of the property to get.</li><li><code>[out] result</code>: The value of the property.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API gets the element at the requested index.</p><h4 id="napi-has-element" tabindex="-1"><code>napi_has_element</code> <a class="header-anchor" href="#napi-has-element" aria-label="Permalink to &quot;\`napi_has_element\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_has_element</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                             napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                             uint32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                             bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the Node-API call is invoked under.</li><li><code>[in] object</code>: The object to query.</li><li><code>[in] index</code>: The index of the property whose existence to check.</li><li><code>[out] result</code>: Whether the property exists on the object or not.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API returns if the <code>Object</code> passed in has an element at the requested index.</p><h4 id="napi-delete-element" tabindex="-1"><code>napi_delete_element</code> <a class="header-anchor" href="#napi-delete-element" aria-label="Permalink to &quot;\`napi_delete_element\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_delete_element</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                uint32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the Node-API call is invoked under.</li><li><code>[in] object</code>: The object to query.</li><li><code>[in] index</code>: The index of the property to delete.</li><li><code>[out] result</code>: Whether the element deletion succeeded or not. <code>result</code> can optionally be ignored by passing <code>NULL</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API attempts to delete the specified <code>index</code> from <code>object</code>.</p><h4 id="napi-define-properties" tabindex="-1"><code>napi_define_properties</code> <a class="header-anchor" href="#napi-define-properties" aria-label="Permalink to &quot;\`napi_define_properties\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_define_properties</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                   size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> property_count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                   const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_property_descriptor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> properties</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the Node-API call is invoked under.</li><li><code>[in] object</code>: The object from which to retrieve the properties.</li><li><code>[in] property_count</code>: The number of elements in the <code>properties</code> array.</li><li><code>[in] properties</code>: The array of property descriptors.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This method allows the efficient definition of multiple properties on a given object. The properties are defined using property descriptors (see <code>napi_property_descriptor</code>). Given an array of such property descriptors, this API will set the properties on the object one at a time, as defined by <code>DefineOwnProperty()</code> (described in [Section 9.1.6 of the ECMA-262 specification).</p><h4 id="napi-object-freeze" tabindex="-1"><code>napi_object_freeze</code> <a class="header-anchor" href="#napi-object-freeze" aria-label="Permalink to &quot;\`napi_object_freeze\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_object_freeze</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the Node-API call is invoked under.</li><li><code>[in] object</code>: The object to freeze.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This method freezes a given object. This prevents new properties from being added to it, existing properties from being removed, prevents changing the enumerability, configurability, or writability of existing properties, and prevents the values of existing properties from being changed. It also prevents the object&#39;s prototype from being changed. This is described in <a href="https://tc39.es/ecma262/#sec-object.freeze" target="_blank" rel="noreferrer">Section 19.1.2.6</a> of the ECMA-262 specification.</p><h4 id="napi-object-seal" tabindex="-1"><code>napi_object_seal</code> <a class="header-anchor" href="#napi-object-seal" aria-label="Permalink to &quot;\`napi_object_seal\`&quot;">​</a></h4><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_object_seal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                             napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the Node-API call is invoked under.</li><li><code>[in] object</code>: The object to seal.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This method seals a given object. This prevents new properties from being added to it, as well as marking all existing properties as non-configurable. This is described in <a href="https://tc39.es/ecma262/#sec-object.seal" target="_blank" rel="noreferrer">Section 19.1.2.20</a> of the ECMA-262 specification.</p><h2 id="working-with-javascript-functions" tabindex="-1">Working with JavaScript functions <a class="header-anchor" href="#working-with-javascript-functions" aria-label="Permalink to &quot;Working with JavaScript functions&quot;">​</a></h2><p>Node-API provides a set of APIs that allow JavaScript code to call back into native code. Node-APIs that support calling back into native code take in a callback functions represented by the <code>napi_callback</code> type. When the JavaScript VM calls back to native code, the <code>napi_callback</code> function provided is invoked. The APIs documented in this section allow the callback function to do the following:</p><ul><li>Get information about the context in which the callback was invoked.</li><li>Get the arguments passed into the callback.</li><li>Return a <code>napi_value</code> back from the callback.</li></ul><p>Additionally, Node-API provides a set of functions which allow calling JavaScript functions from native code. One can either call a function like a regular JavaScript function call, or as a constructor function.</p><p>Any non-<code>NULL</code> data which is passed to this API via the <code>data</code> field of the <code>napi_property_descriptor</code> items can be associated with <code>object</code> and freed whenever <code>object</code> is garbage-collected by passing both <code>object</code> and the data to <code>napi_add_finalizer</code>.</p><h3 id="napi-call-function" tabindex="-1"><code>napi_call_function</code> <a class="header-anchor" href="#napi-call-function" aria-label="Permalink to &quot;\`napi_call_function\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_call_function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                           napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">recv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                           napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                           size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> argc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                           const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                           napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] recv</code>: The <code>this</code> value passed to the called function.</li><li><code>[in] func</code>: <code>napi_value</code> representing the JavaScript function to be invoked.</li><li><code>[in] argc</code>: The count of elements in the <code>argv</code> array.</li><li><code>[in] argv</code>: Array of <code>napi_values</code> representing JavaScript values passed in as arguments to the function.</li><li><code>[out] result</code>: <code>napi_value</code> representing the JavaScript object returned.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This method allows a JavaScript function object to be called from a native add-on. This is the primary mechanism of calling back <em>from</em> the add-on&#39;s native code <em>into</em> JavaScript. For the special case of calling into JavaScript after an async operation, see <code>napi_make_callback</code>.</p><p>A sample use case might look as follows. Consider the following JavaScript snippet:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AddTwo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">num</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> num </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">global.AddTwo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AddTwo;</span></span></code></pre></div><p>Then, the above function can be invoked from a native add-on using the following code:</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Get the function named &quot;AddTwo&quot; on the global object</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value global, add_two, arg;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_get_global</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">global</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_get_named_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, global, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;AddTwo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">add_two</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// const arg = 1337</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_int32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1337</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">arg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> argv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">arg;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">size_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> argc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// AddTwo(arg);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value return_val;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_call_function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, global, add_two, argc, argv, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">return_val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Convert the result back to a native type</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_get_value_int32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, return_val, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h3 id="napi-create-function" tabindex="-1"><code>napi_create_function</code> <a class="header-anchor" href="#napi-create-function" aria-label="Permalink to &quot;\`napi_create_function\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> utf8name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_callback </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] utf8Name</code>: Optional name of the function encoded as UTF8. This is visible within JavaScript as the new function object&#39;s <code>name</code> property.</li><li><code>[in] length</code>: The length of the <code>utf8name</code> in bytes, or <code>NAPI_AUTO_LENGTH</code> if it is null-terminated.</li><li><code>[in] cb</code>: The native function which should be called when this function object is invoked. <code>napi_callback</code> provides more details.</li><li><code>[in] data</code>: User-provided data context. This will be passed back into the function when invoked later.</li><li><code>[out] result</code>: <code>napi_value</code> representing the JavaScript function object for the newly created function.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API allows an add-on author to create a function object in native code. This is the primary mechanism to allow calling <em>into</em> the add-on&#39;s native code <em>from</em> JavaScript.</p><p>The newly created function is not automatically visible from script after this call. Instead, a property must be explicitly set on any object that is visible to JavaScript, in order for the function to be accessible from script.</p><p>In order to expose a function as part of the add-on&#39;s module exports, set the newly created function on the exports object. A sample module might look as follows:</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SayHello</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_callback_info </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  printf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">exports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_status status;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_value fn;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, SayHello, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fn);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_set_named_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, exports, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sayHello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, fn);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exports;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAPI_MODULE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(NODE_GYP_MODULE_NAME, Init)</span></span></code></pre></div><p>Given the above code, the add-on can be used from JavaScript as follows:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> myaddon</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./addon&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">myaddon.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sayHello</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><p>The string passed to <code>require()</code> is the name of the target in <code>binding.gyp</code> responsible for creating the <code>.node</code> file.</p><p>Any non-<code>NULL</code> data which is passed to this API via the <code>data</code> parameter can be associated with the resulting JavaScript function (which is returned in the <code>result</code> parameter) and freed whenever the function is garbage-collected by passing both the JavaScript function and the data to <code>napi_add_finalizer</code>.</p><p>JavaScript <code>Function</code>s are described in [Section 19.2 of the ECMAScript Language Specification.</p><h3 id="napi-get-cb-info" tabindex="-1"><code>napi_get_cb_info</code> <a class="header-anchor" href="#napi-get-cb-info" aria-label="Permalink to &quot;\`napi_get_cb_info\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_cb_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                             napi_callback_info </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">cbinfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                             size_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> argc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                             napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                             napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> thisArg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                             void**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] cbinfo</code>: The callback info passed into the callback function.</li><li><code>[in-out] argc</code>: Specifies the length of the provided <code>argv</code> array and receives the actual count of arguments. <code>argc</code> can optionally be ignored by passing <code>NULL</code>.</li><li><code>[out] argv</code>: C array of <code>napi_value</code>s to which the arguments will be copied. If there are more arguments than the provided count, only the requested number of arguments are copied. If there are fewer arguments provided than claimed, the rest of <code>argv</code> is filled with <code>napi_value</code> values that represent <code>undefined</code>. <code>argv</code> can optionally be ignored by passing <code>NULL</code>.</li><li><code>[out] thisArg</code>: Receives the JavaScript <code>this</code> argument for the call. <code>thisArg</code> can optionally be ignored by passing <code>NULL</code>.</li><li><code>[out] data</code>: Receives the data pointer for the callback. <code>data</code> can optionally be ignored by passing <code>NULL</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This method is used within a callback function to retrieve details about the call like the arguments and the <code>this</code> pointer from a given callback info.</p><h3 id="napi-get-new-target" tabindex="-1"><code>napi_get_new_target</code> <a class="header-anchor" href="#napi-get-new-target" aria-label="Permalink to &quot;\`napi_get_new_target\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_new_target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_callback_info </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">cbinfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] cbinfo</code>: The callback info passed into the callback function.</li><li><code>[out] result</code>: The <code>new.target</code> of the constructor call.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API returns the <code>new.target</code> of the constructor call. If the current callback is not a constructor call, the result is <code>NULL</code>.</p><h3 id="napi-new-instance" tabindex="-1"><code>napi_new_instance</code> <a class="header-anchor" href="#napi-new-instance" aria-label="Permalink to &quot;\`napi_new_instance\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_new_instance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                              napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">cons</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                              size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> argc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                              napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                              napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] cons</code>: <code>napi_value</code> representing the JavaScript function to be invoked as a constructor.</li><li><code>[in] argc</code>: The count of elements in the <code>argv</code> array.</li><li><code>[in] argv</code>: Array of JavaScript values as <code>napi_value</code> representing the arguments to the constructor. If <code>argc</code> is zero this parameter may be omitted by passing in <code>NULL</code>.</li><li><code>[out] result</code>: <code>napi_value</code> representing the JavaScript object returned, which in this case is the constructed object.</li></ul><p>This method is used to instantiate a new JavaScript value using a given <code>napi_value</code> that represents the constructor for the object. For example, consider the following snippet:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyObject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">param</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.param </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> param;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> arg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;hello&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyObject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(arg);</span></span></code></pre></div><p>The following can be approximated in Node-API using the following snippet:</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Get the constructor function MyObject</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value global, constructor, arg, value;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_get_global</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">global</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_get_named_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, global, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MyObject&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// const arg = &quot;hello&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_string_utf8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, NAPI_AUTO_LENGTH, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">arg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> argv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">arg;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">size_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> argc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// const value = new MyObject(arg)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_new_instance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, constructor, argc, argv, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>Returns <code>napi_ok</code> if the API succeeded.</p><h2 id="object-wrap" tabindex="-1">Object wrap <a class="header-anchor" href="#object-wrap" aria-label="Permalink to &quot;Object wrap&quot;">​</a></h2><p>Node-API offers a way to &quot;wrap&quot; C++ classes and instances so that the class constructor and methods can be called from JavaScript.</p><ol><li>The <code>napi_define_class</code> API defines a JavaScript class with constructor, static properties and methods, and instance properties and methods that correspond to the C++ class.</li><li>When JavaScript code invokes the constructor, the constructor callback uses <code>napi_wrap</code> to wrap a new C++ instance in a JavaScript object, then returns the wrapper object.</li><li>When JavaScript code invokes a method or property accessor on the class, the corresponding <code>napi_callback</code> C++ function is invoked. For an instance callback, <code>napi_unwrap</code> obtains the C++ instance that is the target of the call.</li></ol><p>For wrapped objects it may be difficult to distinguish between a function called on a class prototype and a function called on an instance of a class. A common pattern used to address this problem is to save a persistent reference to the class constructor for later <code>instanceof</code> checks.</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value MyClass_constructor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_get_reference_value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, MyClass::es_constructor, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">MyClass_constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">assert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_ok </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> is_instance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_instanceof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, es_this, MyClass_constructor, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">is_instance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">assert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_ok </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (is_instance) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // napi_unwrap() ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // otherwise...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>The reference must be freed once it is no longer needed.</p><p>There are occasions where <code>napi_instanceof()</code> is insufficient for ensuring that a JavaScript object is a wrapper for a certain native type. This is the case especially when wrapped JavaScript objects are passed back into the addon via static methods rather than as the <code>this</code> value of prototype methods. In such cases there is a chance that they may be unwrapped incorrectly.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> myAddon</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./build/Release/my_addon.node&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// \`openDatabase()\` returns a JavaScript object that wraps a native database</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// handle.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> dbHandle</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> myAddon.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openDatabase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// \`query()\` returns a JavaScript object that wraps a native query handle.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> queryHandle</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> myAddon.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dbHandle, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Gimme ALL the things!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// There is an accidental error in the line below. The first parameter to</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// \`myAddon.queryHasRecords()\` should be the database handle (\`dbHandle\`), not</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// the query handle (\`query\`), so the correct condition for the while-loop</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// should be</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// myAddon.queryHasRecords(dbHandle, queryHandle)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (myAddon.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queryHasRecords</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(queryHandle, dbHandle)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // retrieve records</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>In the above example <code>myAddon.queryHasRecords()</code> is a method that accepts two arguments. The first is a database handle and the second is a query handle. Internally, it unwraps the first argument and casts the resulting pointer to a native database handle. It then unwraps the second argument and casts the resulting pointer to a query handle. If the arguments are passed in the wrong order, the casts will work, however, there is a good chance that the underlying database operation will fail, or will even cause an invalid memory access.</p><p>To ensure that the pointer retrieved from the first argument is indeed a pointer to a database handle and, similarly, that the pointer retrieved from the second argument is indeed a pointer to a query handle, the implementation of <code>queryHasRecords()</code> has to perform a type validation. Retaining the JavaScript class constructor from which the database handle was instantiated and the constructor from which the query handle was instantiated in <code>napi_ref</code>s can help, because <code>napi_instanceof()</code> can then be used to ensure that the instances passed into <code>queryHashRecords()</code> are indeed of the correct type.</p><p>Unfortunately, <code>napi_instanceof()</code> does not protect against prototype manipulation. For example, the prototype of the database handle instance can be set to the prototype of the constructor for query handle instances. In this case, the database handle instance can appear as a query handle instance, and it will pass the <code>napi_instanceof()</code> test for a query handle instance, while still containing a pointer to a database handle.</p><p>To this end, Node-API provides type-tagging capabilities.</p><p>A type tag is a 128-bit integer unique to the addon. Node-API provides the <code>napi_type_tag</code> structure for storing a type tag. When such a value is passed along with a JavaScript object or [external stored in a <code>napi_value</code> to <code>napi_type_tag_object()</code>, the JavaScript object will be &quot;marked&quot; with the type tag. The &quot;mark&quot; is invisible on the JavaScript side. When a JavaScript object arrives into a native binding, <code>napi_check_object_type_tag()</code> can be used along with the original type tag to determine whether the JavaScript object was previously &quot;marked&quot; with the type tag. This creates a type-checking capability of a higher fidelity than <code>napi_instanceof()</code> can provide, because such type- tagging survives prototype manipulation and addon unloading/reloading.</p><p>Continuing the above example, the following skeleton addon implementation illustrates the use of <code>napi_type_tag_object()</code> and <code>napi_check_object_type_tag()</code>.</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// This value is the type tag for a database handle. The command</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//   uuidgen | sed -r -e &#39;s/-//g&#39; -e &#39;s/(.{16})(.*)/0x\\1, 0x\\2/&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// can be used to obtain the two values with which to initialize the structure.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_type_tag DatabaseHandleTypeTag </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1edf75a38336451d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">a5ed9ce2e4c00c38</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// This value is the type tag for a query handle.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_type_tag QueryHandleTypeTag </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">9c73317f9fad44a3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">93c3920bf3b0ad6a</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_value</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openDatabase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_callback_info </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_status status;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_value result;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Perform the underlying action which results in a database handle.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  DatabaseHandle</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dbHandle </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> open_database</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Create a new, empty JS object.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Tag the object to indicate that it holds a pointer to a \`DatabaseHandle\`.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_type_tag_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, result, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DatabaseHandleTypeTag);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Store the pointer to the \`DatabaseHandle\` structure inside the JS object.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_wrap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, result, dbHandle, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Later when we receive a JavaScript object purporting to be a database handle</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// we can use \`napi_check_object_type_tag()\` to ensure that it is indeed such a</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// handle.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_value</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_callback_info </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_status status;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  size_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> argc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> is_db_handle;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_get_cb_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, info, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">argc, argv, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Check that the object passed as the first parameter has the previously</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // applied tag.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_check_object_type_tag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                                      argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                      &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DatabaseHandleTypeTag,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                      &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">is_db_handle);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Throw a \`TypeError\` if it doesn&#39;t.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">is_db_handle) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Throw a TypeError.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="napi-define-class" tabindex="-1"><code>napi_define_class</code> <a class="header-anchor" href="#napi-define-class" aria-label="Permalink to &quot;\`napi_define_class\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_define_class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                              const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> utf8name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                              size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                              napi_callback </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                              void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                              size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> property_count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                              const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_property_descriptor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> properties</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                              napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] utf8name</code>: Name of the JavaScript constructor function. For clarity, it is recommended to use the C++ class name when wrapping a C++ class.</li><li><code>[in] length</code>: The length of the <code>utf8name</code> in bytes, or <code>NAPI_AUTO_LENGTH</code> if it is null-terminated.</li><li><code>[in] constructor</code>: Callback function that handles constructing instances of the class. When wrapping a C++ class, this method must be a static member with the <code>napi_callback</code> signature. A C++ class constructor cannot be used. <code>napi_callback</code> provides more details.</li><li><code>[in] data</code>: Optional data to be passed to the constructor callback as the <code>data</code> property of the callback info.</li><li><code>[in] property_count</code>: Number of items in the <code>properties</code> array argument.</li><li><code>[in] properties</code>: Array of property descriptors describing static and instance data properties, accessors, and methods on the class See <code>napi_property_descriptor</code>.</li><li><code>[out] result</code>: A <code>napi_value</code> representing the constructor function for the class.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>Defines a JavaScript class, including:</p><ul><li>A JavaScript constructor function that has the class name. When wrapping a corresponding C++ class, the callback passed via <code>constructor</code> can be used to instantiate a new C++ class instance, which can then be placed inside the JavaScript object instance being constructed using <code>napi_wrap</code>.</li><li>Properties on the constructor function whose implementation can call corresponding <em>static</em> data properties, accessors, and methods of the C++ class (defined by property descriptors with the <code>napi_static</code> attribute).</li><li>Properties on the constructor function&#39;s <code>prototype</code> object. When wrapping a C++ class, <em>non-static</em> data properties, accessors, and methods of the C++ class can be called from the static functions given in the property descriptors without the <code>napi_static</code> attribute after retrieving the C++ class instance placed inside the JavaScript object instance by using <code>napi_unwrap</code>.</li></ul><p>When wrapping a C++ class, the C++ constructor callback passed via <code>constructor</code> should be a static method on the class that calls the actual class constructor, then wraps the new C++ instance in a JavaScript object, and returns the wrapper object. See <code>napi_wrap</code> for details.</p><p>The JavaScript constructor function returned from <code>napi_define_class</code> is often saved and used later to construct new instances of the class from native code, and/or to check whether provided values are instances of the class. In that case, to prevent the function value from being garbage-collected, a strong persistent reference to it can be created using <code>napi_create_reference</code>, ensuring that the reference count is kept &gt;= 1.</p><p>Any non-<code>NULL</code> data which is passed to this API via the <code>data</code> parameter or via the <code>data</code> field of the <code>napi_property_descriptor</code> array items can be associated with the resulting JavaScript constructor (which is returned in the <code>result</code> parameter) and freed whenever the class is garbage-collected by passing both the JavaScript function and the data to <code>napi_add_finalizer</code>.</p><h3 id="napi-wrap" tabindex="-1"><code>napi_wrap</code> <a class="header-anchor" href="#napi-wrap" aria-label="Permalink to &quot;\`napi_wrap\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_wrap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                      napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">js_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                      void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> native_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                      napi_finalize </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">finalize_cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                      void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> finalize_hint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                      napi_ref</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] js_object</code>: The JavaScript object that will be the wrapper for the native object.</li><li><code>[in] native_object</code>: The native instance that will be wrapped in the JavaScript object.</li><li><code>[in] finalize_cb</code>: Optional native callback that can be used to free the native instance when the JavaScript object has been garbage-collected. <code>napi_finalize</code> provides more details.</li><li><code>[in] finalize_hint</code>: Optional contextual hint that is passed to the finalize callback.</li><li><code>[out] result</code>: Optional reference to the wrapped object.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>Wraps a native instance in a JavaScript object. The native instance can be retrieved later using <code>napi_unwrap()</code>.</p><p>When JavaScript code invokes a constructor for a class that was defined using <code>napi_define_class()</code>, the <code>napi_callback</code> for the constructor is invoked. After constructing an instance of the native class, the callback must then call <code>napi_wrap()</code> to wrap the newly constructed instance in the already-created JavaScript object that is the <code>this</code> argument to the constructor callback. (That <code>this</code> object was created from the constructor function&#39;s <code>prototype</code>, so it already has definitions of all the instance properties and methods.)</p><p>Typically when wrapping a class instance, a finalize callback should be provided that simply deletes the native instance that is received as the <code>data</code> argument to the finalize callback.</p><p>The optional returned reference is initially a weak reference, meaning it has a reference count of 0. Typically this reference count would be incremented temporarily during async operations that require the instance to remain valid.</p><p><em>Caution</em>: The optional returned reference (if obtained) should be deleted via <code>napi_delete_reference</code> ONLY in response to the finalize callback invocation. If it is deleted before then, then the finalize callback may never be invoked. Therefore, when obtaining a reference a finalize callback is also required in order to enable correct disposal of the reference.</p><p>Finalizer callbacks may be deferred, leaving a window where the object has been garbage collected (and the weak reference is invalid) but the finalizer hasn&#39;t been called yet. When using <code>napi_get_reference_value()</code> on weak references returned by <code>napi_wrap()</code>, you should still handle an empty result.</p><p>Calling <code>napi_wrap()</code> a second time on an object will return an error. To associate another native instance with the object, use <code>napi_remove_wrap()</code> first.</p><h3 id="napi-unwrap" tabindex="-1"><code>napi_unwrap</code> <a class="header-anchor" href="#napi-unwrap" aria-label="Permalink to &quot;\`napi_unwrap\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_unwrap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">js_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                        void**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] js_object</code>: The object associated with the native instance.</li><li><code>[out] result</code>: Pointer to the wrapped native instance.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>Retrieves a native instance that was previously wrapped in a JavaScript object using <code>napi_wrap()</code>.</p><p>When JavaScript code invokes a method or property accessor on the class, the corresponding <code>napi_callback</code> is invoked. If the callback is for an instance method or accessor, then the <code>this</code> argument to the callback is the wrapper object; the wrapped C++ instance that is the target of the call can be obtained then by calling <code>napi_unwrap()</code> on the wrapper object.</p><h3 id="napi-remove-wrap" tabindex="-1"><code>napi_remove_wrap</code> <a class="header-anchor" href="#napi-remove-wrap" aria-label="Permalink to &quot;\`napi_remove_wrap\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_remove_wrap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                             napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">js_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                             void**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] js_object</code>: The object associated with the native instance.</li><li><code>[out] result</code>: Pointer to the wrapped native instance.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>Retrieves a native instance that was previously wrapped in the JavaScript object <code>js_object</code> using <code>napi_wrap()</code> and removes the wrapping. If a finalize callback was associated with the wrapping, it will no longer be called when the JavaScript object becomes garbage-collected.</p><h3 id="napi-type-tag-object" tabindex="-1"><code>napi_type_tag_object</code> <a class="header-anchor" href="#napi-type-tag-object" aria-label="Permalink to &quot;\`napi_type_tag_object\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_type_tag_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">js_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_type_tag</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> type_tag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] js_object</code>: The JavaScript object or [external to be marked.</li><li><code>[in] type_tag</code>: The tag with which the object is to be marked.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>Associates the value of the <code>type_tag</code> pointer with the JavaScript object or [external. <code>napi_check_object_type_tag()</code> can then be used to compare the tag that was attached to the object with one owned by the addon to ensure that the object has the right type.</p><p>If the object already has an associated type tag, this API will return <code>napi_invalid_arg</code>.</p><h3 id="napi-check-object-type-tag" tabindex="-1"><code>napi_check_object_type_tag</code> <a class="header-anchor" href="#napi-check-object-type-tag" aria-label="Permalink to &quot;\`napi_check_object_type_tag\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_check_object_type_tag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                       napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">js_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                       const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_type_tag</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> type_tag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                       bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] js_object</code>: The JavaScript object or [external whose type tag to examine.</li><li><code>[in] type_tag</code>: The tag with which to compare any tag found on the object.</li><li><code>[out] result</code>: Whether the type tag given matched the type tag on the object. <code>false</code> is also returned if no type tag was found on the object.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>Compares the pointer given as <code>type_tag</code> with any that can be found on <code>js_object</code>. If no tag is found on <code>js_object</code> or, if a tag is found but it does not match <code>type_tag</code>, then <code>result</code> is set to <code>false</code>. If a tag is found and it matches <code>type_tag</code>, then <code>result</code> is set to <code>true</code>.</p><h3 id="napi-add-finalizer" tabindex="-1"><code>napi_add_finalizer</code> <a class="header-anchor" href="#napi-add-finalizer" aria-label="Permalink to &quot;\`napi_add_finalizer\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_add_finalizer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">js_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                               void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> finalize_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               napi_finalize </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">finalize_cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                               void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> finalize_hint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               napi_ref</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] js_object</code>: The JavaScript object to which the native data will be attached.</li><li><code>[in] finalize_data</code>: Optional data to be passed to <code>finalize_cb</code>.</li><li><code>[in] finalize_cb</code>: Native callback that will be used to free the native data when the JavaScript object has been garbage-collected. <code>napi_finalize</code> provides more details.</li><li><code>[in] finalize_hint</code>: Optional contextual hint that is passed to the finalize callback.</li><li><code>[out] result</code>: Optional reference to the JavaScript object.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>Adds a <code>napi_finalize</code> callback which will be called when the JavaScript object in <code>js_object</code> has been garbage-collected.</p><p>This API can be called multiple times on a single JavaScript object.</p><p><em>Caution</em>: The optional returned reference (if obtained) should be deleted via <code>napi_delete_reference</code> ONLY in response to the finalize callback invocation. If it is deleted before then, then the finalize callback may never be invoked. Therefore, when obtaining a reference a finalize callback is also required in order to enable correct disposal of the reference.</p><h2 id="simple-asynchronous-operations" tabindex="-1">Simple asynchronous operations <a class="header-anchor" href="#simple-asynchronous-operations" aria-label="Permalink to &quot;Simple asynchronous operations&quot;">​</a></h2><p>Addon modules often need to leverage async helpers from libuv as part of their implementation. This allows them to schedule work to be executed asynchronously so that their methods can return in advance of the work being completed. This allows them to avoid blocking overall execution of the Node.js application.</p><p>Node-API provides an ABI-stable interface for these supporting functions which covers the most common asynchronous use cases.</p><p>Node-API defines the <code>napi_async_work</code> structure which is used to manage asynchronous workers. Instances are created/deleted with <code>napi_create_async_work</code> and <code>napi_delete_async_work</code>.</p><p>The <code>execute</code> and <code>complete</code> callbacks are functions that will be invoked when the executor is ready to execute and when it completes its task respectively.</p><p>The <code>execute</code> function should avoid making any Node-API calls that could result in the execution of JavaScript or interaction with JavaScript objects. Most often, any code that needs to make Node-API calls should be made in <code>complete</code> callback instead. Avoid using the <code>napi_env</code> parameter in the execute callback as it will likely execute JavaScript.</p><p>These functions implement the following interfaces:</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_async_execute_callback)(napi_env env,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                            void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_async_complete_callback)(napi_env env,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                             napi_status status,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                             void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data);</span></span></code></pre></div><p>When these methods are invoked, the <code>data</code> parameter passed will be the addon-provided <code>void*</code> data that was passed into the <code>napi_create_async_work</code> call.</p><p>Once created the async worker can be queued for execution using the <code>napi_queue_async_work</code> function:</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_queue_async_work</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_async_work </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">work</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p><code>napi_cancel_async_work</code> can be used if the work needs to be cancelled before the work has started execution.</p><p>After calling <code>napi_cancel_async_work</code>, the <code>complete</code> callback will be invoked with a status value of <code>napi_cancelled</code>. The work should not be deleted before the <code>complete</code> callback invocation, even when it was cancelled.</p><h3 id="napi-create-async-work" tabindex="-1"><code>napi_create_async_work</code> <a class="header-anchor" href="#napi-create-async-work" aria-label="Permalink to &quot;\`napi_create_async_work\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_async_work</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">async_resource</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">async_resource_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   napi_async_execute_callback </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   napi_async_complete_callback </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">complete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                   void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   napi_async_work</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] async_resource</code>: An optional object associated with the async work that will be passed to possible <code>async_hooks</code> <code>init</code> hooks.</li><li><code>[in] async_resource_name</code>: Identifier for the kind of resource that is being provided for diagnostic information exposed by the <code>async_hooks</code> API.</li><li><code>[in] execute</code>: The native function which should be called to execute the logic asynchronously. The given function is called from a worker pool thread and can execute in parallel with the main event loop thread.</li><li><code>[in] complete</code>: The native function which will be called when the asynchronous logic is completed or is cancelled. The given function is called from the main event loop thread. <code>napi_async_complete_callback</code> provides more details.</li><li><code>[in] data</code>: User-provided data context. This will be passed back into the execute and complete functions.</li><li><code>[out] result</code>: <code>napi_async_work*</code> which is the handle to the newly created async work.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API allocates a work object that is used to execute logic asynchronously. It should be freed using <code>napi_delete_async_work</code> once the work is no longer required.</p><p><code>async_resource_name</code> should be a null-terminated, UTF-8-encoded string.</p><p>The <code>async_resource_name</code> identifier is provided by the user and should be representative of the type of async work being performed. It is also recommended to apply namespacing to the identifier, e.g. by including the module name. See the <code>async_hooks</code> documentation][async_hooks <code>type</code> for more information.</p><h3 id="napi-delete-async-work" tabindex="-1"><code>napi_delete_async_work</code> <a class="header-anchor" href="#napi-delete-async-work" aria-label="Permalink to &quot;\`napi_delete_async_work\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_delete_async_work</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   napi_async_work </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">work</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] work</code>: The handle returned by the call to <code>napi_create_async_work</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API frees a previously allocated work object.</p><p>This API can be called even if there is a pending JavaScript exception.</p><h3 id="napi-queue-async-work" tabindex="-1"><code>napi_queue_async_work</code> <a class="header-anchor" href="#napi-queue-async-work" aria-label="Permalink to &quot;\`napi_queue_async_work\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_queue_async_work</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_async_work </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">work</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] work</code>: The handle returned by the call to <code>napi_create_async_work</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API requests that the previously allocated work be scheduled for execution. Once it returns successfully, this API must not be called again with the same <code>napi_async_work</code> item or the result will be undefined.</p><h3 id="napi-cancel-async-work" tabindex="-1"><code>napi_cancel_async_work</code> <a class="header-anchor" href="#napi-cancel-async-work" aria-label="Permalink to &quot;\`napi_cancel_async_work\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_cancel_async_work</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   napi_async_work </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">work</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] work</code>: The handle returned by the call to <code>napi_create_async_work</code>.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API cancels queued work if it has not yet been started. If it has already started executing, it cannot be cancelled and <code>napi_generic_failure</code> will be returned. If successful, the <code>complete</code> callback will be invoked with a status value of <code>napi_cancelled</code>. The work should not be deleted before the <code>complete</code> callback invocation, even if it has been successfully cancelled.</p><p>This API can be called even if there is a pending JavaScript exception.</p><h2 id="custom-asynchronous-operations" tabindex="-1">Custom asynchronous operations <a class="header-anchor" href="#custom-asynchronous-operations" aria-label="Permalink to &quot;Custom asynchronous operations&quot;">​</a></h2><p>The simple asynchronous work APIs above may not be appropriate for every scenario. When using any other asynchronous mechanism, the following APIs are necessary to ensure an asynchronous operation is properly tracked by the runtime.</p><h3 id="napi-async-init" tabindex="-1"><code>napi_async_init</code> <a class="header-anchor" href="#napi-async-init" aria-label="Permalink to &quot;\`napi_async_init\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_async_init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">async_resource</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">async_resource_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            napi_async_context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] async_resource</code>: Object associated with the async work that will be passed to possible <code>async_hooks</code> <code>init</code> hooks and can be accessed by <code>async_hooks.executionAsyncResource()</code>.</li><li><code>[in] async_resource_name</code>: Identifier for the kind of resource that is being provided for diagnostic information exposed by the <code>async_hooks</code> API.</li><li><code>[out] result</code>: The initialized async context.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>The <code>async_resource</code> object needs to be kept alive until <code>napi_async_destroy</code> to keep <code>async_hooks</code> related API acts correctly. In order to retain ABI compatibility with previous versions, <code>napi_async_context</code>s are not maintaining the strong reference to the <code>async_resource</code> objects to avoid introducing causing memory leaks. However, if the <code>async_resource</code> is garbage collected by JavaScript engine before the <code>napi_async_context</code> was destroyed by <code>napi_async_destroy</code>, calling <code>napi_async_context</code> related APIs like <code>napi_open_callback_scope</code> and <code>napi_make_callback</code> can cause problems like loss of async context when using the <code>AsyncLocalStorage</code> API.</p><p>In order to retain ABI compatibility with previous versions, passing <code>NULL</code> for <code>async_resource</code> does not result in an error. However, this is not recommended as this will result poor results with <code>async_hooks</code><code>init</code> hooks and <code>async_hooks.executionAsyncResource()</code> as the resource is now required by the underlying <code>async_hooks</code> implementation in order to provide the linkage between async callbacks.</p><h3 id="napi-async-destroy" tabindex="-1"><code>napi_async_destroy</code> <a class="header-anchor" href="#napi-async-destroy" aria-label="Permalink to &quot;\`napi_async_destroy\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_async_destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               napi_async_context </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">async_context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] async_context</code>: The async context to be destroyed.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API can be called even if there is a pending JavaScript exception.</p><h3 id="napi-make-callback" tabindex="-1"><code>napi_make_callback</code> <a class="header-anchor" href="#napi-make-callback" aria-label="Permalink to &quot;\`napi_make_callback\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_make_callback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                           napi_async_context </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">async_context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                           napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">recv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                           napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                           size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> argc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                           const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                           napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] async_context</code>: Context for the async operation that is invoking the callback. This should normally be a value previously obtained from <code>napi_async_init</code>. In order to retain ABI compatibility with previous versions, passing <code>NULL</code> for <code>async_context</code> does not result in an error. However, this results in incorrect operation of async hooks. Potential issues include loss of async context when using the <code>AsyncLocalStorage</code> API.</li><li><code>[in] recv</code>: The <code>this</code> value passed to the called function.</li><li><code>[in] func</code>: <code>napi_value</code> representing the JavaScript function to be invoked.</li><li><code>[in] argc</code>: The count of elements in the <code>argv</code> array.</li><li><code>[in] argv</code>: Array of JavaScript values as <code>napi_value</code> representing the arguments to the function. If <code>argc</code> is zero this parameter may be omitted by passing in <code>NULL</code>.</li><li><code>[out] result</code>: <code>napi_value</code> representing the JavaScript object returned.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This method allows a JavaScript function object to be called from a native add-on. This API is similar to <code>napi_call_function</code>. However, it is used to call <em>from</em> native code back <em>into</em> JavaScript <em>after</em> returning from an async operation (when there is no other script on the stack). It is a fairly simple wrapper around <code>node::MakeCallback</code>.</p><p>Note it is <em>not</em> necessary to use <code>napi_make_callback</code> from within a <code>napi_async_complete_callback</code>; in that situation the callback&#39;s async context has already been set up, so a direct call to <code>napi_call_function</code> is sufficient and appropriate. Use of the <code>napi_make_callback</code> function may be required when implementing custom async behavior that does not use <code>napi_create_async_work</code>.</p><p>Any <code>process.nextTick</code>s or Promises scheduled on the microtask queue by JavaScript during the callback are ran before returning back to C/C++.</p><h3 id="napi-open-callback-scope" tabindex="-1"><code>napi_open_callback_scope</code> <a class="header-anchor" href="#napi-open-callback-scope" aria-label="Permalink to &quot;\`napi_open_callback_scope\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_open_callback_scope</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                 napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">resource_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                 napi_async_context </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                 napi_callback_scope</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] resource_object</code>: An object associated with the async work that will be passed to possible <code>async_hooks</code> <code>init</code> hooks. This parameter has been deprecated and is ignored at runtime. Use the <code>async_resource</code> parameter in <code>napi_async_init</code> instead.</li><li><code>[in] context</code>: Context for the async operation that is invoking the callback. This should be a value previously obtained from <code>napi_async_init</code>.</li><li><code>[out] result</code>: The newly created scope.</li></ul><p>There are cases (for example, resolving promises) where it is necessary to have the equivalent of the scope associated with a callback in place when making certain Node-API calls. If there is no other script on the stack the <code>napi_open_callback_scope</code> and <code>napi_close_callback_scope</code> functions can be used to open/close the required scope.</p><h3 id="napi-close-callback-scope" tabindex="-1"><code>napi_close_callback_scope</code> <a class="header-anchor" href="#napi-close-callback-scope" aria-label="Permalink to &quot;\`napi_close_callback_scope\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_close_callback_scope</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                  napi_callback_scope </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">scope</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] scope</code>: The scope to be closed.</li></ul><p>This API can be called even if there is a pending JavaScript exception.</p><h2 id="version-management" tabindex="-1">Version management <a class="header-anchor" href="#version-management" aria-label="Permalink to &quot;Version management&quot;">​</a></h2><h3 id="napi-get-node-version" tabindex="-1"><code>napi_get_node_version</code> <a class="header-anchor" href="#napi-get-node-version" aria-label="Permalink to &quot;\`napi_get_node_version\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  uint32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> major;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  uint32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> minor;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  uint32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> patch;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> release;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} napi_node_version;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_node_version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_node_version</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[out] version</code>: A pointer to version information for Node.js itself.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This function fills the <code>version</code> struct with the major, minor, and patch version of Node.js that is currently running, and the <code>release</code> field with the value of <code>process.release.name\`\`process.release</code>.</p><p>The returned buffer is statically allocated and does not need to be freed.</p><h3 id="napi-get-version" tabindex="-1"><code>napi_get_version</code> <a class="header-anchor" href="#napi-get-version" aria-label="Permalink to &quot;\`napi_get_version\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                             uint32_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[out] result</code>: The highest version of Node-API supported.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API returns the highest Node-API version supported by the Node.js runtime. Node-API is planned to be additive such that newer releases of Node.js may support additional API functions. In order to allow an addon to use a newer function when running with versions of Node.js that support it, while providing fallback behavior when running with Node.js versions that don&#39;t support it:</p><ul><li>Call <code>napi_get_version()</code> to determine if the API is available.</li><li>If available, dynamically load a pointer to the function using <code>uv_dlsym()</code>.</li><li>Use the dynamically loaded pointer to invoke the function.</li><li>If the function is not available, provide an alternate implementation that does not use the function.</li></ul><h2 id="memory-management" tabindex="-1">Memory management <a class="header-anchor" href="#memory-management" aria-label="Permalink to &quot;Memory management&quot;">​</a></h2><h3 id="napi-adjust-external-memory" tabindex="-1"><code>napi_adjust_external_memory</code> <a class="header-anchor" href="#napi-adjust-external-memory" aria-label="Permalink to &quot;\`napi_adjust_external_memory\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_adjust_external_memory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                    int64_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> change_in_bytes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                    int64_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] change_in_bytes</code>: The change in externally allocated memory that is kept alive by JavaScript objects.</li><li><code>[out] result</code>: The adjusted value</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This function gives V8 an indication of the amount of externally allocated memory that is kept alive by JavaScript objects (i.e. a JavaScript object that points to its own memory allocated by a native addon). Registering externally allocated memory will trigger global garbage collections more often than it would otherwise.</p><h2 id="promises" tabindex="-1">Promises <a class="header-anchor" href="#promises" aria-label="Permalink to &quot;Promises&quot;">​</a></h2><p>Node-API provides facilities for creating <code>Promise</code> objects as described in [Section 25.4 of the ECMA specification. It implements promises as a pair of objects. When a promise is created by <code>napi_create_promise()</code>, a &quot;deferred&quot; object is created and returned alongside the <code>Promise</code>. The deferred object is bound to the created <code>Promise</code> and is the only means to resolve or reject the <code>Promise</code> using <code>napi_resolve_deferred()</code> or <code>napi_reject_deferred()</code>. The deferred object that is created by <code>napi_create_promise()</code> is freed by <code>napi_resolve_deferred()</code> or <code>napi_reject_deferred()</code>. The <code>Promise</code> object may be returned to JavaScript where it can be used in the usual fashion.</p><p>For example, to create a promise and pass it to an asynchronous worker:</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_deferred deferred;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value promise;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status status;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Create the promise.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">deferred</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Pass the deferred to a function that performs an asynchronous action.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">do_something_asynchronous</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(deferred);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Return the promise to JS</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> promise;</span></span></code></pre></div><p>The above function <code>do_something_asynchronous()</code> would perform its asynchronous action and then it would resolve or reject the deferred, thereby concluding the promise and freeing the deferred:</p><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_deferred deferred;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value undefined;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status status;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Create a value with which to conclude the deferred.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_get_undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Resolve or reject the promise associated with the deferred depending on</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// whether the asynchronous action succeeded.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (asynchronous_action_succeeded) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_resolve_deferred</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, deferred, undefined);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_reject_deferred</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, deferred, undefined);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// At this point the deferred has been freed, so we should assign NULL to it.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">deferred </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h3 id="napi-create-promise" tabindex="-1"><code>napi_create_promise</code> <a class="header-anchor" href="#napi-create-promise" aria-label="Permalink to &quot;\`napi_create_promise\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_deferred</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> deferred</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[out] deferred</code>: A newly created deferred object which can later be passed to <code>napi_resolve_deferred()</code> or <code>napi_reject_deferred()</code> to resolve resp. reject the associated promise.</li><li><code>[out] promise</code>: The JavaScript promise associated with the deferred object.</li></ul><p>Returns <code>napi_ok</code> if the API succeeded.</p><p>This API creates a deferred object and a JavaScript promise.</p><h3 id="napi-resolve-deferred" tabindex="-1"><code>napi_resolve_deferred</code> <a class="header-anchor" href="#napi-resolve-deferred" aria-label="Permalink to &quot;\`napi_resolve_deferred\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_resolve_deferred</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_deferred </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">deferred</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">resolution</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] deferred</code>: The deferred object whose associated promise to resolve.</li><li><code>[in] resolution</code>: The value with which to resolve the promise.</li></ul><p>This API resolves a JavaScript promise by way of the deferred object with which it is associated. Thus, it can only be used to resolve JavaScript promises for which the corresponding deferred object is available. This effectively means that the promise must have been created using <code>napi_create_promise()</code> and the deferred object returned from that call must have been retained in order to be passed to this API.</p><p>The deferred object is freed upon successful completion.</p><h3 id="napi-reject-deferred" tabindex="-1"><code>napi_reject_deferred</code> <a class="header-anchor" href="#napi-reject-deferred" aria-label="Permalink to &quot;\`napi_reject_deferred\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_reject_deferred</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_deferred </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">deferred</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">rejection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] deferred</code>: The deferred object whose associated promise to resolve.</li><li><code>[in] rejection</code>: The value with which to reject the promise.</li></ul><p>This API rejects a JavaScript promise by way of the deferred object with which it is associated. Thus, it can only be used to reject JavaScript promises for which the corresponding deferred object is available. This effectively means that the promise must have been created using <code>napi_create_promise()</code> and the deferred object returned from that call must have been retained in order to be passed to this API.</p><p>The deferred object is freed upon successful completion.</p><h3 id="napi-is-promise" tabindex="-1"><code>napi_is_promise</code> <a class="header-anchor" href="#napi-is-promise" aria-label="Permalink to &quot;\`napi_is_promise\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_is_promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                            bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> is_promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] value</code>: The value to examine</li><li><code>[out] is_promise</code>: Flag indicating whether <code>promise</code> is a native promise object (that is, a promise object created by the underlying engine).</li></ul><h2 id="script-execution" tabindex="-1">Script execution <a class="header-anchor" href="#script-execution" aria-label="Permalink to &quot;Script execution&quot;">​</a></h2><p>Node-API provides an API for executing a string containing JavaScript using the underlying JavaScript engine.</p><h3 id="napi-run-script" tabindex="-1"><code>napi_run_script</code> <a class="header-anchor" href="#napi-run-script" aria-label="Permalink to &quot;\`napi_run_script\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_run_script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                        napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                        napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] script</code>: A JavaScript string containing the script to execute.</li><li><code>[out] result</code>: The value resulting from having executed the script.</li></ul><p>This function executes a string of JavaScript code and returns its result with the following caveats:</p><ul><li>Unlike <code>eval</code>, this function does not allow the script to access the current lexical scope, and therefore also does not allow to access the [module scope, meaning that pseudo-globals such as <code>require</code> will not be available.</li><li>The script can access the [global scope. Function and <code>var</code> declarations in the script will be added to the <code>global</code> object. Variable declarations made using <code>let</code> and <code>const</code> will be visible globally, but will not be added to the <code>global</code> object.</li><li>The value of <code>this</code> is <code>global</code> within the script.</li></ul><h2 id="libuv-event-loop" tabindex="-1">libuv event loop <a class="header-anchor" href="#libuv-event-loop" aria-label="Permalink to &quot;libuv event loop&quot;">​</a></h2><p>Node-API provides a function for getting the current event loop associated with a specific <code>napi_env</code>.</p><h3 id="napi-get-uv-event-loop" tabindex="-1"><code>napi_get_uv_event_loop</code> <a class="header-anchor" href="#napi-get-uv-event-loop" aria-label="Permalink to &quot;\`napi_get_uv_event_loop\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_uv_event_loop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                               struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> uv_loop_s</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> loop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[out] loop</code>: The current libuv loop instance.</li></ul><h2 id="asynchronous-thread-safe-function-calls" tabindex="-1">Asynchronous thread-safe function calls <a class="header-anchor" href="#asynchronous-thread-safe-function-calls" aria-label="Permalink to &quot;Asynchronous thread-safe function calls&quot;">​</a></h2><p>JavaScript functions can normally only be called from a native addon&#39;s main thread. If an addon creates additional threads, then Node-API functions that require a <code>napi_env</code>, <code>napi_value</code>, or <code>napi_ref</code> must not be called from those threads.</p><p>When an addon has additional threads and JavaScript functions need to be invoked based on the processing completed by those threads, those threads must communicate with the addon&#39;s main thread so that the main thread can invoke the JavaScript function on their behalf. The thread-safe function APIs provide an easy way to do this.</p><p>These APIs provide the type <code>napi_threadsafe_function</code> as well as APIs to create, destroy, and call objects of this type. <code>napi_create_threadsafe_function()</code> creates a persistent reference to a <code>napi_value</code> that holds a JavaScript function which can be called from multiple threads. The calls happen asynchronously. This means that values with which the JavaScript callback is to be called will be placed in a queue, and, for each value in the queue, a call will eventually be made to the JavaScript function.</p><p>Upon creation of a <code>napi_threadsafe_function</code> a <code>napi_finalize</code> callback can be provided. This callback will be invoked on the main thread when the thread-safe function is about to be destroyed. It receives the context and the finalize data given during construction, and provides an opportunity for cleaning up after the threads e.g. by calling <code>uv_thread_join()</code>. <strong>Aside from the main loop thread, no threads should be using the thread-safe function after the finalize callback completes.</strong></p><p>The <code>context</code> given during the call to <code>napi_create_threadsafe_function()</code> can be retrieved from any thread with a call to <code>napi_get_threadsafe_function_context()</code>.</p><h3 id="calling-a-thread-safe-function" tabindex="-1">Calling a thread-safe function <a class="header-anchor" href="#calling-a-thread-safe-function" aria-label="Permalink to &quot;Calling a thread-safe function&quot;">​</a></h3><p><code>napi_call_threadsafe_function()</code> can be used for initiating a call into JavaScript. <code>napi_call_threadsafe_function()</code> accepts a parameter which controls whether the API behaves blockingly. If set to <code>napi_tsfn_nonblocking</code>, the API behaves non-blockingly, returning <code>napi_queue_full</code> if the queue was full, preventing data from being successfully added to the queue. If set to <code>napi_tsfn_blocking</code>, the API blocks until space becomes available in the queue. <code>napi_call_threadsafe_function()</code> never blocks if the thread-safe function was created with a maximum queue size of 0.</p><p><code>napi_call_threadsafe_function()</code> should not be called with <code>napi_tsfn_blocking</code> from a JavaScript thread, because, if the queue is full, it may cause the JavaScript thread to deadlock.</p><p>The actual call into JavaScript is controlled by the callback given via the <code>call_js_cb</code> parameter. <code>call_js_cb</code> is invoked on the main thread once for each value that was placed into the queue by a successful call to <code>napi_call_threadsafe_function()</code>. If such a callback is not given, a default callback will be used, and the resulting JavaScript call will have no arguments. The <code>call_js_cb</code> callback receives the JavaScript function to call as a <code>napi_value</code> in its parameters, as well as the <code>void*</code> context pointer used when creating the <code>napi_threadsafe_function</code>, and the next data pointer that was created by one of the secondary threads. The callback can then use an API such as <code>napi_call_function()</code> to call into JavaScript.</p><p>The callback may also be invoked with <code>env</code> and <code>call_js_cb</code> both set to <code>NULL</code> to indicate that calls into JavaScript are no longer possible, while items remain in the queue that may need to be freed. This normally occurs when the Node.js process exits while there is a thread-safe function still active.</p><p>It is not necessary to call into JavaScript via <code>napi_make_callback()</code> because Node-API runs <code>call_js_cb</code> in a context appropriate for callbacks.</p><p>Zero or more queued items may be invoked in each tick of the event loop. Applications should not depend on a specific behavior other than progress in invoking callbacks will be made and events will be invoked as time moves forward.</p><h3 id="reference-counting-of-thread-safe-functions" tabindex="-1">Reference counting of thread-safe functions <a class="header-anchor" href="#reference-counting-of-thread-safe-functions" aria-label="Permalink to &quot;Reference counting of thread-safe functions&quot;">​</a></h3><p>Threads can be added to and removed from a <code>napi_threadsafe_function</code> object during its existence. Thus, in addition to specifying an initial number of threads upon creation, <code>napi_acquire_threadsafe_function</code> can be called to indicate that a new thread will start making use of the thread-safe function. Similarly, <code>napi_release_threadsafe_function</code> can be called to indicate that an existing thread will stop making use of the thread-safe function.</p><p><code>napi_threadsafe_function</code> objects are destroyed when every thread which uses the object has called <code>napi_release_threadsafe_function()</code> or has received a return status of <code>napi_closing</code> in response to a call to <code>napi_call_threadsafe_function</code>. The queue is emptied before the <code>napi_threadsafe_function</code> is destroyed. <code>napi_release_threadsafe_function()</code> should be the last API call made in conjunction with a given <code>napi_threadsafe_function</code>, because after the call completes, there is no guarantee that the <code>napi_threadsafe_function</code> is still allocated. For the same reason, do not use a thread-safe function after receiving a return value of <code>napi_closing</code> in response to a call to <code>napi_call_threadsafe_function</code>. Data associated with the <code>napi_threadsafe_function</code> can be freed in its <code>napi_finalize</code> callback which was passed to <code>napi_create_threadsafe_function()</code>. The parameter <code>initial_thread_count</code> of <code>napi_create_threadsafe_function</code> marks the initial number of acquisitions of the thread-safe functions, instead of calling <code>napi_acquire_threadsafe_function</code> multiple times at creation.</p><p>Once the number of threads making use of a <code>napi_threadsafe_function</code> reaches zero, no further threads can start making use of it by calling <code>napi_acquire_threadsafe_function()</code>. In fact, all subsequent API calls associated with it, except <code>napi_release_threadsafe_function()</code>, will return an error value of <code>napi_closing</code>.</p><p>The thread-safe function can be &quot;aborted&quot; by giving a value of <code>napi_tsfn_abort</code> to <code>napi_release_threadsafe_function()</code>. This will cause all subsequent APIs associated with the thread-safe function except <code>napi_release_threadsafe_function()</code> to return <code>napi_closing</code> even before its reference count reaches zero. In particular, <code>napi_call_threadsafe_function()</code> will return <code>napi_closing</code>, thus informing the threads that it is no longer possible to make asynchronous calls to the thread-safe function. This can be used as a criterion for terminating the thread. <strong>Upon receiving a return value of <code>napi_closing</code> from <code>napi_call_threadsafe_function()</code> a thread must not use the thread-safe function anymore because it is no longer guaranteed to be allocated.</strong></p><h3 id="deciding-whether-to-keep-the-process-running" tabindex="-1">Deciding whether to keep the process running <a class="header-anchor" href="#deciding-whether-to-keep-the-process-running" aria-label="Permalink to &quot;Deciding whether to keep the process running&quot;">​</a></h3><p>Similarly to libuv handles, thread-safe functions can be &quot;referenced&quot; and &quot;unreferenced&quot;. A &quot;referenced&quot; thread-safe function will cause the event loop on the thread on which it is created to remain alive until the thread-safe function is destroyed. In contrast, an &quot;unreferenced&quot; thread-safe function will not prevent the event loop from exiting. The APIs <code>napi_ref_threadsafe_function</code> and <code>napi_unref_threadsafe_function</code> exist for this purpose.</p><p>Neither does <code>napi_unref_threadsafe_function</code> mark the thread-safe functions as able to be destroyed nor does <code>napi_ref_threadsafe_function</code> prevent it from being destroyed.</p><h3 id="napi-create-threadsafe-function" tabindex="-1"><code>napi_create_threadsafe_function</code> <a class="header-anchor" href="#napi-create-threadsafe-function" aria-label="Permalink to &quot;\`napi_create_threadsafe_function\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_threadsafe_function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">async_resource</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">async_resource_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> max_queue_size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> initial_thread_count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> thread_finalize_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_finalize </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">thread_finalize_cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_threadsafe_function_call_js </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">call_js_cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_threadsafe_function</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] func</code>: An optional JavaScript function to call from another thread. It must be provided if <code>NULL</code> is passed to <code>call_js_cb</code>.</li><li><code>[in] async_resource</code>: An optional object associated with the async work that will be passed to possible <code>async_hooks</code> <code>init</code> hooks.</li><li><code>[in] async_resource_name</code>: A JavaScript string to provide an identifier for the kind of resource that is being provided for diagnostic information exposed by the <code>async_hooks</code> API.</li><li><code>[in] max_queue_size</code>: Maximum size of the queue. <code>0</code> for no limit.</li><li><code>[in] initial_thread_count</code>: The initial number of acquisitions, i.e. the initial number of threads, including the main thread, which will be making use of this function.</li><li><code>[in] thread_finalize_data</code>: Optional data to be passed to <code>thread_finalize_cb</code>.</li><li><code>[in] thread_finalize_cb</code>: Optional function to call when the <code>napi_threadsafe_function</code> is being destroyed.</li><li><code>[in] context</code>: Optional data to attach to the resulting <code>napi_threadsafe_function</code>.</li><li><code>[in] call_js_cb</code>: Optional callback which calls the JavaScript function in response to a call on a different thread. This callback will be called on the main thread. If not given, the JavaScript function will be called with no parameters and with <code>undefined</code> as its <code>this</code> value. <code>napi_threadsafe_function_call_js</code> provides more details.</li><li><code>[out] result</code>: The asynchronous thread-safe JavaScript function.</li></ul><h3 id="napi-get-threadsafe-function-context" tabindex="-1"><code>napi_get_threadsafe_function_context</code> <a class="header-anchor" href="#napi-get-threadsafe-function-context" aria-label="Permalink to &quot;\`napi_get_threadsafe_function_context\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_threadsafe_function_context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_threadsafe_function </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                     void**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] func</code>: The thread-safe function for which to retrieve the context.</li><li><code>[out] result</code>: The location where to store the context.</li></ul><p>This API may be called from any thread which makes use of <code>func</code>.</p><h3 id="napi-call-threadsafe-function" tabindex="-1"><code>napi_call_threadsafe_function</code> <a class="header-anchor" href="#napi-call-threadsafe-function" aria-label="Permalink to &quot;\`napi_call_threadsafe_function\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_call_threadsafe_function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_threadsafe_function </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                              void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                              napi_threadsafe_function_call_mode </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">is_blocking</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] func</code>: The asynchronous thread-safe JavaScript function to invoke.</li><li><code>[in] data</code>: Data to send into JavaScript via the callback <code>call_js_cb</code> provided during the creation of the thread-safe JavaScript function.</li><li><code>[in] is_blocking</code>: Flag whose value can be either <code>napi_tsfn_blocking</code> to indicate that the call should block if the queue is full or <code>napi_tsfn_nonblocking</code> to indicate that the call should return immediately with a status of <code>napi_queue_full</code> whenever the queue is full.</li></ul><p>This API should not be called with <code>napi_tsfn_blocking</code> from a JavaScript thread, because, if the queue is full, it may cause the JavaScript thread to deadlock.</p><p>This API will return <code>napi_closing</code> if <code>napi_release_threadsafe_function()</code> was called with <code>abort</code> set to <code>napi_tsfn_abort</code> from any thread. The value is only added to the queue if the API returns <code>napi_ok</code>.</p><p>This API may be called from any thread which makes use of <code>func</code>.</p><h3 id="napi-acquire-threadsafe-function" tabindex="-1"><code>napi_acquire_threadsafe_function</code> <a class="header-anchor" href="#napi-acquire-threadsafe-function" aria-label="Permalink to &quot;\`napi_acquire_threadsafe_function\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_acquire_threadsafe_function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_threadsafe_function </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] func</code>: The asynchronous thread-safe JavaScript function to start making use of.</li></ul><p>A thread should call this API before passing <code>func</code> to any other thread-safe function APIs to indicate that it will be making use of <code>func</code>. This prevents <code>func</code> from being destroyed when all other threads have stopped making use of it.</p><p>This API may be called from any thread which will start making use of <code>func</code>.</p><h3 id="napi-release-threadsafe-function" tabindex="-1"><code>napi_release_threadsafe_function</code> <a class="header-anchor" href="#napi-release-threadsafe-function" aria-label="Permalink to &quot;\`napi_release_threadsafe_function\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_release_threadsafe_function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_threadsafe_function </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_threadsafe_function_release_mode </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">mode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] func</code>: The asynchronous thread-safe JavaScript function whose reference count to decrement.</li><li><code>[in] mode</code>: Flag whose value can be either <code>napi_tsfn_release</code> to indicate that the current thread will make no further calls to the thread-safe function, or <code>napi_tsfn_abort</code> to indicate that in addition to the current thread, no other thread should make any further calls to the thread-safe function. If set to <code>napi_tsfn_abort</code>, further calls to <code>napi_call_threadsafe_function()</code> will return <code>napi_closing</code>, and no further values will be placed in the queue.</li></ul><p>A thread should call this API when it stops making use of <code>func</code>. Passing <code>func</code> to any thread-safe APIs after having called this API has undefined results, as <code>func</code> may have been destroyed.</p><p>This API may be called from any thread which will stop making use of <code>func</code>.</p><h3 id="napi-ref-threadsafe-function" tabindex="-1"><code>napi_ref_threadsafe_function</code> <a class="header-anchor" href="#napi-ref-threadsafe-function" aria-label="Permalink to &quot;\`napi_ref_threadsafe_function\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_ref_threadsafe_function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_threadsafe_function </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] func</code>: The thread-safe function to reference.</li></ul><p>This API is used to indicate that the event loop running on the main thread should not exit until <code>func</code> has been destroyed. Similar to <code>uv_ref</code> it is also idempotent.</p><p>Neither does <code>napi_unref_threadsafe_function</code> mark the thread-safe functions as able to be destroyed nor does <code>napi_ref_threadsafe_function</code> prevent it from being destroyed. <code>napi_acquire_threadsafe_function</code> and <code>napi_release_threadsafe_function</code> are available for that purpose.</p><p>This API may only be called from the main thread.</p><h3 id="napi-unref-threadsafe-function" tabindex="-1"><code>napi_unref_threadsafe_function</code> <a class="header-anchor" href="#napi-unref-threadsafe-function" aria-label="Permalink to &quot;\`napi_unref_threadsafe_function\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_unref_threadsafe_function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_threadsafe_function </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[in] func</code>: The thread-safe function to unreference.</li></ul><p>This API is used to indicate that the event loop running on the main thread may exit before <code>func</code> is destroyed. Similar to <code>uv_unref</code> it is also idempotent.</p><p>This API may only be called from the main thread.</p><h2 id="miscellaneous-utilities" tabindex="-1">Miscellaneous utilities <a class="header-anchor" href="#miscellaneous-utilities" aria-label="Permalink to &quot;Miscellaneous utilities&quot;">​</a></h2><h3 id="node-api-get-module-file-name" tabindex="-1"><code>node_api_get_module_file_name</code> <a class="header-anchor" href="#node-api-get-module-file-name" aria-label="Permalink to &quot;\`node_api_get_module_file_name\`&quot;">​</a></h3><div class="language-c vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node_api_get_module_file_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><ul><li><code>[in] env</code>: The environment that the API is invoked under.</li><li><code>[out] result</code>: A URL containing the absolute path of the location from which the add-on was loaded. For a file on the local file system it will start with <code>file://</code>. The string is null-terminated and owned by <code>env</code> and must thus not be modified or freed.</li></ul><p><code>result</code> may be an empty string if the add-on loading process fails to establish the add-on&#39;s file name during loading.</p>`,1204),l=[t];function h(p,o,d,r,c,k){return e(),s("div",null,l)}const u=i(n,[["render",h]]);export{g as __pageData,u as default};
