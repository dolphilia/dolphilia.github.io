import{_ as s,o as a,c as n,R as e}from"./chunks/framework.320df067.js";const F=JSON.parse('{"title":"Python (2 and 3)","description":"","frontmatter":{},"headers":[],"relativePath":"translation/antlr/python-target.md","filePath":"translation/antlr/python-target.md","lastUpdated":null}'),l={name:"translation/antlr/python-target.md"},o=e(`<h1 id="python-2-and-3" tabindex="-1">Python (2 and 3) <a class="header-anchor" href="#python-2-and-3" aria-label="Permalink to &quot;Python (2 and 3)&quot;">​</a></h1><p>The examples from the ANTLR 4 book converted to Python are here.</p><p>There are 2 Python targets: <code>Python2</code> and <code>Python3</code>. This is because there is only limited compatibility between those 2 versions of the language. Please refer to the Python documentation for full details.</p><p>How to create a Python lexer or parser? This is pretty much the same as creating a Java lexer or parser, except you need to specify the language target, for example:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">$ antlr4 -Dlanguage=Python2 MyGrammar.g4</span></span></code></pre></div><p>or</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">$ antlr4 -Dlanguage=Python3 MyGrammar.g4</span></span></code></pre></div><p>For a full list of antlr4 tool options, please visit the tool documentation page.</p><h2 id="where-can-i-get-the-runtime" tabindex="-1">Where can I get the runtime? <a class="header-anchor" href="#where-can-i-get-the-runtime" aria-label="Permalink to &quot;Where can I get the runtime?&quot;">​</a></h2><p>Once you&#39;ve generated the lexer and/or parser code, you need to download the runtime. The Python runtimes are available from PyPI:</p><ul><li><a href="https://pypi.python.org/pypi/antlr4-python2-runtime/" target="_blank" rel="noreferrer">https://pypi.python.org/pypi/antlr4-python2-runtime/</a></li><li><a href="https://pypi.python.org/pypi/antlr4-python3-runtime/" target="_blank" rel="noreferrer">https://pypi.python.org/pypi/antlr4-python3-runtime/</a></li></ul><p>The runtimes are provided in the form of source code, so no additional installation is required.</p><p>We will not document here how to refer to the runtime from your Python project, since this would differ a lot depending on your project type and IDE.</p><h2 id="how-do-i-run-the-generated-lexer-and-or-parser" tabindex="-1">How do I run the generated lexer and/or parser? <a class="header-anchor" href="#how-do-i-run-the-generated-lexer-and-or-parser" aria-label="Permalink to &quot;How do I run the generated lexer and/or parser?&quot;">​</a></h2><p>Let&#39;s suppose that your grammar is named, as above, &quot;MyGrammar&quot;. Let&#39;s suppose this parser comprises a rule named &quot;startRule&quot;. The tool will have generated for you the following files:</p><ul><li>MyGrammarLexer.py</li><li>MyGrammarParser.py</li><li>MyGrammarListener.py (if you have not activated the -no-listener option)</li><li>MyGrammarVisitor.py (if you have activated the -visitor option)</li></ul><p>(Developers used to Java/C# AntLR will notice that there is no base listener or visitor generated, this is because Python having no support for interfaces, the generated listener and visitor are fully fledged classes)</p><p>Now a fully functioning script might look like the following:</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> sys</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> antlr4 </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> MyGrammarLexer </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> MyGrammarLexer</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> MyGrammarParser </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> MyGrammarParser</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">argv</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    input_stream </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">FileStream</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">argv</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#A6ACCD;">    lexer </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">MyGrammarLexer</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">input_stream</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    stream </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">CommonTokenStream</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">lexer</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    parser </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">MyGrammarParser</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">stream</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    tree </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> parser</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">startRule</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> __name__ </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">__main__</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">sys</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">argv</span><span style="color:#89DDFF;">)</span></span></code></pre></div><p>This program will work. But it won&#39;t be useful unless you do one of the following:</p><ul><li>you visit the parse tree using a custom listener</li><li>you visit the parse tree using a custom visitor</li><li>your grammar comprises production code (like ANTLR3)</li></ul><p>(please note that production code is target specific, so you can&#39;t have multi target grammars that include production code, except for very limited use cases, see below)</p><h2 id="how-do-i-create-and-run-a-custom-listener" tabindex="-1">How do I create and run a custom listener? <a class="header-anchor" href="#how-do-i-create-and-run-a-custom-listener" aria-label="Permalink to &quot;How do I create and run a custom listener?&quot;">​</a></h2><p>Let&#39;s suppose your MyGrammar grammar comprises 2 rules: &quot;key&quot; and &quot;value&quot;. The antlr4 tool will have generated the following listener:</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">MyGrammarListener</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">ParseTreeListener</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">enterKey</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;font-style:italic;">self</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">ctx</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">pass</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">exitKey</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;font-style:italic;">self</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">ctx</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">pass</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">enterValue</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;font-style:italic;">self</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">ctx</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">pass</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">exitValue</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;font-style:italic;">self</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">ctx</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">pass</span></span></code></pre></div><p>In order to provide custom behavior, you might want to create the following class:</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">KeyPrinter</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">MyGrammarListener</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;">     </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">exitKey</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;font-style:italic;">self</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">ctx</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;">         </span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Oh, a key!</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span></code></pre></div><p>In order to execute this listener, you would simply add the following lines to the above code:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">...</span></span>
<span class="line"><span style="color:#A6ACCD;">       tree = parser.startRule() - only repeated here for reference</span></span>
<span class="line"><span style="color:#A6ACCD;">   printer = KeyPrinter()</span></span>
<span class="line"><span style="color:#A6ACCD;">   walker = ParseTreeWalker()</span></span>
<span class="line"><span style="color:#A6ACCD;">   walker.walk(printer, tree)</span></span></code></pre></div><p>Further information can be found from the ANTLR 4 definitive guide.</p><p>The Python implementation of ANTLR is as close as possible to the Java one, so you shouldn&#39;t find it difficult to adapt the examples for Python.</p><h2 id="target-agnostic-grammars" tabindex="-1">Target agnostic grammars <a class="header-anchor" href="#target-agnostic-grammars" aria-label="Permalink to &quot;Target agnostic grammars&quot;">​</a></h2><p>If your grammar is targeted to Python only, you may ignore the following. But if your goal is to get your Java parser to also run in Python, then you might find it useful.</p><ol><li>Do not embed production code inside your grammar. This is not portable and will not be. Move all your code to listeners or visitors.</li><li>The only production code absolutely required to sit with the grammar should be semantic predicates, like:</li></ol><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">ID {$text.equals(&quot;test&quot;)}?</span></span></code></pre></div><p>Unfortunately, this is not portable, as Java and Python (and other target languages) have different syntaxes for all but the simplest language elements. But you can work around it. The trick involves:</p><ul><li>deriving your parser from a parser you provide, such as BaseParser</li><li>implementing utility methods, such as &quot;isEqualText&quot;, in this BaseParser, in different files for each target language</li><li>invoking your utility methods in the semantic predicate from the <code>$parser</code> object</li></ul><p>Thanks to the above, you should be able to rewrite the above semantic predicate as follows:</p><p>File <code>MyGrammarParser.g4</code>:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">options { superClass = MyGrammarBaseParser; }</span></span>
<span class="line"><span style="color:#A6ACCD;">...</span></span>
<span class="line"><span style="color:#A6ACCD;">ID {$parser.isEqualText($text,&quot;test&quot;)}?</span></span></code></pre></div><p>File <code>MyGrammarBaseParser.py</code>:</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> antlr4 </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">MyGrammarBaseParser</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">Parser</span><span style="color:#89DDFF;">):</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">isEqualText</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">a</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">b</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> a </span><span style="color:#89DDFF;">is</span><span style="color:#A6ACCD;"> b</span></span></code></pre></div><p>File <code>MyGrammarBaseParser.java</code>:</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">org</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">antlr</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">v4</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">runtime</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">*</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">abstract</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">MyGrammarBaseParser</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">extends</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Parser</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">boolean</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">isEqualText</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">a</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">b</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> a</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equals</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">b</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div>`,44),t=[o];function p(r,c,i,y,D,A){return a(),n("div",null,t)}const d=s(l,[["render",p]]);export{F as __pageData,d as default};
